<!--
  @description       : 
  @author            : Spoorthy
  @group             : 
  @last modified on  : 09-03-2024
  @last modified by  : Spoorthy
-->
<apex:page extensions="ganttcontroller" standardController="Project_Template__c"  standardStylesheets="false" showHeader="false" action="{!getProjDatatest}"> 
    <head> 
        <apex:stylesheet value="{!URLFOR($Resource.DHTMLX_Latest, '/css/dhtmlxgantt.css')}"/> 
        <apex:stylesheet value="{!URLFOR($Resource.DHTMLX_Latest, '/css/style.css')}"/> 
        <apex:stylesheet value="{!URLFOR($Resource.DHTMLX_Latest, '/css/jquery_multiselect.css')}"/>
        <apex:stylesheet value="{!URLFOR($Resource.DHTMLX_Latest, '/css/chosen.css')}"/>
        
        <apex:includeScript value="{!URLFOR($Resource.DHTMLX_Latest, '/js/dhtmlxgantt.js')}"/>
        <apex:includeScript value="{!URLFOR($Resource.DHTMLX_Latest, '/js/dhtmlxgantt_auto_scheduling.js')}"/> 
        <apex:includeScript value="{!URLFOR($Resource.DHTMLX_Latest, '/js/dhtmlxgantt_critical_path.js')}"/>
        <apex:includeScript value="{!URLFOR($Resource.DHTMLX_Latest, '/js/dhtmlxgantt_csp.js')}"/>
        <apex:includeScript value="{!URLFOR($Resource.DHTMLX_Latest, '/js/dhtmlxgantt_fullscreen.js')}"/> 
        <apex:includeScript value="{!URLFOR($Resource.DHTMLX_Latest, '/js/dhtmlxgantt_grouping.js')}"/>
        <apex:includeScript value="{!URLFOR($Resource.DHTMLX_Latest, '/js/dhtmlxgantt_keyboard_navigation.js')}"/>
        <apex:includeScript value="{!URLFOR($Resource.DHTMLX_Latest, '/js/dhtmlxgantt_marker.js')}"/> 
        <apex:includeScript value="{!URLFOR($Resource.DHTMLX_Latest, '/js/dhtmlxgantt_multiselect.js')}"/>
        <apex:includeScript value="{!URLFOR($Resource.DHTMLX_Latest, '/js/dhtmlxgantt_quick_info.js')}"/>
        <apex:includeScript value="{!URLFOR($Resource.DHTMLX_Latest, '/js/dhtmlxgantt_smart_rendering.js')}"/>
        <apex:includeScript value="{!URLFOR($Resource.DHTMLX_Latest, '/js/dhtmlxgantt_tooltip.js')}"/>
        <apex:includeScript value="{!URLFOR($Resource.DHTMLX_Latest, '/js/dhtmlxgantt_undo.js')}"/>
        <!--<apex:includeScript value="{!URLFOR($Resource.DHTMLX_Latest, '/js/api.js')}"/> -->
        <!------------- below JS files for Resource Column ----------------------->
        <apex:includeScript value="{!URLFOR($Resource.DHTMLX_Latest, '/js/jquery-3.3.1.min.js')}"/>
        <apex:includeScript value="{!URLFOR($Resource.DHTMLX_Latest, '/js/chosen.jquery.js')}"/>
        <apex:includeScript value="{!URLFOR($Resource.DHTMLX_Latest, '/js/jquery_multiselect.js')}"/> 
        
        <style>
            
            html, body {
            height: 100%;
            padding: 0px;
            margin: 0px;
            overflow: hidden;
            }
            
            .Taskcolor{
            background-color:#c8cbce!important; 
            font-weight:bold!important;
            }
            .projectcolor{
            background-color:rgb(177, 207, 234)!important;
            font-weight:bold!important;
            }
            
            #gantt_here {
            width:100%;
            height: 800px;
            height:calc(100vh - 52px);
            }
            
            .gantt_grid_scale .gantt_grid_head_cell,
            .gantt_task .gantt_task_scale .gantt_scale_cell {
            font-weight: bold;
            font-size: 14px;
            color: rgba(0, 0, 0, 0.7);
            }
            
            .resource_marker{
            text-align: center;
            }
            .resource_marker div{
            width: 28px;
            height: 28px;
            line-height: 29px;
            display: inline-block;
            color: #FFF;
            margin: 3px;
            }
            .resource_marker.workday_ok div {
            border-radius: 15px;
            background: #51c185;
            }
            
            .resource_marker.workday_over div{
            border-radius: 3px;
            background: #ff8686;
            }
            
            .folder_row {
            font-weight: bold;
            }
            
            .highlighted_resource,
            .highlighted_resource.odd{
            background-color: rgba(255, 251, 224, 0.6);
            }
            
            .resource-controls .gantt_layout_content{
            padding: 7px;
            overflow: hidden;
            }
            .resource-controls label{
            margin: 0 10px;
            vertical-align: bottom;
            display: inline-block;
            color: #3e3e3e;
            padding: 2px;
            transition: box-shadow 0.2s;
            }
            
            .resource-controls label:hover{
            box-shadow: 0 2px rgba(84, 147, 255, 0.42);
            }
            
            .resource-controls label.active,
            .resource-controls label.active:hover
            {
            box-shadow: 0 2px #5493ffae;
            color: #1f1f1f;
            }
            
            .resource-controls input{
            vertical-align: top;
            }
            
            .gantt_task_cell.week_end {
            background-color: #e8e8e87d;
            }
            
            .gantt_task_row.gantt_selected .gantt_task_cell.week_end {
            background-color: #e8e8e87d !important;
            }
            
            
            .group_row, .group_row.odd, .gantt_task_row.group_row{
            background-color: rgba(232, 232, 232, 0.6);
            }
            
            .owner-label{
            width: 20px;
            height: 20px;
            line-height: 20px;
            font-size: 12px;
            display: inline-block;
            border: 1px solid #cccccc;
            border-radius: 25px;
            background: #e6e6e6;
            color: #6f6f6f;
            margin: 0 3px;
            font-weight: bold;
            }
            
            
            
            .gantt_task_line.milestone_task .gantt_task_content{
            left: 28px;
            width:20px !important;
            height: 20px !important;
            display: inline-block;
            background: #d33daf;
            color:#d33daf;
            visibility: visible !important;
            border: 1px solid #61164f !important;
            transform: rotate(45deg);
            box-sizing: border-box;
            }
            
            .gantt_task_line.milestone_task {
            border: none;
            width: 70px !important;
            height: 20px !important;
            background-color: rgba(0,0,0,0) !important;
            box-shadow: none;
            }
            
            .gantt_task_line.milestone_task .gantt_task_progress_wrapper,
            .gantt_task_line.milestone_task .gantt_task_progress_drag,
            .milestone_task .gantt_task_drag.task_right.task_end_date,
            .milestone_task .gantt_task_drag.task_left.task_start_date
            {
            display: none;
            }
            
            
            .gantt_resource_amount_input{display:none;}
            .slds-scope .slds-icon-text-default{fill:rgb(0, 109, 204);}
            .link{position:relative;top:3px;}
            html, body {padding: 0px;margin: 0px;height: 100%;}
            
            .gantt_grid_scale .gantt_grid_head_cell,.gantt_task .gantt_task_scale .gantt_scale_cell {font-weight: bold;font-size: 14px;color: rgba(0, 0, 0, 0.7);}
            .gantt-error{display:none !important;}
            
            .gantt_cal_larea textarea{height:24px !important;}
            .gantt_cal_ltext{height:26px !important;}
            
            .gantt_cal_ltext label{display:block !important;}
            .gantt_grid_scale .gantt_grid_head_cell{border-right:1px solid #cecece !important;}
            <!--.gantt_grid_scale .gantt_grid_head_cell:nth-child(2){border-right:0px solid #cecece !important;}
.gantt_cal_ltext:nth-child(8){overflow-y:scroll !important;height:80px !important;border: 1px solid #cecece;width: 99.9%;margin: auto;}-->
            .gantt_cal_lsection{padding:5px 0 5px 10px !important;}
            .slds-scope input[type=checkbox], .slds-scope input[type=radio]{position:relative !important;top:3px !important;}
            .gantt_grid_data .gantt_cell{text-align:center;}
            .gantt_cal_cover{z-index:0 !important;}
            .gantt_cal_light{height: 446px !important;top:0 !important;}
            .chosen-container-multi .chosen-choices li.search-choice .search-choice-close{background-image: url({!URLFOR($Resource.close_icon)}) !important; width: 15px !important;background-size: 10px !important;background-position: 3px 0 !important;}
            .gantt_cal_larea{height: 366px !important;overflow-y: scroll !important;padding-bottom:20px !important;}
            .column_icon{
            width: 18px;
            height: 86%;
            display: inline-block;
            background-repeat: no-repeat;
            background-position: center center;
            vertical-align: top;
            border-radius: 50%;
            }
            .slds-notify_container{z-index: 100000 !important }
        </style> 
    </head>
    
    <body> 
        <apex:slds />
        
        <div class="slds-spinner_container" id="spinner" style="display:block;">
            <div role="status" class="slds-spinner slds-spinner_brand slds-spinner_medium">
                <span class="slds-assistive-text">Loading</span>
                <div class="slds-spinner__dot-a"></div>
                <div class="slds-spinner__dot-b"></div>
            </div>
        </div>
        
        <apex:form >
            <p><apex:outputText value="{!success}" id="showstate" /></p>
            <div class="slds-page-header slds-m-around_small slds-p-around_small">
                <div class="slds-page-header__row">
                    <div class="slds-page-header__col-title">
                        <div class="slds-media">
                            <div class="slds-media__figure">
                                <span class="slds-icon_container slds-icon-standard-agent-session">
                                    <svg class="slds-icon slds-icon--large">
                                        <use href="{!URLFOR($Resource.SLDS, '/assets/icons/custom-sprite/svg/symbols.svg#custom18')}"></use>
                                    </svg>
                                </span>
                            </div>
                            <div class="slds-media__body">
                                <div class="slds-page-header__name1">
                                    <div class="slds-page-header__name-title">
                                        <h1>
                                            <span class="slds-page-header__title">Manage IPM </span>
                                            <span class="slds-page-header__title1 slds-truncate"><b> Project Name :</b> {!Project_Template__c.Name}&nbsp;&nbsp;&nbsp;</span>
                                            <span class="slds-page-header__title1 slds-truncate"><b> Account Name :</b> {!Project_Template__c.Account__r.Name}&nbsp;&nbsp;&nbsp;</span>
                                            <span class="slds-page-header__title1 slds-truncate"><b> Project Type :</b> {!Project_Template__c.Project_Type__c}&nbsp;&nbsp;&nbsp;</span>
                                            <span class="slds-page-header__title1 slds-truncate"><b> Start Date : </b> <apex:outputText value="{0,date,MM/dd/yyyy}">
                                                <apex:param value="{!Project_Template__c.Start_Date__c}" />
                                                </apex:outputText> </span>
                                        </h1>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="slds-page-header__col-actions">
                        <div class="slds-page-header__controls">
                            <div class="slds-page-header__control">
                                <ul class="slds-button-group-list">
                                    <li>
                                        <apex:outputpanel rendered="{!Project_Template__c.Template__c == true}"> 
                                            <apex:outputpanel rendered="{!ButtonAccessFlag == true}"> 
                                                <apex:commandButton styleClass="slds-button slds-button_brand slds-m-top_x-small" value="Save" onclick="savechart('issavetrue')" onComplete="saveSuccess();"  />
                                                <apex:commandButton styleClass="slds-button slds-button_brand slds-m-top_x-small" value="Save & Close" onclick="savechart('issaveandclose')" onComplete="save_close_Success();"  />
                                                <button type="button" class="slds-button slds-button_brand slds-m-top_x-small" onclick="back()">Cancel</button>
                                            </apex:outputpanel>
                                        </apex:outputpanel>
                                        <apex:outputpanel rendered="{!Project_Template__c.Template__c == true}"> 
                                            <apex:outputpanel rendered="{!ButtonAccessFlag == false}"> 
                                                <button type="button" class="slds-button slds-button_brand slds-m-top_x-small" onclick="back()">Cancel</button>
                                            </apex:outputpanel>
                                        </apex:outputpanel>
                                        
                                        <apex:outputpanel rendered="{!Project_Template__c.Template__c == false}"> 
                                            <apex:outputpanel rendered="{!ButtonAccessFlag == true}"> 
                                                <apex:commandButton styleClass="slds-button slds-button_brand slds-m-top_x-small" value="Save" onclick="savechart('issavetrue')" onComplete="saveSuccess();"  />
                                                <apex:commandButton styleClass="slds-button slds-button_brand slds-m-top_x-small" value="Save & Close" onclick="savechart('issaveandclose')" onComplete="save_close_Success();"  />
                                                <button type="button" class="slds-button slds-button_brand slds-m-top_x-small" onclick="back()">Cancel</button>
                                                <apex:commandButton styleClass="slds-button slds-button_brand slds-m-top_x-small" value="Save as Template" onclick="modal('{!RHSValuesForFields}')" onComplete="showTemplateModal();"/>
                                            </apex:outputpanel>
                                        </apex:outputpanel>
                                        <apex:outputpanel rendered="{!Project_Template__c.Template__c == false}"> 
                                            <apex:outputpanel rendered="{!ButtonAccessFlag == false}"> 
                                                
                                                <button type="button" class="slds-button slds-button_brand slds-m-top_x-small" onclick="back()">Cancel</button>
                                                
                                            </apex:outputpanel>
                                        </apex:outputpanel>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
        </apex:form>
        <div class="header gantt-demo-header">
            <ul class="gantt-controls">
                <li class="gantt-menu-item gantt-menu-item-last"><a data-action="collapseAll"><svg class="slds-icon slds-icon-text-default slds-icon--x-small"><use href="{!URLFOR($Resource.SLDS, '/assets/icons/utility-sprite/svg/symbols.svg#chevronup')}"></use></svg> Collapse All</a></li>
                <li class="gantt-menu-item gantt-menu-item-last"><a data-action="expandAll"><svg class="slds-icon slds-icon-text-default slds-icon--x-small"><use href="{!URLFOR($Resource.SLDS, '/assets/icons/utility-sprite/svg/symbols.svg#chevrondown')}"></use></svg> Expand All</a></li>
                <li class="gantt-menu-item gantt-menu-item-last"><a data-action="toggleCriticalPath"><svg class="slds-icon slds-icon-text-default slds-icon--x-small"><use href="{!URLFOR($Resource.SLDS, '/assets/icons/utility-sprite/svg/symbols.svg#dash')}"></use></svg> Critical Path</a></li>
                <li class="gantt-menu-item gantt-menu-item-last"><a data-action="Delete"><svg class="slds-icon slds-icon-text-default slds-icon--x-small"><use href="{!URLFOR($Resource.SLDS, '/assets/icons/utility-sprite/svg/symbols.svg#delete')}"></use></svg> Delete</a></li>
                <li class="gantt-menu-item gantt-menu-item-right"><a data-action="fullscreen"><svg class="slds-icon slds-icon-text-default slds-icon--x-small"><use href="{!URLFOR($Resource.SLDS, '/assets/icons/utility-sprite/svg/symbols.svg#desktop')}"></use></svg> Fullscreen</a></li>
                <li class="gantt-menu-item gantt-menu-item-right gantt-menu-item-last"><a data-action="zoomToFit"><svg class="slds-icon slds-icon-text-default slds-icon--x-small"><use href="{!URLFOR($Resource.SLDS, '/assets/icons/utility-sprite/svg/symbols.svg#zoomin')}"></use></svg> Zoom to Fit</a></li>
                
            </ul>
        </div>
        <div id="gantt_here" style='width:100%; height:70%;'>
        </div> 
        <script> 
        
        gantt.config.date_grid = "%D %m/%d/%Y";
        
        gantt.config.layout = {
            css: "gantt_container",
            cols: [
                {
                    width:900,
                    min_width: 100,
                    rows:[
                        {view: "grid", scrollX: "gridScroll", scrollable: true, scrollY: "scrollVer"},
                        {view: "scrollbar", id: "gridScroll", group:"horizontal"}
                    ]
                },
                {resizer: true, width: 1},
                {
                    rows:[
                        {view: "timeline", scrollX: "scrollHor", scrollY: "scrollVer"},
                        {view: "scrollbar", id: "scrollHor", group:"horizontal"}
                    ]
                },
                {view: "scrollbar", id: "scrollVer"}
            ]
        };
        
        gantt.init("gantt_here");
        
        gantt.addCalendar({
            id:"custom",
            worktime: {
                hours: ["8:00-17:00"],
                days: [ 1, 1, 1, 1, 1, 1 ,1]
            }
        });
        
         gantt.addCalendar({
            id:"Normal",
            worktime: {
                hours: ["0:00-23:59"],
                days: [ 0, 1, 1, 1, 1, 1,0]
            }
        });
         
        gantt.config.auto_types = true;
        gantt.config.work_time = true;
        gantt.config.correct_work_time = true;
        gantt.keys.edit_save = 32;
        gantt.config.keyboard_navigation_cells = true;
        gantt.config.auto_scheduling = true;
        gantt.config.auto_scheduling_initial = true;
        //gantt.config.auto_scheduling_strict = true;
        gantt.config.row_height = 23;
        gantt.config.fit_tasks = true;
        gantt.config.show_unscheduled = true;
        gantt.config.open_tree_initially = true;
        gantt.config.order_branch = true;
        gantt.config.order_branch_free = true;
        gantt.config.cascade_delete = true;
        gantt.config.date_grid = "%D %m/%d/%Y";
        // added for performance increase
        gantt.config.show_task_cells = false;
        gantt.config.static_background = true;
        gantt.config.branch_loading = true;
        gantt.config.smart_scales = true;
        //gantt.config.smart_rendering = false;
        gantt.config.show_progress = false;
        gantt.config.buttons_right = ["gantt_delete_btn11"];
        gantt.locale.labels["gantt_delete_btn11"] = "";
        
        
        gantt.attachEvent("onQuickInfo",function(taskId){
            gantt.hideQuickInfo();
            // your code here
        });
        
        
        var tempche;
        var tempflag = {!JSENCODE(projecttemplateFlag)}
        var isnewtask=false; 
        
        var startdate = '{!JSENCODE(TEXT(Project_Template__c.Start_Date__c))}';
        var TempLookup = '{!JSENCODE(Project_Template__c.Project_Template__c)}';
        var EffectiveDate = '{!JSENCODE(TEXT(Project_Template__c.Effective_Date__c))}';
        var YearLabel = '{!$Label.Value_of_Year}';
        var effectiveDateTasks = [];
        
        gantt.config.start_date = startdate;
        function formatEndDate(task){
            var date;
            if(task.type == 'milestone'){
                date = gantt.calculateEndDate({start_date:task.end_date, duration:0, task:task});
                return gantt.templates.date_grid(date, task);
            }else if(task.type == 'project'){
                var milestones = [];
                var maxDate = null;
                
                gantt.eachTask(function(child){
                    if (child.type == 'milestone') {
                        milestones.push(child.id);
                    }
                    if (+child.end_date > +maxDate){
                        maxDate = child.end_date;
                    }
                },task.id);
                
                for (var i = 0; i < milestones.length; i++) {
                    date = gantt.getTask(milestones[i]).end_date;
                    if (+date == +maxDate) return gantt.templates.date_grid(date, task);
                }
                date = gantt.calculateEndDate({start_date:task.end_date, duration:-1, task:task});
                return gantt.templates.date_grid(date, task);
            }else{
                // date = gantt.calculateEndDate({start_date:task.end_date, duration:-1, task:task});
                //return gantt.templates.date_grid(date, task);
                if(task.text.toUpperCase() === "EFFECTIVE DATE"){	
                    date = gantt.calculateEndDate({start_date : task.start_date, duration : 0, task : task});	
                    return gantt.templates.date_grid(date, task);	
                }else{	
                    //updateEffectiveDatePred(task);
                    task['calendar_id']='Normal';
                    date = gantt.calculateEndDate({start_date:task.end_date, duration:-1, task:task});	
                    return gantt.templates.date_grid(date, task);	
                }
            }
            
        }
        
        
        
        var resourcesStore = gantt.createDatastore({
            name: gantt.config.resource_store,
            type: "treeDatastore",
            initItem: function (item) {
                item.parent = item.parent || gantt.config.root_id;
                item[gantt.config.resource_property] = item.parent;
                item.open = true;
                return item;
            }
        });
        
        var holiday_data = [];
        <apex:repeat value="{!holidayData}" var="holi">
            var holidayDate = gantt.date.convert_to_utc(new Date('{!holi.ActivityDate}'));
        holiday_data.push(gantt.date.convert_to_utc(new Date(holidayDate.getFullYear(),holidayDate.getMonth(),holidayDate.getDate())));
        </apex:repeat>
        
        for (var i = 0; i < holiday_data.length; i++) {
            gantt.setWorkTime({
                date: holiday_data[i],
                hours: false
            });
        }
        
        
        var ifcondition = "{!ifcondition}";
        var projrolelist =[
            <apex:repeat value="{!IPMupdateList}" var="ProjRole">
            {
            roleid : "{!ProjRole.id}",
            rolestring: "{!ProjRole.IPM_Roles__c}",
            },
            </apex:repeat>
        ]
        
        var temprolelist =[
            <apex:repeat value="{!IPMRoleIdList}" var="TempRoles">
            {
            resid : "{!TempRoles.id}",
            resstring: "{!TempRoles.IPM_Roles__c}",
            },
            </apex:repeat>
        ]
        
        let recordstemplate = [];
        let records = [];
        let taskLoopVar;
        let isAllExtChecked =  'checked';
       
        
        if('{!thousandBlocks[0].cases.size}' == '0'){
            isAllExtChecked = '';
           
        }
        
        
        <apex:repeat value="{!thousandBlocks}" var="proj">
            <apex:repeat value="{!proj.cases}" var="aflA">
              
                taskLoopVar = {
                sfdcid : "{!aflA.id}",
                wbs : "{!aflA.WBS_Code__c}",
                Duration :  "{!aflA.Duration__c}",
                text :  "{!aflA.Project_Task_Name__c}",
                start_date : "{!aflA.Start_Date__c}",
                end_date : "{!aflA.End_Date__c}",
                predecessor: "{!aflA.predecessors__c}", 
                projId : "{!aflA.Project_Task_Id__c}",
                parentid:"{!aflA.Parent__c}",  
                target:"{!aflA.target__c}",
                source:"{!aflA.source__c}",
                type:"{!aflA.type__c}",
                linkid:"{!aflA.linkId__c}",
                owner_id:"{!aflA.Resource_Id__c}",
                Owner:"{!aflA.Owner__c}",
                lag :"{!aflA.lag__c}",
                projtype : "{!aflA.Project_Type__c}",
                RowNum : "{!aflA.Row_Number__c}",
                checked: "{!aflA.Checked__c}",
                progress: "{!aflA.Progress__c}",
                PR_Name : "{!aflA.PRT_Name__r.Project_Template__c}",
                actual_finish_date : "{!aflA.Actual_Finish__c}",
                Notes :"{!SUBSTITUTE(JSENCODE(aflA.Notes__c), '\\u003Cbr /\\u003E', '')}",
                dashboard : "{!aflA.Dashboard__c}",
                Additional_Comments : "{!SUBSTITUTE(JSENCODE(aflA.Additional_Comments__c), '\\u003Cbr /\\u003E', '')}",
                split : {!aflA.Mark_as_Milestone__c}?"[true]":"[false]"
            };
        if({!aflA.Checked__c} == false){
            isAllExtChecked = '';
        }
        
        recordstemplate.push({ ...taskLoopVar });
        records.push({ ...taskLoopVar })
        </apex:repeat>
        </apex:repeat>
        
        
        
        
        var ganttData = {
            data: [],
            links: []
        };
        var resourceID ='';
        function RoleToResource(rolestng)
        {
            for(var rr = 0; rr < projrolelist.length; rr++){
                if(rolestng == 'Senior Client Manager' || rolestng == 'Client Manager')
                {
                    
                    if(projrolelist[rr].rolestring == 'Senior Client Manager' || projrolelist[rr].rolestring == 'Client Manager'){
                        if(resourceID == 'null' || resourceID ==''){   
                            resourceID = projrolelist[rr].roleid;
                        }else{ 
                            if(resourceID.indexOf(projrolelist[rr].roleid) == -1){
                                resourceID = resourceID+','+projrolelist[rr].roleid;
                            }
                        }
                    }
                }else{
                    if(projrolelist[rr].rolestring == rolestng){
                        
                        if(resourceID == 'null' || resourceID ==''){
                            resourceID = projrolelist[rr].roleid;
                        }else{ 
                            resourceID = resourceID+','+projrolelist[rr].roleid;
                        }
                    }
                } 
            }
            return resourceID;
        }
        
        for(var i=0; i< records.length; i++){
            
            if(temprolelist.length > 0){
                var Resource =''
                resourceID = '';
                var resourceIdArr = records[i].owner_id.split(',');
                for(var j=0; j<temprolelist.length ; j++){
                    if(resourceIdArr.length>0){
                        if(resourceIdArr.includes(temprolelist[j].resid)){
                            Resource = RoleToResource(temprolelist[j].resstring);
                        }
                    } 
                }
                records[i].owner_id= Resource;
            }
            var d;
            var Ed;
            var durationres;
            
            if(TempLookup != null && TempLookup != '' && ifcondition =='true'){
                records[i].sfdcid ='';
                
                durationres = records[i].Duration;
                var Actual_finish_date = 'N/A';
                records[i].progress =0;
                if(records[i].text.toUpperCase() =='EFFECTIVE DATE'){
                    d = gantt.date.convert_to_utc(new Date(EffectiveDate));
                }else{
                    d = gantt.date.convert_to_utc(new Date(startdate));
                }
                
            }else{
                durationres = records[i].Duration;
                d= gantt.date.convert_to_utc(new Date(records[i].start_date));
                if(tempflag == true){
                    var Actual_finish_date = 'N/A';
                    records[i].progress =0;
                    
                }else{
                    if(records[i].actual_finish_date != '' && records[i].actual_finish_date != null && records[i].actual_finish_date != undefined){
                        var Actual_finish_date =  gantt.date.convert_to_utc(new Date(records[i].actual_finish_date));
                    }else{
                        var Actual_finish_date = 'N/A';
                    }
                }
            }
            
            var resourcearr =[];
            if(records[i].owner_id.indexOf(',')!== -1){
                var str_array3 = records[i].owner_id.split(','); 
                for(var k = 0; k < str_array3.length; k++){
                    resourcearr.push(str_array3[k]);
                }
            }else{
                resourcearr.push(records[i].owner_id);
            }
            
            let rowDataObj = {id:records[i].projId,
                              RowNum:records[i].RowNum,
                              sfdcid:records[i].sfdcid,
                              wbs:records[i].wbs,
                              text:records[i].text,
                              start_date:d,
                              end_date:Ed,
                              actual_finish:Actual_finish_date,
                              duration:durationres,
                              parent:records[i].parentid,
                              predecessors:records[i].predecessor,
                              open:true,
                              type:records[i].projtype,
                              owner_id:resourcearr,
                              checked:records[i].checked,
                              progress:records[i].progress,
                              Notes:records[i].Notes,
                              Additional_Comments:records[i].Additional_Comments,
                              dashboard:records[i].dashboard,
                              split:records[i].split};
            
            let linkObj = {id:records[i].linkid,
                           source: records[i].projId,
                           target:records[i].target,
                           type:records[i].type,
                           lag:records[i].lag};
            
            if(records[i].target.indexOf(',')!== -1){
                var str_array = records[i].target.split(','); 
                var str_array1 = records[i].linkid.split(','); 
                var str_array2 = records[i].type.split(','); 
                var str_array3 = records[i].lag.split(','); 
                
                for(var j = 0; j < str_array.length; j++){
                    linkObj = {id:str_array1[j],
                               source: records[i].projId,
                               target:str_array[j],
                               type:str_array2[j],
                               lag:str_array3[j]};
                    // instead of calling gantt.init/gantt.parse - put data items into arrays you defined before
                    if(records[i].text.toUpperCase() === "EFFECTIVE DATE"){	
                        rowDataObj['calendar_id'] = 'custom';	
                    } else
                        rowDataObj['calendar_id'] = 'Normal';
                    ganttData.data.push(rowDataObj);
                    ganttData.links.push(linkObj);
                    
                }
            }else if(records[i].linkid=='undefined' ||records[i].linkid==''){
                if(records[i].text.toUpperCase() === "EFFECTIVE DATE"){	
                    rowDataObj['calendar_id'] = 'custom';	
                }  else
                        rowDataObj['calendar_id'] = 'Normal';
                ganttData.data.push(rowDataObj);
                
            }else{ 
                if(records[i].text.toUpperCase() === "EFFECTIVE DATE"){	
                    rowDataObj['calendar_id'] = 'custom';	
                }  else
                        rowDataObj['calendar_id'] = 'Normal';
                ganttData.data.push(rowDataObj);
                ganttData.links.push(linkObj);
            }
        }
        
        gantt.attachEvent("onTaskLoading", function(task){
            if(task.actual_finish != 'N/A'){
                task.auto_scheduling = false;
            }
            return true;
        });
        // and once you've collected all the data - parse it all at once
        gantt.parse(ganttData);
        
        //code to delete the array of task 
        var deletetaskvalues=[];
        var deleteTaskTarget = [];
        var ParentVal;
        gantt.attachEvent("onBeforeTaskDelete", function(id,item){
            var link = []
            var link = item.$source;
            for(let li = 0; li<link.length ; li++){
                let linklist = gantt.getLink(link[li]);
                deleteTaskTarget.push(linklist.target);
            }
            var task = gantt.getTask(id);
            deletetaskvalues.push(task.sfdcid);
            //Code for changing project to task, when deleted all subtasks
            ParentVal = gantt.getParent(id);
            // ends here
            
            gantt.eachTask(function(child){
                var task1 = gantt.getTask(child.id);
                deletetaskvalues.push(task1.sfdcid);
            }, id);
            return true;
        });
        
        gantt.attachEvent("onBeforeTaskAdd", function(id,item){
            ParentVal = gantt.getParent(id);
            gantt.batchUpdate(function () {
                var task = gantt.getTaskByTime();
                for(var i=0; i<task.length ; i++){
                    if(task[i].text.toUpperCase()==="EFFECTIVE DATE"){	
                        task[i].calendar_id='custom';    	
                    }else
                        task[i].calendar_id='Normal'; 
                    gantt.updateTask(task[i].id,task[i]);
                }
            });
            gantt.render();
            return true;
        });
        
        var TaskDelete = 'false';
        gantt.attachEvent("onAfterTaskDelete", function(id,item){  
            
            gantt.batchUpdate(function () {
                var taskcount = 0;
                var task = gantt.getTaskByTime();
                for(var i=0; i<task.length ; i++)
                {
                    taskcount = taskcount+1;
                    if(taskcount == task.length){
                        //document.getElementById("spinner").style.display = "none";
                    }
                    var taskpred = task[i].$target;
                    var taskid =[];
                    
                    if(task[i].$target == null || task[i].$target == undefined || task[i].$target == '' || task[i].$target.length == 0){
                        // Making project to Task, when deleted alls subtasks of Project
                        if(task[i].id == ParentVal){
                            if(gantt.getChildren(task[i].id) == null ||
                               gantt.getChildren(task[i].id) == '' ||
                               gantt.getChildren(task[i].id) == undefined){
                                
                                task[i].type ='task' ;
                                task[i].start_date = gantt.date.convert_to_utc(new Date(startdate));
                                task[i].duration = 1;
                                task[i].end_date  = gantt.calculateEndDate({start_date: task[i].start_date, duration: task[i].duration});
                            }
                        }
                        // Ends Here
                        if(deleteTaskTarget.includes(task[i].id)){
                            task[i].predecessors = '';
                            
                            if(task[i].actual_finish == null ||
                               task[i].actual_finish == '' ||
                               task[i].actual_finish == undefined ||
                               task[i].actual_finish == 'N/A')
                            {
                                
                                var startdates = new Date(startdate)
                                task[i].start_date = gantt.date.convert_to_utc(new Date(startdate));
                                task[i].duration = task[i].duration;
                                task[i].end_date  = gantt.calculateEndDate({start_date: task[i].start_date, duration: task[i].duration});
                            }
                            if(task[i].id != null && task[i].id != undefined){
                                //taskid.push(task[i].id);
                                //gantt.updateTask(task[i].id,task[i]);
                                //gantt.autoSchedule(task[i].id);
                            }
                        }
                    }else if(task[i].$target.length > 0){
                        // Making project to Task, when deleted alls subtasks of Project
                        if(task[i].id == ParentVal){
                            if(gantt.getChildren(task[i].id) == null ||
                               gantt.getChildren(task[i].id) == '' ||
                               gantt.getChildren(task[i].id) == undefined)
                            {
                                task[i].type ='task' ;
                                task[i].start_date = gantt.date.convert_to_utc(new Date(startdate));
                                task[i].duration = 1;
                                task[i].end_date  = gantt.calculateEndDate({start_date: task[i].start_date, duration: task[i].duration});
                            }
                        }
                        // Ends Here
                        
                        
                        var links = task[i].$target;
                        var labels = [];
                        var types = [];
                        
                        for(var j = 0; j < links.length; j++){
                            
                            var link = gantt.getLink(links[j]);
                            var pred = gantt.getTask(link.source);
                            var index = pred.$index;
                            var typ = link.type;
                            var lag = link.lag;
                            var sign;
                            
                            index = index+1;
                            if(typ == 0){
                                typedup = 'FS';
                            }else if(typ == 1){
                                typedup = 'SS';
                            }else if(typ == 2){
                                typedup = 'FF';
                            }else if(typ == 3){
                                typedup = 'SF';
                            }
                            
                            if(lag >= 0){
                                sign ='+';
                            }else{
                                sign ='';  
                            }
                            
                            
                            if(lag == null || lag == '' || lag == undefined){
                                lag =0;
                                sign ='+';
                                if(labels.indexOf(gantt.getTaskNumber(pred)+typedup+sign+lag+'days') == -1){
                                    labels.push(gantt.getTaskNumber(pred)+typedup+sign+lag+'days');
                                }
                            }else{ 
                                if(labels.indexOf(gantt.getTaskNumber(pred)+typedup+sign+lag+'days') == -1){
                                    labels.push(gantt.getTaskNumber(pred)+typedup+sign+lag+'days');
                                }
                            }
                            
                            task[i].predecessors = labels.join(", ");
                            task[i].RowNum = task[i].RowNum;
                            
                            
                            if(task[i].id != null && task[i].id != undefined){
                                //gantt.autoSchedule(task[i].id);
                                //taskid.push(task[i].id);
                            }
                        }
                    }
                    
                    gantt.updateTask(task[i].id,task[i]);
                }
            });
            
            gantt.autoSchedule();
            gantt.render();
            return true;
        });
        
        gantt.attachEvent("onRowDragEnd", function(task){
            gantt.batchUpdate(function () {
                var taskcount = 0;
                var task = gantt.getTaskByTime();
                
                for(var i=0; i<task.length ; i++){
                    taskcount = taskcount+1;
                    if(taskcount == task.length){
                        //document.getElementById("spinner").style.display = "none";
                    }
                    var taskpred = task[i].$target;
                    var taskid =[];
                    
                    if(task[i].$target == null || task[i].$target == undefined || task[i].$target == '' || task[i].$target.length == 0)
                    {
                        if(deleteTaskTarget.includes(task[i].id))
                        {
                            task[i].predecessors = '';
                            if(task[i].id != null && task[i].id != undefined)
                            {
                                taskid.push(task[i].id);
                            }
                        }
                    }
                    else if(task[i].$target.length > 0)
                    {
                        //var target = task[i].$target;
                        //Predecessor_function(target);
                        var links = task[i].$target;
                        var labels = [];
                        var types = [];
                        
                        for(var j = 0; j < links.length; j++){
                            var link = gantt.getLink(links[j]);
                            var pred = gantt.getTask(link.source);
                            var index = pred.$index;
                            var sign;
                            
                            index = index+1;
                            var typ = link.type;
                            var lag = link.lag;
                            if(typ == 0){
                                typedup = 'FS';
                            }else if(typ == 1){
                                typedup = 'SS';
                            }else if(typ == 2){
                                typedup = 'FF';
                            }else if(typ == 3){
                                typedup = 'SF';
                            }
                            
                            if(lag >= 0){
                                sign ='+';
                            }else{
                                sign ='';  
                            }
                            
                            if(lag == null || lag == '' || lag == undefined){
                                lag =0;
                                sign ='+';
                                if(labels.indexOf(gantt.getTaskNumber(pred)+typedup+sign+lag+'days') == -1){
                                    labels.push(gantt.getTaskNumber(pred)+typedup+sign+lag+'days');
                                }
                            }else{ 
                                if(labels.indexOf(gantt.getTaskNumber(pred)+typedup+sign+lag+'days') == -1){
                                    labels.push(gantt.getTaskNumber(pred)+typedup+sign+lag+'days');
                                }
                            }
                            
                            task[i].predecessors = labels.join(", ");
                            
                            if(task[i].id != null && task[i].id != undefined){
                                //gantt.updateTask(task[i].id,task[i]);
                                //taskid.push(task[i].id);
                            }
                        }
                    }
                    gantt.updateTask(task[i].id,task[i]);
                }
                
            });
            gantt.autoSchedule();
            return true;
        });
        
        gantt.attachEvent("onGanttRender", function(task){
            
            document.getElementById("spinner").style.display = "none";
        });
        (function(){
            
            function endPopup(){
                modal = null;
                editLinkId = null;
            }
            function cancelEditLink(){
                endPopup()
            }
            
            function deleteLink(){
                var deletedpre;
                var link = gantt.getLink(editLinkId);
                
                gantt.deleteLink(editLinkId);
                var pred = gantt.getTask(link.source);
                
                var typ = link.type;
                var lag = link.lag;
                if(typ == 0){
                    typedup = 'FS';
                }
                else if(typ == 1){
                    typedup = 'SS';
                }
                    else if(typ == 2){
                        typedup = 'FF';
                    }
                        else if(typ == 3){
                            typedup = 'SF';
                        }
                var sign;
                if(lag >= 0){
                    sign ='+';
                }
                else{
                    sign ='-';  
                }
                var index = pred.$index;
                index = index+1;
                if(gantt.getTask(link.target).predecessors.includes("days"))
                {
                    deletedpre=index+typedup+sign+lag+'days'; 
                }
                else if(lag == null || lag == '' || lag == undefined ||lag == '0')
                {
                    deletedpre=index+typedup;
                }
                gantt.getTask(link.target).predecessors=gantt.getTask(link.target).predecessors.replace(deletedpre,'');
                gantt.getTask(link.target).predecessors=gantt.getTask(link.target).predecessors.replace(',,',',');
                gantt.updateTask(link.target);
                endPopup()
            }
            
            
            function saveLink(){
                var link = gantt.getLink(editLinkId);
                
                var lagValue = modal.querySelector(".lag-input").value;
                var lagValue = lagValue;
                if(!isNaN(parseInt(lagValue, 10))){
                    link.lag = parseInt(lagValue, 10);
                }
                
                gantt.updateLink(link.id);
                if(gantt.autoSchedule){
                    gantt.autoSchedule(link.source);
                }
                endPopup();
            }
            
            var modal;
            var editLinkId;
            gantt.attachEvent("onLinkDblClick", function(id,e){
                editLinkId = id;
                var link = gantt.getLink(id);
                var linkTitle;
                switch(link.type){
                    case gantt.config.links.finish_to_start:
                        linkTitle = "FS";
                        break;
                    case gantt.config.links.finish_to_finish:
                        linkTitle = "FF";
                        break;
                    case gantt.config.links.start_to_start:
                        linkTitle = "SS";
                        break;
                    case gantt.config.links.start_to_finish:
                        linkTitle = "SF";
                        break;
                }
                
                linkTitle += " " + gantt.getTask(link.source).text + " -> " + gantt.getTask(link.target).text;
                
                modal = gantt.modalbox({
                    title: linkTitle,
                    text: "<div>" +
                    "<label>Lag <input type='number' class='lag-input' /></label>" +
                    "</div>",
                    buttons: [
                        {label:"Save", css:"link-save-btn", value:"save"},
                        {label:"Cancel", css:"link-cancel-btn", value:"cancel"},
                        {label:"Delete", css:"link-delete-btn", value:"delete"}
                    ],
                    width: "500px",
                    type: "popup-css-class-here",
                    callback: function(result){
                        switch(result){
                            case "save":
                                saveLink();
                                break;
                            case "cancel":
                                cancelEditLink();
                                break;
                                
                            case "delete":
                                deleteLink();
                                break;
                        }
                    }
                });
                
                
                modal.querySelector(".lag-input").value = link.lag || 0;
                return false;
            });
            
        })();
        //resource code -----------        
        gantt.serverList("owner", [
            <apex:repeat value="{!UsData}" var="own">
            {key: "{!own.Name}",label: "{!own.Name}"},
            </apex:repeat>
        ]);
         console.log('Veera');
        console.log(gantt.serverList());
        //resource code -----------
        /*  gantt.serverList("priority", [
            {key: "Low", label: "Low"},
            {key: "Normal", label: "Normal"},
            {key: "High", label: "High"}
        ]);
        */
        
        (function(gantt){
            var taskNumbers = null;
            function calculateAll(){
                taskNumbers = {};
                var index = 1;
                gantt.eachTask(function(task){
                    task.RowNum = index;// added for update row number after events fires.
                    taskNumbers[task.id] = index;
                    index++;
                    
                });
            }
            function resetCache(){
                taskNumbers = null; 
                
                setTimeout(function(){
                    document.querySelector('.ext-selectAll').checked = isAllExtChecked
                    console.log('resetting checkbox',isAllExtChecked);
                }, 200);
                return true;
            }
            
            gantt.getTaskNumber = function(task) {
                if(!taskNumbers){
                    calculateAll()
                }
                task.RowNum = taskNumbers[task.id];
                
                return taskNumbers[task.id];
            };
            
            gantt.attachEvent("onTaskCreated", resetCache);
            gantt.attachEvent("onAfterTaskMove", resetCache);
            gantt.attachEvent("onBeforeParse", resetCache);
            gantt.attachEvent("onAfterTaskDelete", resetCache);
            gantt.attachEvent("onAfterTaskAdd", resetCache);
            gantt.attachEvent("onAfterSort", resetCache);
            gantt.attachEvent("onLightboxDelete", resetCache);
            gantt.attachEvent("onAfterTaskUpdate", resetCache);
            gantt.attachEvent("onLightboxSave", resetCache);
            gantt.attachEvent("onLightboxCancel", resetCache);
            gantt.attachEvent("onTaskClick",resetCache);
            gantt.attachEvent("onAfterBatchUpdate",resetCache);
            gantt.attachEvent("onAfterLightbox",resetCache);
            gantt.attachEvent("onBeforeLightbox",resetCache);
            gantt.attachEvent("onBeforeTaskAdd",resetCache);
            gantt.attachEvent("onBeforeExpand",resetCache);
            gantt.attachEvent("onBeforeCollapse",resetCache);
            gantt.attachEvent("onBeforeTaskDelete",resetCache);
            gantt.attachEvent("onBeforeGanttRender",resetCache);
            gantt.attachEvent("onGanttRender",resetCache);
        })(gantt);
        
        var task=null;
        var editors = {
            RowNum :{type: "number", map_to: "RowNum"},
            wbs: {type: "text", map_to: "wbs"},
            text: {type: "text", map_to: "text"},
            start_date: {type: "date", map_to: "start_date",min:new Date(2000,01,01), max: new Date(3000,12,12)},
            end_date: {type: "date", map_to: "end_date",min:new Date(2000,01,01), max: new Date(3000,12,12)},
            actual_finish: {type: "date", map_to: "actual_finish",min:new Date(2000,01,01), max: new Date(3000,12,12)},
            duration: {type: "number", map_to: "duration", min:0, max: 100},        
            work_duration: {type: "number", map_to: "work_duration", min:0, max: 100},       
            predecessors: {type: "text", map_to: "predecessors"},
            progress: {type: "number", map_to: "progress"},
            owner: {type: "select", map_to: "owner", options:gantt.serverList("owner")},
            Notes : {type: "text", map_to: "Notes"},
            Additional_Comments : {type:"textarea",map_to:"Additional_Comments"},
            split :{type :"checkbox",map_to :"split"},
            add : {type:"add",map_to:"add"}
        };
        /*
        function priorityLabel(task){
            var value = task.priority;
            var list = gantt.serverList("priority");
            for(var i = 0; i < list.length; i++){
                if(list[i].key == value){
                    return list[i].label;
                }
            }
            return "";
        }*/
        function ownerLabel(task){
            var value = task.owner;
            var list = gantt.serverList("owner");
            for(var i = 0; i < list.length; i++){
                if(list[i].key == value){
                    return list[i].label;
                }
            }
            return "";
        }
        
        var resdate = new Date(startdate);
        //var resdate = new Date(startdate);
        var localTime = resdate.getTime();
        var localOffset = resdate.getTimezoneOffset() * 60000;
        var utc = localTime + localOffset;
        var offset = 5.5;   
        var bombay = utc + (3600000*offset);
        resdate = new Date(bombay);
        var enddate = new Date(resdate);
        enddate.setDate(enddate.getDate()+1);
        
        gantt.attachEvent("onBeforeLightbox", function(id,task) {
            console.log('onBeforeLightbox called');
            var task = gantt.getTask(id);
            if(task.$new){
                
                task.start_date = resdate;
                task.end_date = enddate;
            }
            
            
            var links = task.$target;
            
            console.log(links)
            var labels = [];
            for(var i = 0; i < links.length; i++){
                var link = gantt.getLink(links[i]);
                var pred = gantt.getTask(link.source);
                
                var typ = link.type;
                var lag = link.lag;
                if(typ == 0){
                    typedup = 'FS';
                }
                else if(typ == 1){
                    typedup = 'SS';
                }
                    else if(typ == 2){
                        typedup = 'FF';
                    }
                        else if(typ == 3){
                            typedup = 'SF';
                        }
                var sign;
                if(lag >= 0){
                    sign ='+';
                }
                else{
                    sign ='';  
                }
                var index = pred.$index;
                
                index = index+1;
                
                if(lag == null || lag == '' || lag == undefined)
                {
                    lag =0;
                    sign ='+';
                    if(labels.indexOf(gantt.getTaskNumber(pred)+typedup+sign+lag+'days') == -1)
                    {
                        labels.push(gantt.getTaskNumber(pred)+typedup+sign+lag+'days');
                    }
                }
                else
                {
                    if(labels.indexOf(gantt.getTaskNumber(pred)+typedup+sign+lag+'days') == -1)
                    {
                        labels.push(gantt.getTaskNumber(pred)+typedup+sign+lag+'days');
                    }
                }
                
            }
            
            var count = 0;
            if(count == 0){
                count = count+1;
                var startdate = new Date(task.start_date);
                gantt.templates.task_time = function(startdate,enddate,task){
                    var enddate = new Date(task.end_date);
                    enddate = gantt.calculateEndDate({start_date:task.end_date, duration:-1, task:task});
                    var startMonth = startdate.getMonth()+1;
                    var endMonth = enddate.getMonth()+1;
                    if(startdate.getMonth() != 9 && startdate.getMonth() != 10 && startdate.getMonth() !=11){
                        startMonth = '0'+startMonth;
                    }
                    if(enddate.getMonth() != 9 && enddate.getMonth() != 10 && enddate.getMonth() !=11){
                        endMonth = '0'+endMonth;
                    }
                    return startMonth+'/'+startdate.getDate()+'/'+startdate.getFullYear()+" - "+endMonth+'/'+enddate.getDate()+'/'+enddate.getFullYear();
                };
                gantt.templates.task_date= function(enddate){
                    var enddate = new Date(task.end_date);
                    enddate = gantt.calculateEndDate({start_date:task.end_date, duration:-1, task:task});
                    var endMonth = enddate.getMonth()+1;
                    if(enddate.getMonth() != 10 && enddate.getMonth() != 11 && enddate.getMonth() !=12){
                        endMonth = '0'+endMonth;
                    }
                    return endMonth+'/'+enddate.getDate()+'/'+enddate.getFullYear();
                };
            }
            
            task.predecessors = labels.join(",") 
            var parenttaskId;
            var parenttasktype;
            var restype;
            if(gantt.getParent(task.id) !=0)
            {
                parenttaskId = gantt.getParent(task.id);
                parenttasktype = gantt.getTask(parenttaskId);
                //alert('parenttasktype>>>>'+parenttasktype.$rendered_type);
                //parenttasktype.type = 'project';
                restype = parenttasktype.$rendered_type;
                
            }
            return true;
            
        });
        
        
        
        gantt.templates.tooltip_text = function(start,end,task){
            var startdate = new Date(task.start_date);
            var enddate = new Date(task.end_date);
            enddate = gantt.calculateEndDate({start_date:task.end_date, duration:-1, task:task});
            var startMonth = startdate.getMonth()+1;
            var endMonth = enddate.getMonth()+1;
            if(startdate.getMonth() != 9 && startdate.getMonth() != 10 && startdate.getMonth() !=11){
                startMonth = '0'+startMonth;
            }
            if(enddate.getMonth() != 9 && enddate.getMonth() != 10 && enddate.getMonth() !=11){
                endMonth = '0'+endMonth;
            }
            return "<b>Task:</b> "+task.text+"<br/><b>Start Date:</b> " + startMonth+'/'+startdate.getDate()+'/'+startdate.getFullYear()+"<br/><b>End Date:</b> "+ endMonth+'/'+enddate.getDate()+'/'+enddate.getFullYear();
        };
        // Actual Finish Rollup To Summary Task, if all subTask has value of subTask - summary Task ActualFinish will Update
        function get_max_actual_finish(id){
            var parent = gantt.getTask(id);
            var max_actual_finish = null;
            gantt.eachTask(function(child){
                
                if (child.actual_finish && +child.actual_finish > +max_actual_finish) max_actual_finish = gantt.copy(child.actual_finish);
            },id);
            
            parent.actual_finish = gantt.copy(max_actual_finish);
            parent.progress = 100;
            max_actual_finish = null;
            gantt.updateTask(id);
        }
        //One of sub task is Null or N/A - summary task will became N/A
        function Null_actual_finish(id){
            var parent = gantt.getTask(id);
            
            parent.actual_finish = 'N/A';
            parent.progress = 0;
            //max_actual_finish = null;
            gantt.updateTask(id);
        }
        //Ends here
        var savelist = gantt.getTaskByTime();
        //var savelist = records;
        var Errorflag ='false';
        
        gantt.attachEvent("onLightbox", function (id){
            //console.log('inside lightbox'+id);
            var task = gantt.getTask(id);
            var split = task.split;
        });
        
        var serdata = gantt.getTaskByTime();//assigning Gantt data for Navigation
        
        gantt.attachEvent("onLightboxSave", function(id, task, is_new){
            console.log('onLightboxSave called')
            var sDate =task.start_date;
            if(task.text.toUpperCase()==="EFFECTIVE DATE"){	
                task.calendar_id='custom';	
            }else
                task.calendar_id='Normal';
            serdata.push(task);
            savelist.push(task);
            var Today = gantt.date.convert_to_utc(new Date());
            var parseIntYearLabel = parseInt(YearLabel);
            var start_date = task.start_date;
            var Todaycopy = Today;
            Todaycopy = Todaycopy.setFullYear(Todaycopy.getFullYear() + parseIntYearLabel);
            var Todaycopy0 = gantt.date.convert_to_utc(new Date(Todaycopy));
            var TodaycopyYear = Todaycopy0.getFullYear();
            var currentyear = gantt.date.convert_to_utc(new Date());
            currentyear = currentyear.setFullYear(currentyear.getFullYear() - 1);
            currentyear = gantt.date.convert_to_utc(new Date(currentyear));
            var StartDateYear = start_date.getFullYear();
            var CurrentYear = currentyear.getFullYear();
            //alert(CurrentYear);
            
            if(StartDateYear > TodaycopyYear || StartDateYear < CurrentYear)
            {
                
                document.getElementById("StartdateValid").style.display = 'block';
                setTimeout(closestartdateValid,2700);
                task.start_date = gantt.date.convert_to_utc(new Date(startdate));
                //task.duration =1;
                return false;
                
            }
            
            if(task.parent >0)
            {
                Null_actual_finish(task.parent)
                
            }  
            
            
            if(task.type == 'project')
            {
                task.split = "[false]";
                task.start_date = gantt.date.convert_to_utc(new Date(startdate));
                task.duration =1;
                //gantt.updateTask(id);
            }
            if(task.split == 'true'|| task.split == "[true]")
            {
                task.dashboard = 'true';
                task.checked ='true';
            }
            /*else{
                task.dashboard = 'false';
                task.checked ='false';
            }*/
            
            //validations startes here
            if(task.text == null || task.text ==''|| task.text == undefined)
            {
                document.getElementById("warningToastFortext").style.display = 'block';
                setTimeout(closewarningText,1000);                
                return false;
            }
            
            if(task.type != 'project')
            {
                if(task.owner_id.length <= 0 )
                {
                    document.getElementById("warningToastForres").style.display = 'block';
                    setTimeout(closewarningres,1000); 
                    return false;
                }
            }
            //ends here
            if((task.split =='true' || task.split =='[true]') && task.type != 'project')
            {
                task.color='#C32B9F';
                //return "Taskcolor";
            }
            else
            {
                task.color='';
            }
            
            if(task.type == 'project')
            {
                task.owner_id =[];
            }
            
            var startdt = gantt.date.convert_to_utc(new Date(startdate));
            
            
            /*  if((task.predecessors == null || task.predecessors =='')&& (task.actual_finish == null || task.actual_finish =='' || task.actual_finish =='N/A' || task.actual_finish == undefined))
            {
                
                task.start_date = startdt;
                task.duration = 1;
                task.end_date  = gantt.calculateEndDate({start_date: startdt, duration: task.duration});
            }*/
            
            //actual finish project rollup starts here
            var parenttaskId;
            var parenttasktype;
            var restype;
            if(gantt.getParent(task.id) !=0)
            {
                parenttaskId = gantt.getParent(task.id);
                parenttasktype = gantt.getTask(parenttaskId);
                parenttasktype.type = 'project';
                //parenttasktype.actual_finish = 'N/A';
                parenttasktype.split = "[false]";
                parenttasktype.color='';
                gantt.updateTask(parenttasktype.id);
            }  
            
            // ends here
            var new_linked_ids = [];
            var predecessors_array = [];
            
            if (task.predecessors) predecessors_array = task.predecessors.split(",");
            var new_link =[];
            var link_type;
            var myString;
            var source ='';
            for (var j = 0; j < predecessors_array.length; j++) {
                link_type ='';
                myString='';
                myString = predecessors_array[j];
                
                myString = myString.replace(/(?![+-]?\d*\.?\d+|e[+-]\d+)[^0-9]/g,'');
                
                
                if(myString.includes("+"))
                {
                    myString = myString.split("+");
                    myString = myString[0];
                    
                }
                
                else if(myString.includes("-"))
                {
                    myString = myString.split("-");
                    myString = myString[0];
                }
                
                
                
                link_type = parse_link_type(predecessors_array[j]);
                
                for(var k = 0; k < savelist.length; k++)
                {
                    
                    
                    if(savelist[k].RowNum == myString && savelist[k].id != null)
                    {
                        if(gantt.isTaskExists(savelist[k].id))
                        {
                            var new_linked_ids1 =savelist[k].id;
                            new_linked_ids.push(new_linked_ids1);
                        }
                        
                    }
                    
                    else if(savelist[k].RowNum == myString)
                    {
                        if(gantt.isTaskExists(savelist[k].projId))
                        {
                            var new_linked_ids1 = savelist[k].projId ;
                            new_linked_ids.push(new_linked_ids1);
                        }
                        
                    }
                    
                }
            }
            var links = task.$target;
            var obsolete_links = [];
            var valid_link = 0;
            //looking for obsolete links
            
            
            for(var i = 0; i < links.length; i++){
                
                var obsolete_controller = 1;
                var link = gantt.getLink(links[i]);
                if (link.source){
                    var temp_task = gantt.getTask(link.source);
                    if (temp_task) {
                        var pred = gantt.getTask(link.source).id
                        for (var K = 0; K < new_linked_ids.length; K++) {
                            if (new_linked_ids[k] == pred) obsolete_controller = 0;
                        }
                    }
                    if (obsolete_controller) obsolete_links.push(link.id)
                        }
            }
            //delete all obsolete links
            
            
            for (var i = 0; i < obsolete_links.length; i++) 
            {
                gantt.deleteLink(obsolete_links[i]);
            }
            
            var new_link1 =[];
            var predecessors_array1 = [];
            
            if (task.predecessors) 
            {
                
                task.predecessors = task.predecessors.replace(/\s*,\s*/g, ",");
                task.predecessors = task.predecessors.replace(/,\s*$/, "");
                predecessors_array1 = task.predecessors.split(",");
            }
            for (var m = 0; m < predecessors_array1.length; m++) {
                // var predecessor_id = parseFloat(predecessors_array1[m]);
                var resmyString ='';
                predeString = predecessors_array1[m];
                if(predeString.charAt(0) === '-' || predeString.charAt(0) === '+')
                {
                    predeString = predeString.substr(1);
                    
                    
                }
                else if (isNaN(predeString.charAt(0))){
                    predeString ='';
                    document.getElementById("predecErrMsg").style.display = 'block';
                    setTimeout(closepredecErrMsg,1200); 
                    return false;    
                }
                predecessors_array1[m] = predeString;
                resmyString = predecessors_array1[m];
                
                resmyString = resmyString.replace(/(?![+-]?\d*\.?\d+|e[+-]\d+)[^0-9]/g,'');
                
                if(resmyString.includes("+"))
                {
                    
                    resmyString = resmyString.split("+");
                    resmyString = resmyString[0];
                    
                    
                }
                
                else if(resmyString.includes("-"))
                {
                    
                    resmyString = resmyString.split("-");
                    resmyString = resmyString[0];
                    
                }
                var poslag ='';
                var neglag ='';
                if(predecessors_array1[m].includes("+"))
                {
                    
                    poslag = predecessors_array1[m].split("+");
                }
                else if(predecessors_array1[m].includes("-"))
                {
                    
                    neglag = predecessors_array1[m].split("-");
                    
                }
                var LagSign ='';
                
                if(neglag !=null && neglag != 'undefined' && neglag != ''){
                    var naglagval = parseInt(neglag[1]);
                    if(naglagval == 0)
                    {
                        naglagval = naglagval;
                    }
                    else{
                        naglagval = '-'+naglagval;
                        
                    }
                    //alert('naglagval>>>>'+naglagval);
                    
                    LagSign = naglagval;
                    
                }
                
                
                if(poslag !=null && poslag != 'undefined' && poslag != ''){
                    
                    var poslagval = parseInt(poslag[1]);
                    //poslagval ='+'+poslagval;
                    LagSign = poslagval;
                }
                
                
                var lagres ='';
                if(isNaN(LagSign)){
                    lagres = 0; 
                    //lagres = '+'+0;
                }else{
                    
                    lagres = LagSign;
                    
                }
                //alert('lagres>>>>>'+lagres);
                
                
                for(var l = 0; l < savelist.length; l++)
                {
                    
                    if(savelist[l].RowNum == resmyString && savelist[l].id != null)
                    {
                        
                        if(gantt.isTaskExists(savelist[l].id))
                        {
                            if(savelist[l].RowNum == gantt.getTask(savelist[l].id).RowNum)
                            {
                                source=savelist[l].id;
                            }
                            
                        }
                        
                    }
                    
                    else if(savelist[l].RowNum == resmyString)
                    {
                        if(gantt.isTaskExists(savelist[l].projId))
                        {
                            source=savelist[l].projId;
                        }
                    }
                }
                var ParentId = gantt.getParent(task.id);
                if(source == task.id)
                {
                    
                    document.getElementById("warningToastForPred1").style.display = 'block';
                    //gantt.hideLightbox();
                    setTimeout(closewarningToastForPred1,2200); 
                    return false;
                    
                }
                else if( source == null || source =='' || source == undefined)
                {
                    document.getElementById("warningToastForPred2").style.display = 'block';
                    //gantt.hideLightbox();
                    setTimeout(closewarningToastForPred2,2200); 
                    return false
                }
                    else if(source == ParentId)
                    {
                        document.getElementById("warningToastForPred").style.display = 'block';
                        //gantt.hideLightbox();
                        setTimeout(closewarningToastForPred,2200);
                        return false;
                    }
                var link_type = parse_link_type(predecessors_array1[m]);
                
                var new_link1 = { source: source, target: task.id, type: link_type,lag:lagres} 
                var isCircular = gantt.isCircularLink(new_link1);
                if(isCircular == false){
                    gantt.addLink(new_link1);
                }
                else{
                    
                    document.getElementById("CircularLoopValid").style.display = 'block';
                    setTimeout(closeCircularLoopValid,2700);
                    return false;
                }
                
            }
            
            var links = task.$target;
            
            var labels = [];
            for(var i = 0; i < links.length; i++){
                var link = gantt.getLink(links[i]);
                var pred = gantt.getTask(link.source);
                
                var typ = link.type;
                var lag = link.lag;
                if(typ == 0){
                    typedup = 'FS';
                }
                else if(typ == 1){
                    typedup = 'SS';
                }
                    else if(typ == 2){
                        typedup = 'FF';
                    }
                        else if(typ == 3){
                            typedup = 'SF';
                        }
                var sign;
                if(lag >= 0){
                    sign ='+';
                }
                else{
                    sign ='';  
                }
                var index = pred.$index;
                
                index = index+1;
                
                if(lag == null || lag == '' || lag == undefined)
                {
                    lag =0;
                    sign ='+';
                    if(labels.indexOf(gantt.getTaskNumber(pred)+typedup+sign+lag+'days') == -1)
                    {
                        labels.push(gantt.getTaskNumber(pred)+typedup+sign+lag+'days');
                    }
                }
                else
                {
                    if(labels.indexOf(gantt.getTaskNumber(pred)+typedup+sign+lag+'days') == -1)
                    {
                        labels.push(gantt.getTaskNumber(pred)+typedup+sign+lag+'days');
                    }
                }
                task.predecessors = labels.join(", "); 
            }
            
            gantt.updateTask(task.id,task);
            gantt.autoSchedule(task.id);
            gantt.render();
            return true;
        }) 
        
        
        
        gantt.attachEvent("onAfterLinkAdd", function(id,item){
            console.log('onAfterLinkAdd called');
            //alert(JSON.stringify(item));
            var linktarget = item.target;
            var taskdet = gantt.getTask(linktarget);
            var links = taskdet.$target;
            
            console.log(links)
            var labels = [];
            for(var i = 0; i < links.length; i++){
                var link = gantt.getLink(links[i]);
                var pred = gantt.getTask(link.source);
                
                var typ = link.type;
                var lag = link.lag;
                if(typ == 0){
                    typedup = 'FS';
                }
                else if(typ == 1){
                    typedup = 'SS';
                }
                    else if(typ == 2){
                        typedup = 'FF';
                    }
                        else if(typ == 3){
                            typedup = 'SF';
                        }
                var sign;
                if(lag >= 0){
                    sign ='+';
                }
                else{
                    sign ='';  
                }
                var index = pred.$index;
                
                index = index+1;
                
                if(lag == null || lag == '' || lag == undefined)
                {
                    lag =0;
                    sign ='+';
                    if(labels.indexOf(gantt.getTaskNumber(pred)+typedup+sign+lag+'days') == -1)
                    {
                        labels.push(gantt.getTaskNumber(pred)+typedup+sign+lag+'days');
                    }
                }
                else
                {
                    if(labels.indexOf(gantt.getTaskNumber(pred)+typedup+sign+lag+'days') == -1)
                    {
                        labels.push(gantt.getTaskNumber(pred)+typedup+sign+lag+'days');
                    }
                }
                taskdet.predecessors = labels.join(", ");
            }
            
            
        });
        
        var oldtaskpredecessor ='';
        var olddashboard ='';
        var oldchecked ='';
        gantt.attachEvent("onBeforeTaskUpdate", function(id,new_item){
            console.log('onBeforeTaskUpdate part 2');
            var oldtask = gantt.getTask(id);
            oldtaskpredecessor = oldtask.predecessors;
            olddashboard = oldtask.dashboard;
            oldchecked = oldtask.checked;
            
        })
        
        
        gantt.attachEvent("onAfterTaskUpdate", function(id, item){
            console.log('onAfterTaskUpdate called');
            var task = item;
            if(task.type == 'project')
            {
                task.owner_id =[];
            }
            // code for validation External and Dashboard of milestone
            /* if(task.split =='true' || task.split =='[true]')
            {
                if(task.dashboard =='false' || task.split =='[false]')
                {
                    document.getElementById("dashbordWarningforMilestone").style.display = 'block';
                    setTimeout(closedashbordWarningforMilestone,2000);
                    task.dashboard = 'true';
                    
                }
                if(task.checked =='false' || task.checked =='[false]')
                {
                    document.getElementById("checkboxWarningforMilestone").style.display = 'block';
                    setTimeout(closecheckboxWarningforMilestone,2000);
                    task.checked = 'true';
                }
            }
            */
            var startdt = gantt.date.convert_to_utc(new Date(startdate));
            
            
            /*   if((task.predecessors == null || task.predecessors =='')&& (task.actual_finish == null || task.actual_finish =='' || task.actual_finish =='N/A' || task.actual_finish == undefined))
            {
                
                task.start_date = startdt;
                task.duration = 1;
                task.end_date  = gantt.calculateEndDate({start_date: startdt, duration: task.duration});
            }*/
            
            if((oldtaskpredecessor == null || oldtaskpredecessor == '')&& (task.actual_finish == null || task.actual_finish =='' || task.actual_finish =='N/A' || task.actual_finish == undefined))
            {
                task.start_date = task.start_date;
                // task.duration = task.duration;
                // task.end_date  = gantt.calculateEndDate({start_date: startdt, duration: task.duration});
            }
            else if((oldtaskpredecessor != null && oldtaskpredecessor != '') &&
                    (task.predecessors == null || task.predecessors == null))
            {
                task.start_date = startdt;
                task.duration = 1;
                task.end_date  = gantt.calculateEndDate({start_date: startdt, duration: task.duration});
            }
            if(task.text.toUpperCase()==="EFFECTIVE DATE"){	
                task.calendar_id='custom'	
            }
            else
                task.calendar_id='Normal';
            
            if(task.parent >0 && task.actual_finish != null && task.actual_finish !='' && task.actual_finish != undefined && task.actual_finish !='N/A'){
                parenttasktype = gantt.getTask(task.parent);
                childIds = gantt.getChildren(task.parent);
                var ChildTask =[];
                for(var child =0 ; child < childIds.length ; child++)
                {
                    
                    var childtaskInd = gantt.getTask(childIds[child]);
                    ChildTask.push(childtaskInd);
                }
                var dates =[];
                if(ChildTask.length > 0){
                    for(var d=0 ; d<ChildTask.length; d++)
                    {
                        dates.push(ChildTask[d].actual_finish);
                    }
                    
                }
                
                var maxDate=new Date(Math.max.apply(null,dates));
                var today = new Date();
                
                if(maxDate =='Invalid Date' || maxDate > today){
                    //parenttasktype.actual_finish = 'N/A';
                    
                }
                else{
                    //parenttasktype.actual_finish = maxDate;
                    get_max_actual_finish(task.parent)
                }
                
                
            }
            
            if (task.parent > 0 && task.actual_finish =='N/A') {
                
                Null_actual_finish(task.parent);
            }
            if(task.actual_finish != null && task.actual_finish !='' && task.actual_finish != undefined && task.actual_finish !='N/A')
            {
                
                task.auto_scheduling = false;
                
                
            }
            else{
                task.auto_scheduling = true;
            }
            /*
                
            var new_linked_ids = [];
            var predecessors_array = [];
            //alert('task.predecessors>>>'+task.predecessors);
            if (task.predecessors) predecessors_array = task.predecessors.split(",");
            var new_link =[];
            var link_type;
            var myString;
            for (var j = 0; j < predecessors_array.length; j++) {
                myString = predecessors_array[j];
                //alert('myString>>>'+myString);
                myString = myString.replace(/(?![+-]?\d*\.?\d+|e[+-]\d+)[^0-9]/g,'');
                
               
                if(myString.includes("+"))
                {
                    myString = myString.split("+");
                    myString = myString[0];
                    
                }
                
                else if(myString.includes("-"))
                {
                    myString = myString.split("-");
                    myString = myString[0];
                }

                
                //var new_linked = parseFloat(predecessors_array[j]);
                link_type = parse_link_type(predecessors_array[j]);
                
                for(var k = 0; k < savelist.length; k++)
                {
                    
                    
                    if(savelist[k].RowNum == myString && savelist[k].id != null)
                    {
                        //alert('inside if>>>>>>>>');
                        new_linked_ids1 =savelist[k].id;
                        new_linked_ids.push(new_linked_ids1);
                    }
                    
                    else if(savelist[k].RowNum == myString)
                    {
                        //alert('inside else if>>>>>>>>');
                        // alert('savelist[k].projId>>>'+savelist[k].projId);
                        new_linked_ids1 = savelist[k].projId ;
                        new_linked_ids.push(new_linked_ids1);
                        
                    }
                    
                }
            }
            var links = task.$target;
            var obsolete_links = [];
            var valid_link = 0;
            //looking for obsolete links
                         if(predecessors_array != null && predecessors_array !='' && predecessors_array != undefined){

            for(var i = 0; i < links.length; i++){
                //alert('inside onsavebox');
                var obsolete_controller = 1;
                var link = gantt.getLink(links[i]);
                if (link.source){
                    var temp_task = gantt.getTask(link.source);
                    if (temp_task) {
                        var pred = gantt.getTask(link.source).id
                        for (var K = 0; K < new_linked_ids.length; K++) {
                            if (new_linked_ids[k] == pred) obsolete_controller = 0;
                        }
                        //console.log('obsolete_controller>>'+obsolete_controller);
                        }
                        if (obsolete_controller) obsolete_links.push(link.id)
                        //console.log('obsolete_links>>'+obsolete_links);
                    
                        }
            }
                             }
            //delete all obsolete links
            
            
            for (var i = 0; i < obsolete_links.length; i++) 
            {
                gantt.deleteLink(obsolete_links[i]);
            }
            
            var new_link1 =[];
            var predecessors_array1 = [];
            if (task.predecessors) predecessors_array1 = task.predecessors.split(",");
            for (var m = 0; m < predecessors_array1.length; m++) {
                // var predecessor_id = parseFloat(predecessors_array1[m]);
                var resmyString;
                resmyString = predecessors_array1[m];
                
                resmyString = resmyString.replace(/(?![+-]?\d*\.?\d+|e[+-]\d+)[^0-9]/g,'');
               
                if(resmyString.includes("+"))
                {
                    
                    resmyString = resmyString.split("+");
                    resmyString = resmyString[0];
                    
                    
                }
                
                else if(resmyString.includes("-"))
                {
                    
                    resmyString = resmyString.split("-");
                    resmyString = resmyString[0];
                    
                }
                var poslag;
                var neglag;
                if(predecessors_array1[m].includes("+"))
                {
                    
                    poslag = predecessors_array1[m].split("+");
                }
                else if(predecessors_array1[m].includes("-"))
                {
                    
                    neglag = predecessors_array1[m].split("-");
                    
                }
                var LagSign;
                
                if(neglag !=null && neglag != 'undefined' && neglag != ''){
                    var naglagval = parseInt(neglag[1]);
                    if(naglagval == 0)
                    {
                        naglagval = naglagval;
                    }
                    else{
                        naglagval = '-'+naglagval;
                        
                    }
                    //alert('naglagval>>>>'+naglagval);
                    
                    LagSign = naglagval;
                    
                }
                
                
                if(poslag !=null && poslag != 'undefined' && poslag != ''){
                    
                    var poslagval = parseInt(poslag[1]);
                    //poslagval ='+'+poslagval;
                    LagSign = poslagval;
                }
                
                
                var lagres;
                if(isNaN(LagSign)){
                    lagres = 0; 
                    //lagres = '+'+0;
                }else{
                    
                    lagres = LagSign;
                    
                }
                //alert('lagres>>>>>'+lagres);
                
                
                for(var l = 0; l < savelist.length; l++)
                {
                    if(savelist[l].RowNum == resmyString && savelist[l].id != null)
                    {
                        
                        var source=savelist[l].id;
                        
                    }
                    
                    else if(savelist[l].RowNum == resmyString)
                    {
                      
                        //alert('create inside else if>>>>>>>>');
                        // alert('create insidesavelist[k].projId>>>'+savelist[l].projId);
                        var source=savelist[l].projId;
                    }
                }
                
                var link_type = parse_link_type(predecessors_array1[m]);
                 var ParentId = gantt.getParent(task.id);
                  
                if(source == task.id )
                {
                    //task.predecessors ='';
                    if(Errorflag == 'true')
                    {
                    

                        }
                    else if(Errorflag == 'false')
                    {
                      document.getElementById("warningToastForPred1").style.display = 'none';

                    }
                    //document.getElementById("warningToastForPred1").style.display = 'block';
                    setTimeout(closewarningToastForPred1,2200); 
                    //gantt.hideLightbox();
                    return false
               
                 }
                else if( source == null || source =='' || source == undefined)
                    {
                        document.getElementById("warningToastForPred2").style.display = 'block';
                        //gantt.hideLightbox();
                        setTimeout(closewarningToastForPred2,2200); 
                        return false
                    }
                else if(source == ParentId)
                 {
                     //task.predecessors ='';
                    document.getElementById("warningToastForPred").style.display = 'block';
                     //gantt.hideLightbox();
                    setTimeout(closewarningToastForPred,2200); 
                     return false;
                 }
               
                var new_link1 = { source: source, target: task.id, type: link_type,lag:lagres} 
                gantt.addLink(new_link1);
                   
                
            }
                
               //task.predecessors
            */
            // updateEffectiveDatePred(task);
            return true;
        });
        
        //var tasklist =records;
        var tasklist = gantt.getTaskByTime();
        
        var test=0;
        
        
        gantt.attachEvent("onAfterTaskAdd", function(id,item){
            console.log('onAfterTaskAdd called');	
            if(item.text.toUpperCase()==="EFFECTIVE DATE"){	
                item.calendar_id='custom';	
            }
            else
                item.calendar_id='Normal';	
            // serdata.push(item);//pushing New Gantt data for Navigation
            tasklist.push(item);
            
            var task = item;
            
            if(task.split=='true')
            {
                
                task.dashboard ='true';
                task.checked ='true';
            }
            else
            {
                task.dashboard = 'false';
                task.checked ='false';
            }
            
            
            var new_linked_ids = [];
            var predecessors_array = [];
            
            if (task.predecessors) predecessors_array = task.predecessors.split(",");
            var new_link =[];
            var link_type;
            var myString;
            var source ='';
            for (var j = 0; j < predecessors_array.length; j++) {
                link_type ='';
                myString='';
                myString = predecessors_array[j];
                
                myString = myString.replace(/(?![+-]?\d*\.?\d+|e[+-]\d+)[^0-9]/g,'');
                
                
                if(myString.includes("+"))
                {
                    myString = myString.split("+");
                    myString = myString[0];
                    
                }
                
                else if(myString.includes("-"))
                {
                    myString = myString.split("-");
                    myString = myString[0];
                }
                
                
                
                link_type = parse_link_type(predecessors_array[j]);
                
                for(var k = 0; k < tasklist.length; k++)
                {
                    
                    
                    if(tasklist[k].RowNum == myString && tasklist[k].id != null)
                    {
                        if(gantt.isTaskExists(tasklist[k].id))
                        {
                            var new_linked_ids1 =tasklist[k].id;
                            new_linked_ids.push(new_linked_ids1);
                        }
                        
                    }
                    
                    else if(tasklist[k].RowNum == myString)
                    {
                        if(gantt.isTaskExists(tasklist[k].projId))
                        {
                            var new_linked_ids1 = tasklist[k].projId;
                            new_linked_ids.push(new_linked_ids1);
                        }
                        
                    }
                    
                }
            }
            var links = task.$target;
            var obsolete_links = [];
            var valid_link = 0;
            //looking for obsolete links
            
            
            for(var i = 0; i < links.length; i++){
                
                var obsolete_controller = 1;
                var link = gantt.getLink(links[i]);
                if (link.source){
                    var temp_task = gantt.getTask(link.source);
                    if (temp_task) {
                        var pred = gantt.getTask(link.source).id
                        for (var K = 0; K < new_linked_ids.length; K++) {
                            if (new_linked_ids[k] == pred) obsolete_controller = 0;
                        }
                    }
                    if (obsolete_controller) obsolete_links.push(link.id)
                        }
            }
            //delete all obsolete links
            
            
            for (var i = 0; i < obsolete_links.length; i++) 
            {
                gantt.deleteLink(obsolete_links[i]);
            }
            
            var new_link1 =[];
            var predecessors_array1 = [];
            
            if (task.predecessors) 
            {
                
                task.predecessors = task.predecessors.replace(/\s*,\s*/g, ",");
                task.predecessors = task.predecessors.replace(/,\s*$/, "");
                predecessors_array1 = task.predecessors.split(",");
            }
            for (var m = 0; m < predecessors_array1.length; m++) {
                // var predecessor_id = parseFloat(predecessors_array1[m]);
                var resmyString ='';
                resmyString = predecessors_array1[m];
                
                resmyString = resmyString.replace(/(?![+-]?\d*\.?\d+|e[+-]\d+)[^0-9]/g,'');
                
                if(resmyString.includes("+"))
                {
                    
                    resmyString = resmyString.split("+");
                    resmyString = resmyString[0];
                    
                    
                }
                
                else if(resmyString.includes("-"))
                {
                    
                    resmyString = resmyString.split("-");
                    resmyString = resmyString[0];
                    
                }
                var poslag ='';
                var neglag ='';
                if(predecessors_array1[m].includes("+"))
                {
                    
                    poslag = predecessors_array1[m].split("+");
                }
                else if(predecessors_array1[m].includes("-"))
                {
                    
                    neglag = predecessors_array1[m].split("-");
                    
                }
                var LagSign ='';
                
                if(neglag !=null && neglag != 'undefined' && neglag != ''){
                    var naglagval = parseInt(neglag[1]);
                    if(naglagval == 0)
                    {
                        naglagval = naglagval;
                    }
                    else{
                        naglagval = '-'+naglagval;
                        
                    }
                    //alert('naglagval>>>>'+naglagval);
                    
                    LagSign = naglagval;
                    
                }
                
                
                if(poslag !=null && poslag != 'undefined' && poslag != ''){
                    
                    var poslagval = parseInt(poslag[1]);
                    //poslagval ='+'+poslagval;
                    LagSign = poslagval;
                }
                
                
                var lagres ='';
                if(isNaN(LagSign)){
                    lagres = 0; 
                    //lagres = '+'+0;
                }else{
                    
                    lagres = LagSign;
                    
                }
                //alert('lagres>>>>>'+lagres);
                
                
                for(var l = 0; l < tasklist.length; l++)
                {
                    
                    if(tasklist[l].RowNum == resmyString && tasklist[l].id != null)
                    {
                        if(gantt.isTaskExists(tasklist[l].id))
                        {
                            source=tasklist[l].id;
                        }
                        
                    }
                    
                    else if(tasklist[l].RowNum == resmyString)
                    {
                        if(gantt.isTaskExists(tasklist[l].projId))
                        {
                            source=tasklist[l].projId;
                        }
                    }
                }
                var ParentId = gantt.getParent(task.id);
                if(source == task.id)
                {
                    
                    document.getElementById("warningToastForPred1").style.display = 'block';
                    //gantt.hideLightbox();
                    setTimeout(closewarningToastForPred1,2200); 
                    return false;
                    
                }
                else if( source == null || source =='' || source == undefined)
                {
                    document.getElementById("warningToastForPred2").style.display = 'block';
                    //gantt.hideLightbox();
                    setTimeout(closewarningToastForPred2,2200); 
                    return false
                }
                    else if(source == ParentId)
                    {
                        document.getElementById("warningToastForPred").style.display = 'block';
                        //gantt.hideLightbox();
                        setTimeout(closewarningToastForPred,2200);
                        return false;
                    }
                var link_type = parse_link_type(predecessors_array1[m]);
                
                var new_link1 = { source: source, target: task.id, type: link_type,lag:lagres} 
                var isCircular = gantt.isCircularLink(new_link1);
                if(isCircular == false){
                    gantt.addLink(new_link1);
                    
                }
                else{
                    
                    document.getElementById("CircularLoopValid").style.display = 'block';
                    setTimeout(closeCircularLoopValid,2700);
                    return false;
                }
                
            }
            
            gantt.batchUpdate(function () {
                var taskcount = 0;
                var task = gantt.getTaskByTime();
                for(var i=0; i<task.length ; i++)
                {
                    taskcount = taskcount+1;
                    if(taskcount == task.length){
                        //document.getElementById("spinner").style.display = "none";
                    }
                    var taskpred = task[i].$target;
                    var taskid =[];
                    if(task[i].text.toUpperCase()==="EFFECTIVE DATE"){	
                        task[i].calendar_id='custom';	
                    }
                    
                    //console.log('taskpred>>>>>'+taskpred);
                    if(task[i].$target == null || task[i].$target == undefined || task[i].$target == '' || task[i].$target.length == 0)
                    {
                        task[i].predecessors = '';
                        
                        // Making project to Task, when deleted alls subtasks of Project
                        if(task[i].id == ParentVal)
                        {
                            if(gantt.getChildren(task[i].id) == null || gantt.getChildren(task[i].id) == '' || gantt.getChildren(task[i].id) == undefined)
                            {
                                task[i].type ='task' ;
                                task[i].start_date = gantt.date.convert_to_utc(new Date(startdate));
                                task[i].duration = 1;
                                task[i].end_date  = gantt.calculateEndDate({start_date: task[i].start_date, duration: task[i].duration});
                            }
                        }
                        // Ends Here
                        if(deleteTaskTarget.includes(task[i].id))
                        {
                            
                            if(task[i].actual_finish == null || task[i].actual_finish == '' || task[i].actual_finish == undefined || task[i].actual_finish == 'N/A')
                            {
                                var startdates = new Date(startdate)
                                task[i].start_date = gantt.date.convert_to_utc(new Date(startdate));
                                task[i].duration = task[i].duration;
                                task[i].end_date  = gantt.calculateEndDate({start_date: task[i].start_date, duration: task[i].duration});
                            }
                            if(task[i].id != null && task[i].id != undefined)
                            {
                                //taskid.push(task[i].id);
                                //gantt.updateTask(task[i].id,task[i]);
                                //gantt.autoSchedule(task[i].id);
                            }
                        }
                    }
                    else if(task[i].$target.length > 0)
                    {
                        // Making project to Task, when deleted alls subtasks of Project
                        if(task[i].id == ParentVal)
                        {
                            if(gantt.getChildren(task[i].id) == null || gantt.getChildren(task[i].id) == '' || gantt.getChildren(task[i].id) == undefined)
                            {
                                task[i].type ='task' ;
                                task[i].start_date = gantt.date.convert_to_utc(new Date(startdate));
                                task[i].duration = 1;
                                task[i].end_date  = gantt.calculateEndDate({start_date: task[i].start_date, duration: task[i].duration});
                            }
                        }
                        // Ends Here
                        
                        
                        var links = task[i].$target;
                        var labels = [];
                        var types = [];
                        
                        for(var j = 0; j < links.length; j++){
                            var link = gantt.getLink(links[j]);
                            //alert('link'+JSON.stringify(link));
                            var pred = gantt.getTask(link.source);
                            // alert('pred'+JSON.stringify(pred));
                            var index = pred.$index;
                            index = index+1;
                            var typ = link.type;
                            var lag = link.lag;
                            if(typ == 0){
                                typedup = 'FS';
                            }
                            else if(typ == 1){
                                typedup = 'SS';
                            }
                                else if(typ == 2){
                                    typedup = 'FF';
                                }
                                    else if(typ == 3){
                                        typedup = 'SF';
                                    }
                            var sign;
                            if(lag >= 0){
                                sign ='+';
                            }
                            else{
                                sign ='';  
                            }
                            
                            //alert('lag>>'+lag);
                            if(lag == null || lag == '' || lag == undefined)
                            {
                                lag =0;
                                sign ='+';
                                if(labels.indexOf(gantt.getTaskNumber(pred)+typedup+sign+lag+'days') == -1)
                                {
                                    labels.push(gantt.getTaskNumber(pred)+typedup+sign+lag+'days');
                                }
                            }
                            else
                            { 
                                if(labels.indexOf(gantt.getTaskNumber(pred)+typedup+sign+lag+'days') == -1)
                                {
                                    labels.push(gantt.getTaskNumber(pred)+typedup+sign+lag+'days');
                                }
                            }
                            task[i].predecessors = labels.join(", ");
                            
                            if(task[i].id != null && task[i].id != undefined){
                                
                            }
                        }
                    }
                    if(task[i].text.toUpperCase()==="EFFECTIVE DATE"){	
                        task[i].calendar_id='custom';	
                    }else
                task.calendar_id='Normal';
                    gantt.updateTask(task[i].id,task[i]);
                    gantt.refreshTask(task[i].id);
                }
            });
            
            gantt.autoSchedule();
            gantt.render();
            
            
            
            
            
        });
        
        
        function selectAllExt(){
            
            isAllExtChecked = document.querySelector('.ext-selectAll').checked;
            
            gantt.batchUpdate(function () {
                
                
                let tasks = gantt.getTaskByTime();
                
                for(var i=0; i<tasks.length; i++){
                    tasks[i].checked = isAllExtChecked? 'true':'false';
                    gantt.updateTask(tasks[i].id,tasks[i]);
                }
                setTimeout(function(){
                    document.querySelector('.ext-selectAll').checked = isAllExtChecked
                    console.log('settimeout called after refresh',isAllExtChecked);
                }, 200);
                
                
            });
            
        }        
        
        function parse_link_type(compressed_value){
            
            if (compressed_value.toLowerCase().indexOf('fs') > -1) return '0';
            if (compressed_value.toLowerCase().indexOf('ss') > -1) return '1';
            if (compressed_value.toLowerCase().indexOf('ff') > -1) return '2';
            if (compressed_value.toLowerCase().indexOf('sf') > -1) return '3';
            return '0';
        }
        //------resource code start 
        // code to resource functionality 
        function shouldHighlightTask(task){
            var store = gantt.$resourcesStore;
            var taskResource = task[gantt.config.resource_property],
                selectedResource = store.getSelectedId();
            if(taskResource == selectedResource || store.isChildOf(taskResource, selectedResource)){
                return true;
            }
        }
        
        gantt.templates.grid_row_class = function(start, end, task){
            var css = [];
            if(gantt.hasChild(task.id)){
                css.push("folder_row");
            }
            
            if(task.$virtual){
                css.push("group_row")
            }
            
            if(shouldHighlightTask(task)){
                css.push("highlighted_resource");
            }
            if((task.split == "[true]"||task.split == "true")&& task.type != 'project')
            {
                task.color = '#C32B9F';
                css.push("Taskcolor"); // to show the row as gray color 
            }
            if(task.type == 'project')
            {
                // task.color = '#C32B9F';
                css.push("projectcolor"); // to show the row as gray color 
            }
            
            return css.join(" ");
        };
        
        gantt.templates.task_row_class = function(start, end, task){
            if(shouldHighlightTask(task)){
                return "highlighted_resource";
            }
            return "";
        };
        
        gantt.templates.task_cell_class = function (task, date) {
            if (!gantt.isWorkTime({date: date, task: task}))
                return "week_end";
            return "";
        };
        
        gantt.templates.resource_cell_class = function(start_date, end_date, resource, tasks){
            var css = [];
            css.push("resource_marker");
            if (tasks.length <= 1) {
                css.push("workday_ok");
            } else {
                css.push("workday_over");
            }
            return css.join(" ");
        };
        
        gantt.templates.resource_cell_value = function(start_date, end_date, resource, tasks){
            var html = "<div>"
            if(resourceMode == "hours"){
                html += tasks.length * 8;
            }else{
                html += tasks.length;
            }
            html += "</div>";
            return html;
        };
        
        function shouldHighlightResource(resource){
            var selectedTaskId = gantt.getState().selected_task;
            if(gantt.isTaskExists(selectedTaskId)){
                var selectedTask = gantt.getTask(selectedTaskId),
                    selectedResource = selectedTask[gantt.config.resource_property];
                
                if(resource.id == selectedResource){
                    return true;
                }else if(gantt.$resourcesStore.isChildOf(selectedResource, resource.id)){
                    return true;
                }
            }
            return false;
        }
        
        var resourceTemplates = {
            grid_row_class: function(start, end, resource){
                var css = [];
                if(gantt.$resourcesStore.hasChild(resource.id)){
                    css.push("folder_row");
                    css.push("group_row");
                }
                if(shouldHighlightResource(resource)){
                    css.push("highlighted_resource");
                }
                return css.join(" ");
            },
            task_row_class: function(start, end, resource){
                var css = [];
                if(shouldHighlightResource(resource)){
                    css.push("highlighted_resource");
                }
                if(gantt.$resourcesStore.hasChild(resource.id)){
                    css.push("group_row");
                }
                
                return css.join(" ");
                
            }
        };
        
        var resourceConfig = {
            scale_height: 30,
            subscales: [],
            columns: [
                {
                    name: "name", label: "Name", tree:true, width:250, template: function (resource) {
                        console.log('resource.text>>'+resource.text);
                        return resource.text;
                    }, resize: true
                },
                {
                    name: "specialty", label: "Speciality", width:150, align:"center",template: function (resource) {
                        
                        return resource.specialty || "";
                    }, resize: true
                }
                
            ]
        };
        //------resource code stop 
        //delete gantt.config.types.project;
        delete gantt.config.types.milestone; // Remove milestone from Project Type
        gantt.locale.labels.section_text = "Task Name";
        gantt.locale.labels.section_resources = "Resources *";
        gantt.locale.labels.section_role = "Role *";
        gantt.locale.labels.section_predecessors = "Predecessors";
        gantt.locale.labels.section_Notes = "Task Comments";
        gantt.locale.labels.section_split = "Mark as Milestone";
        gantt.locale.labels.section_Additional_Comments = "Internal Comments";
        
        var opts = [
            {key:"true", label:""}                                       
        ];
        
        if(tempflag == true)
        {
            gantt.config.lightbox.sections = [
                {name: "text", height: 70, map_to: "text", type: "textarea", focus: true},
                {name: "predecessors", type: "textarea", map_to: 'predecessors', height: 38},
                {name: "type", type: "typeselect", map_to: "type"},
                {name: "split", type:"checkbox", map_to: "split", options:opts},
                //{name: "role", type: "checkbox", map_to: "users", options: getUserList(records)},
                {name: "role",height: 60, type:"multiselect", options: gantt.serverList("people"), map_to:"owner_id"},
                {name: "time", type: "duration",map_to:"auto",time_format: ["%m", "%d", "%Y"]},
                {name: "Notes", height: 70, map_to: "Notes", type: "textarea"},
                {name: "Additional_Comments", height: 70, map_to: "Additional_Comments", type: "textarea"}
            ];
            gantt.config.lightbox.project_sections = [
                {name: "text", height: 10, map_to: "text", type: "textarea", focus: true},
                {name: "predecessors", type: "textarea", map_to: 'predecessors', height: 38},
                {name: "type", type: "typeselect", map_to: "type"},
                //{name: "resources", type: "checkbox", map_to: "users", options: getUserList(records)},
                {name: "resources",height: 60, type:"multiselect", options: gantt.serverList("people"), map_to:"owner_id"},
                {name: "time", type: "duration",map_to:"auto",time_format: ["%m", "%d", "%Y"]},
                {name: "Notes", height: 10, map_to: "Notes", type: "textarea"},
                {name: "Additional_Comments", height: 70, map_to: "Additional_Comments", type: "textarea"}
            ];
            
        }else{
            
            gantt.config.lightbox.sections = [
                {name: "text", height: 10, map_to: "text", type: "textarea", focus: true},
                {name: "predecessors", type: "textarea", map_to: 'predecessors', height: 38},
                {name: "type", type: "typeselect", map_to: "type"},
                {name: "split", type:"checkbox", map_to: "split", options:opts},
                //{name: "resources", type: "checkbox", map_to: "users", options: getUserList(records)},
                {name: "resources",height: 60, type:"multiselect", options: gantt.serverList("people"), map_to:"owner_id"},
                {name: "time", type: "duration",map_to:"auto",time_format: ["%m", "%d", "%Y"]},
                {name: "Notes", height: 10, map_to: "Notes", type: "textarea"},
                {name: "Additional_Comments", height: 70, map_to: "Additional_Comments", type: "textarea"}
            ];
            
            gantt.config.lightbox.project_sections = [
                {name: "text", height: 10, map_to: "text", type: "textarea", focus: true},
                {name: "predecessors", type: "textarea", map_to: 'predecessors', height: 38},
                {name: "type", type: "typeselect", map_to: "type"},
                //{name: "resources", type: "checkbox", map_to: "users", options: getUserList(records)},
                {name: "resources",height: 60, type:"multiselect", options: gantt.serverList("people"), map_to:"owner_id"},
                {name: "time", type: "duration",map_to:"auto",time_format: ["%m", "%d", "%Y"]},
                {name: "Notes", height: 10, map_to: "Notes", type: "textarea"},
                {name: "Additional_Comments", height: 70, map_to: "Additional_Comments", type: "textarea"}
            ];
            
        }
        gantt.config.resource_store = "resource";
        gantt.config.resource_property = "owner_id";
        gantt.config.resource_store = "role";
        gantt.config.resource_property = "role";
        
        
        /* gantt.templates.rightside_text = function(start, end, task){
            if(task.type == gantt.config.types.milestone){
                task=task.type;
                return task.text;
            }
            return "";
        };*/
        
        var colContent = function (task) {
            return ('<a class="link" onclick="taskDetail('+task.id+')"><svg class="slds-icon slds-icon-text-default slds-icon--x-small"><use href="{!URLFOR($Resource.SLDS, '/assets/icons/utility-sprite/svg/symbols.svg#new_window')}"></use></svg></a>');
                    }
                    
                    
                    //var tasklist =records;
                    
                    function taskDetail(id, action){
                var recordid;
                var iddup = id;
                for(var i = 0; i < serdata.length; i++){
                    if(iddup == serdata[i].id){
                        if(serdata[i].sfdcid != null && serdata[i].sfdcid != ''&& serdata[i].sfdcid != undefined){
                            recordid =  serdata[i].sfdcid;
                            window.open('/'+recordid,'_blank');
                            return true;
                        }
                        else{
                            document.getElementById("warningToast").style.display = 'block'; 
                            setTimeout(closewarningToast,1200); 
                        }
                    }
                    /* else if(iddup != gantt.serialize().data[i].id)
                    {
                        document.getElementById("warningToast").style.display = 'block'; 
                        setTimeout(closewarningToast,1200); 
                    } */
                    
                }
            }
            /*gantt.attachEvent("onTaskRowClick", function(id,row){
                
                var checkbox = row.querySelector(".gantt-checkbox-column");
                console.log('id in event ::'+id);
                console.log('row in event ::'+row);
                console.log('checkbox in event ::'+checkbox);
                if(checkbox != null && checkbox != undefined)
                {
                    //alert('inside inner if');
                    if(checkbox){
                        //alert('inside if ');
                        checkbox.checked = !!checkbox.checked;
                        gantt.getTask(id).checked = checkbox.checked;
                        //alert.log('result in inner if:'+gantt.getTask(id).checked);
                        return false;
                    }
                    else{
                        //alert('result in inner else:'+gantt.getTask(id).checked);
                        //console.log('inside else checked?'+row.checked);
                        return false; 
                    }
                }
                else{
                    //alert('inside  outer else');
                    gantt.getTask(id).checked = row.checked;
                    tempche = gantt.getTask(id).checked
                    //alert('result in outer else:'+tempche);
                    return true;
                }
                
            });*/
            
            
            
            //for template flow 
            
            
            if(tempflag == true)
            {
                
                gantt.config.drag_progress = false;
                gantt.config.columns = [
                    {name:"add",width:40},
                    {name:"dashboard",label:'<svg class="slds-icon slds-icon-text-default slds-icon--medium slds-m-top_x-small" style="fill:rgba(0, 0, 0, 0.7);"><use href="{!URLFOR($Resource.SLDS, '/assets/icons/standard-sprite/svg/symbols.svg#metrics')}"></use></svg>',width: 30,min_width: 30,resize: true, template:function(task){
                     var boolVal = false;
                     if(task.dashboard == 'true'){
                     boolVal = true
                    }
                    var checked1 = !!boolVal ? " checked" : "";
                    return "<input onclick='dashboardcheck("+task.id+")' class='gantt-checkbox-column' type='checkbox' " +checked1+ "/>";
                    }
                    },
                    {name:"farol",label:"Status",width:50,min_width:50, align: "center", template:function(obj){
                    var color = statuscheck(obj);
                    return "<div class='column_icon' style=background-color:"+color+"></div>"} 
                    },
                    {
                    name: "buttons",label:'<svg class="slds-icon slds-icon-text-default slds-icon--x-small slds-m-top_medium" style="fill:rgba(0, 0, 0, 0.7);"><use href="{!URLFOR($Resource.SLDS, '/assets/icons/utility-sprite/svg/symbols.svg#new_window')}"></use></svg>',width: 40,min_width: 40,
                    template: colContent
                    },
                    {name:"checked", label:"Ext <input class='ext-selectAll' type='checkbox' onClick='selectAllExt();' "+isAllExtChecked+" />" ,width: 50,min_width: 50,
                    resize: true, 
                    template:function(task){
                    var boolVal = false;
                    if(task.checked == 'true'){
                    boolVal = true
                    }
                    var checked = !!boolVal ? " checked" : "";
                    return "<input onclick='checkbox_check("+task.id+")'  data-taskId='"+task.id+"'  class='gantt-checkbox-column extCheck' type='checkbox' " +checked+ "/>";
                    }
                    },
                    {name:"RowNum",label:"Row #", width: 50,min_width: 50, align: "center",resize: true,template:gantt.getTaskNumber},
                    {name: "wbs", label: "WBS", width: 60,min_width: 60,resize: true, align: "center", template: gantt.getWBSCode},
                    
                    {name: "text", label: "Task Name", tree: true, width: 150,min_width: 150, align: "left",editor: editors.text, resize: true},        
                    {name: "start_date", label: "Start",  width: 120,min_width: 120,editor: editors.start_date, align: "center",  resize: true},      
                    {name: "end_date", label: "Projected Finish",width: 120,min_width: 120, editor: editors.end_date, align: "center", template:formatEndDate, resize: true},
                    /*{name: "actual_finish", label: "Actual Finish", width:100,min_width: 180, editor: editors.actual_finish ,align: "center", resize: true,
                    template : function(task)
                    {
                        var actual_finish = task.actual_finish;
                        // var actual_finish = gantt.date.add(task.actual_finish, -1, gantt.config.duration_unit);
                    if(actual_finish == null)
                    {
                    actual_finish ='N/A';
                    }
                    else{
                        //actual_finish = gantt.date.add(actual_finish, -1, gantt.config.duration_unit);
                        actual_finish = actual_finish;
                    }
                    return actual_finish;
                    }
                    },*/
                    {name: "duration", label:'<svg class="slds-icon slds-icon-text-default slds-icon--small slds-m-top_small" style="fill:rgba(0, 0, 0, 0.7); width:20px "><use href="{!URLFOR($Resource.SLDS, '/assets/icons/utility-sprite/svg/symbols.svg#clock')}"></use></svg>',width:40,min_width: 40, align: "center", editor: editors.duration, resize: true},
                    {name: "predecessors", label: "Predecessors",width: 120,min_width: 120, editor: editors.predecessors, align: "center", resize: true,template: function(task){
                    var links = task.$target;
                    var labels = [];
                var types = [];
                
                for(var i = 0; i < links.length; i++){
                    var link = gantt.getLink(links[i]);
                    //alert('link'+JSON.stringify(link));
                    var pred = gantt.getTask(link.source);
                    // alert('pred'+JSON.stringify(pred));
                    var index = pred.$index;
                    index = index+1;
                    var typ = link.type;
                    var lag = link.lag;
                    if(typ == 0){
                        typedup = 'FS';
                    }
                    else if(typ == 1){
                        typedup = 'SS';
                    }else if(typ == 2){
                        typedup = 'FF';
                    }else if(typ == 3){
                        typedup = 'SF';
                    }
                    var sign;
                    if(lag >= 0){
                        sign ='+';
                    }else{
                        sign ='';  
                    }
                    
                    //alert('lag>>'+lag);
                    if(lag == null || lag == '' || lag == undefined){
                        lag =0;
                        sign ='+';
                        if(labels.indexOf(gantt.getTaskNumber(pred)+typedup+sign+lag+'days') == -1)
                        {
                            labels.push(gantt.getTaskNumber(pred)+typedup+sign+lag+'days');
                        }
                    }else{ 
                        if(labels.indexOf(gantt.getTaskNumber(pred)+typedup+sign+lag+'days') == -1){
                            labels.push(gantt.getTaskNumber(pred)+typedup+sign+lag+'days');
                        }
                    }
                }
                return labels.join(", ")
            }},
            
            //{name: "owner", label: "Owner", width: 90,min_width: 90, align: "center", editor: editors.owner, template: ownerLabel, resize: true},
            {name: "owner", align: "center", width: 140, label: "Role", resize: true,
                template: function (task) {
                    if (task.type == gantt.config.types.project) {
                        return "";
                    }
                    //alert('task.owner_id>>'+task.owner_id);
                    //alert('task.owner_id.length>>'+task.owner_id.length);
                    
                    var result = "";
                    var store = gantt.getDatastore("resource");
                    //alert('store>>'+JSON.stringify(store));
                    var owners = task[gantt.config.resource_property];
                    //alert('owners>>'+JSON.stringify(owners));
                    
                    if (!owners || !owners.length) {
                        return "Unassigned";
                    }
                    
                    if(owners.length == 1){
                        //return store.getItem(owners[0]).text;
                    }
                    
                    owners.forEach(function(ownerId){
                        var owner = store.getItem(ownerId);
                        //console.log('owner>>'+JSON.stringify(owner)); 
                        if (!owner)
                            return;
                        if(owner.text == '' && owner.textLN !='' && owner.specialty !='') //only first name is empty 
                        {
                            var copy = owner.specialty;// only role
                        }
                        else if(owner.text != '' && owner.textLN =='' && owner.specialty !='') //only last name is empty 
                        {
                            var copy = owner.specialty;
                        }else if(owner.text != '' && owner.textLN !='' && owner.specialty =='') //only role name is empty 
                        {
                            var copy = owner.text+' '+owner.textLN ;
                        }else if(owner.text == '' && owner.textLN =='' && owner.specialty !='') //only first and last name is empty 
                        {
                            var copy = owner.specialty;
                        }else if(owner.text != '' && owner.textLN =='' && owner.specialty =='') //only last name and role is empty 
                        {
                            var copy = owner.text;
                        }else if(owner.text == '' && owner.textLN !='' && owner.specialty =='') //only first name and role is empty 
                        {
                            var copy = owner.textLN;
                        }else if(owner.text != '' && owner.textLN !='' && owner.specialty !='') //nothing is empty 
                        {
                            var copy = owner.specialty;
                        } 
                        
                        if(result != ""){
                            result = result+','+copy;
                        }else{
                            result = copy ;
                        }
                    });
                    
                    return result;
                }
            },
                
                //{name: "priority", label: "Priority", width: 100,min_width: 100, align: "center", editor: editors.priority, template: priorityLabel, resize: true},
                {name: "Notes", label: "Comments",width:165, min_width: 150, align: "center", editor: editors.Notes,resize: true},
                    {name: "Additional_Comments", label: "Internal Comments", width: 150,min_width: 150, align: "center", editor: editors.Additional_Comments, resize: true},
                        
                        ];
        }
        // for project flow 
        else
        {
            
            gantt.config.drag_progress = true;
            gantt.config.columns = [
                {name:"add", width:40, min_width: 40, resize: true},
                {name:"dashboard", label:'<svg class="slds-icon slds-icon-text-default slds-icon--medium slds-m-top_x-small" style="fill:rgba(0, 0, 0, 0.7);"><use href="{!URLFOR($Resource.SLDS, '/assets/icons/standard-sprite/svg/symbols.svg#metrics')}"></use></svg>',width: 30,min_width: 30,resize: true,
                 template:function(task){
                 var boolVal = false;
                 if(task.dashboard == 'true'){
                 boolVal = true
                }
                var checked1 = !!boolVal ? " checked" : "";
                return "<input onclick='dashboardcheck("+task.id+")' class='gantt-checkbox-column' type='checkbox' name='test' id='test' value='1' " +checked1+ "/>";
                }
                },
                {name:"farol",label:"Status", width:50,min_width:50 , align: "center", template:function(obj){
                var color = statuscheck(obj);
                return "<div class='column_icon' style=background-color:"+color+"></div>"} 
                }, 
                {
                name: "buttons", label:'<svg class="slds-icon slds-icon-text-default slds-icon--x-small slds-m-top_medium" style="fill:rgba(0, 0, 0, 0.7);"><use href="{!URLFOR($Resource.SLDS, '/assets/icons/utility-sprite/svg/symbols.svg#new_window')}"></use></svg>',width: 40,min_width: 40,
                template: colContent
                },
                {name:"checked", label:"Ext <input class='ext-selectAll' type='checkbox' onClick='selectAllExt();' name='test' id='test' value='1' "+isAllExtChecked+" />", width: 50, min_width: 50, resize: true,
                template:function(task){
                var boolVal = false;
                if(task.checked == 'true'){
                boolVal = true
                }
                var checked = !!boolVal ? " checked" : "";
                return "<input onclick='checkbox_check("+task.id+")' data-taskId='"+task.id+"' class='gantt-checkbox-column extCheck' type='checkbox'  " +checked+ "/>";
                }
                },
                {name:"RowNum",label:"Row #",  width: 50,min_width: 50, align: "center",resize: true,template:gantt.getTaskNumber},
                {name: "wbs", label: "WBS",width: 60,min_width: 60,align: "center",resize: true, template: gantt.getWBSCode},
                
                {name: "text", label: "Task Name", tree: true, width: 150,min_width: 150,align: "left", editor: editors.text, resize: true},        
                {name: "start_date", label: "Start",  width: 120,min_width: 120,editor: editors.start_date, align: "center",  resize: true},      
                {name: "end_date", label: "Projected Finish",width: 120,min_width: 120, editor: editors.end_date, align: "center", template:formatEndDate, resize: true},
                {name: "actual_finish", label: "Actual Finish", width:100,min_width: 180, editor: editors.actual_finish ,align: "center", resize: true,
                template : function(task){
                var actual_finish = task.actual_finish;
                if(actual_finish == null){
                actual_finish ='N/A';
                }else{
                //actual_finish = gantt.date.add(actual_finish, -1, gantt.config.duration_unit);
                actual_finish = actual_finish;
                }
                return actual_finish;
                }
                },
                
                {name: "duration", label:'<svg class="slds-icon slds-icon-text-default slds-icon--small slds-m-top_small" style="fill:rgba(0, 0, 0, 0.7); width:20px "><use href="{!URLFOR($Resource.SLDS, '/assets/icons/utility-sprite/svg/symbols.svg#clock')}"></use></svg>',width:40,min_width: 40, align: "center", editor: editors.duration, resize: true},
                {name: "predecessors", label: "Predecessors",width:100,min_width: 100, align: "center",editor: editors.predecessors, resize: true,
                template: function(task){
                var links = task.$target;
                var labels = [];
            var types = [];
            
            for(var i = 0; i < links.length; i++){
                var link = gantt.getLink(links[i]);
                //alert('link'+JSON.stringify(link));
                var pred = gantt.getTask(link.source);
                // alert('pred'+JSON.stringify(pred));
                var index = pred.$index;
                index = index+1;
                var typ = link.type;
                var lag = link.lag;
                if(typ == 0){
                    typedup = 'FS';
                }else if(typ == 1){
                    typedup = 'SS';
                }else if(typ == 2){
                    typedup = 'FF';
                }else if(typ == 3){
                    typedup = 'SF';
                }
                var sign;
                if(lag >= 0){
                    sign ='+';
                }else{
                    sign ='';  
                }
                
                //alert('lag>>'+lag);
                if(lag == null || lag == '' || lag == undefined)
                {
                    lag =0;
                    sign ='+';
                    if(labels.indexOf(gantt.getTaskNumber(pred)+typedup+sign+lag+'days') == -1){
                        labels.push(gantt.getTaskNumber(pred)+typedup+sign+lag+'days');
                    }
                }else{ 
                    if(labels.indexOf(gantt.getTaskNumber(pred)+typedup+sign+lag+'days') == -1){
                        labels.push(gantt.getTaskNumber(pred)+typedup+sign+lag+'days');
                    }
                    
                }
            }
            return labels.join(", ")
        }
        },
            
            //{name: "owner", label: "Owner",width:90,min_width: 90, align: "center", editor: editors.owner, template: ownerLabel, resize: true},
            {name: "owner", align: "center", width: 80, label: "Resources", resize: true,
                template: function (task) {
                    if (task.type == gantt.config.types.project) {
                        return "";
                    }
                    var result = "";
                    var store = gantt.getDatastore("resource");
                    var owners = task[gantt.config.resource_property];
                    
                    if (!owners || !owners.length) {
                        return "Unassigned";
                    }
                    
                    if(owners.length == 1){
                        //return store.getItem(owners[0]).text;
                    }
                    
                    owners.forEach(function(ownerId){
                        var owner = store.getItem(ownerId);
                        //console.log('owner>>'+JSON.stringify(owner)); 
                        if (!owner)
                            return;
                        if(owner.text == '' && owner.textLN !='' && owner.specialty !='') //only first name is empty 
                        {
                            //var copy = owner.textLN+'('+owner.specialty+')';
                            var copy = owner.textLN;
                        }else if(owner.text != '' && owner.textLN =='' && owner.specialty !='') //only last name name is empty 
                        {
                            //var copy = owner.text+'('+owner.specialty+')';
                            var copy = owner.text;
                        }else if(owner.text != '' && owner.textLN !='' && owner.specialty =='') //only specialty(role) is empty 
                        {
                            var copy = owner.text+' '+owner.textLN ;
                        }else if(owner.text == '' && owner.textLN =='' && owner.specialty !='') //only first and last name is empty 
                        {
                            var copy = owner.specialty;
                        }else if(owner.text != '' && owner.textLN =='' && owner.specialty =='') //only last and role name is empty 
                        {
                            var copy = owner.text;
                        }else if(owner.text == '' && owner.textLN !='' && owner.specialty =='') //only firstand role name is empty 
                        {
                            var copy = owner.textLN;
                        }else if(owner.text != '' && owner.textLN !='' && owner.specialty !='') // nothing is empty  
                        {
                            //var copy = owner.text+' '+owner.textLN+'('+owner.specialty+')';
                            var copy = owner.text+' '+owner.textLN;
                        }
                        if(result != "")
                        {
                            result = result+','+copy;
                        }else{
                            result = copy ;
                        }
                    });
                    return result;
                }
            },
                //{name: "priority", label: "Priority",width:100,min_width: 100, align: "center", editor: editors.priority, template: priorityLabel, resize: true},
                {name: "Notes", label: "Comments", width:165, min_width: 150, align: "center", editor: editors.Notes,resize: true},
                    {name: "Additional_Comments", label: "Internal Comments", width: 150,min_width: 150, align: "center", editor: editors.Additional_Comments, resize: true}
        
        /*  {name: "progress", label: "Progress %",  width: 120,min_width: 120,resize: true,editor: editors.progress, align: "center", template: function (task) {
                var progress = task.progress || 0;
                            var progressStr = progress.toString();
                            if(progressStr.indexOf('0.')> -1){
                                task.progress = progress;
                                progress = progress*100
                            }else if(progressStr == '1'){
                                task.progress = progress;
                                progress = progress*100
                            }else{
                                task.progress = progress/100;
                            }
                            return progress + "% </span>";
                        }
                        },*/
        
        ];
        }
        function checkbox_check(id){
            
            var task = gantt.getTask(id);
            var taskBoolVal = 'false';
            if(task.checked == 'false'){
                taskBoolVal = 'true';
            }
            task.checked = taskBoolVal;
            gantt.updateTask(id);
            
            checkAllExtCheckboxes();
            
            
        };
        
        function checkAllExtCheckboxes(){
            
            let allRecords  = document.querySelectorAll('.extCheck');
            let uncheckExists = false;
            for (let i = 0; i < allRecords.length; i++) {
                
                if(!allRecords[i].checked){
                    uncheckExists = true; 
                }
            }
            console.log('uncheckExists',uncheckExists);
            document.querySelector('.ext-selectAll').checked = !uncheckExists;
            console.log(document.querySelector('.ext-selectAll').checked);
            isAllExtChecked = !uncheckExists
            
            
        }
        
        function dashboardcheck(id){
            var task = gantt.getTask(id);
            var taskBoolVal = 'false';
            if(task.dashboard == 'false'){
                taskBoolVal = 'true';
            }
            task.dashboard = taskBoolVal;
            //gantt.updateTask(id);
            
        };
        
        //status-code
        function statuscheck(idobj)
        {
            // var task = gantt.getTask(idobj);
            //console.log('statuscheck>>'+JSON.stringify(idobj));
            var status = '';
            if(idobj.progress != '' && idobj.progress != null && idobj.progress != undefined
               && idobj.progress == 100)
            {
                status = '#3813AD';     //blue
            }
            else if(idobj.progress != '' && idobj.progress != null && idobj.progress != undefined
                    && idobj.progress == 1)
            {
                status = '#3813AD';     //blue
            }else if(idobj.type == 'project' && idobj.actual_finish != 'N/A' && idobj.actual_finish != '' && idobj.actual_finish != undefined){
                status = '#3813AD';     //blue
            }else if(idobj.end_date != '' && idobj.end_date != null && idobj.end_date != undefined){
                
                var currentDate=new Date();
                var nextDayDate;
                var tempDate=currentDate;
                var finishDate=new Date(idobj.end_date);
                var count=0;
                if(currentDate>finishDate)
                {
                    status = '#C00000';         //red   
                }else{
                    do
                    {
                        if(!checkHoliday(tempDate,holiday_data) && !checkWeekEndDay(tempDate))
                        {
                            count=count+1;
                        }
                        nextDayDate= new Date(tempDate);
                        nextDayDate.setDate(tempDate.getDate()+1);
                        tempDate=nextDayDate;
                    }while(tempDate<=finishDate);
                    
                    if(count>3)
                    {
                        status= '#00B050';          //green
                    }
                    else if(count>1)
                    {
                        status= '#ffcc00';          //yellow
                    }
                        else
                        {
                            status= '#C00000';      //red
                        }
                    
                }
            }
            return status;
        }
        
        function checkHoliday(dateToCheck,holidayData) 
        {debugger;
            var isHoliday=false;
            for(var eachHoliday in holidayData)
            {
                /*if(dateToCheck.getTime() === eachHoliday)
                {
                    isHoliday=true;
                }*/
                if(eachHoliday=='remove'){
                    return isHoliday; 
                }
                
                if(dateToCheck.getDate() === holidayData[eachHoliday].getDate() && dateToCheck.getMonth() === holidayData[eachHoliday].getMonth() && dateToCheck.getYear() === holidayData[eachHoliday].getYear())
                {
                    isHoliday=true;
                }
                
            }
            return isHoliday;
        }
        
        function checkWeekEndDay(dateToCheck) 
        {
            var isWeekendDay=false;
            if(dateToCheck.getDay() == 0 || dateToCheck.getDay() == 6 )
            {
                isWeekendDay=true;
            }
            
            return isWeekendDay;
            
        }
        
        gantt.ext.inlineEditors.attachEvent("onEditStart", function(state){
            if (state.columnName == "progress"){    
                var task = gantt.getTask(state.id);
                var element = document.getElementsByTagName("input");
                for(var i in element){
                    if(element[i].name == "progress"){
                        element[i].value = parseInt(element[i].value * 100);
                    }
                }
                
            }
        });
        /*var resourceConfig = {
            columns: [
            {
            name: "name", label: "Name", tree:true, template: function (resource) {
            return resource.text;
            }
            },
            {
            name: "workload", label: "Workload", template: function (resource) {
            var tasks;
            var store = gantt.getDatastore(gantt.config.resource_store),
            field = gantt.config.resource_property;
            
            if(store.hasChild(resource.id)){
            tasks = gantt.getTaskBy(field, store.getChildren(resource.id));
            }else{
            tasks = gantt.getTaskBy(field, resource.id);
            }
            
            var totalDuration = 0;
            for (var i = 0; i < tasks.length; i++) {
            totalDuration += tasks[i].duration;
        }
        
        return (totalDuration || 0) * 8 + "h";
        }
        }
        ],
        };
        
        gantt.templates.resource_cell_class = function(start_date, end_date, resource, tasks){
            var css = [];
            css.push("resource_marker");
            if (tasks.length <= 1) {
                css.push("workday_ok");
            } else {
                css.push("workday_over");
            }
            return css.join(" ");
        };
        
        gantt.templates.resource_cell_value = function(start_date, end_date, resource, tasks){
            return "<div>" + tasks.length * 8 + "</div>";
        };
        
        
        //gantt.locale.labels.section_resources = "Resources";*/
        
        
        //gantt.config.order_branch = true;
        //gantt.config.open_tree_initially = true;
        gantt.config.layout = {
            css: "gantt_container",
            rows: [
                {
                    cols: [
                        {view: "grid", group:"grids", scrollY: "scrollVer"},
                        {resizer: true, width: 1},
                        {view: "timeline", scrollX: "scrollHor", scrollY: "scrollVer"},
                        {view: "scrollbar", id: "scrollVer", group:"vertical"}
                    ],
                    gravity:2
                },
                {resizer: true, width: 1},
                {
                    config: resourceConfig,
                    cols: [
                        {view: "resourceGrid", group:"grids", width: 300, scrollY: "resourceVScroll" },
                        {resizer: true, width: 1},
                        {view: "resourceTimeline", scrollX: "scrollHor", scrollY: "resourceVScroll"},
                        {view: "scrollbar", id: "resourceVScroll", group:"vertical"}
                    ],
                    gravity:1
                },
                {view: "scrollbar", id: "scrollHor"}
            ]
        };
        
        
        //resource ends---------------------------------
        
        gantt.config.layout = {
            css: "gantt_container",
            cols: [
                {
                    width:1200,
                    min_width: 1200,
                    rows:[
                        {view: "grid", scrollX: "gridScroll", scrollable: true, scrollY: "scrollVer"},
                        {view: "scrollbar", id: "gridScroll", group:"horizontal"}
                    ]
                },
                {resizer: true, width: 10},
                {
                    rows:[
                        {view: "timeline", scrollX: "scrollHor", scrollY: "scrollVer"},
                        {view: "scrollbar", id: "scrollHor", group:"horizontal"}
                    ]
                },
                {view: "scrollbar", id: "scrollVer"}
            ]
        };
        //resource code start ---------------
        gantt.config.resource_store = "resource";
        gantt.config.resource_property = "owner_id";
        // gantt.config.order_branch = true;
        //gantt.config.open_tree_initially = true;
        gantt.config.scale_height = 50;
        gantt.$resourcesStore = gantt.createDatastore({
            name: gantt.config.resource_store,
            type: "treeDatastore",
            initItem: function (item) {
                item.parent = item.parent || gantt.config.root_id;
                item[gantt.config.resource_property] = item.parent;
                item.open = true;
                return item;
            }
        });
        
        gantt.$resourcesStore.attachEvent("onAfterSelect", function(id){
            gantt.refreshData();
        });
        
        //gantt.init("gantt_here");
        
        
        function toggleGroups(input) {
            gantt.$groupMode = !gantt.$groupMode;
            if (gantt.$groupMode) {
                input.value = "show gantt view";
                
                var groups = gantt.$resourcesStore.getItems().map(function(item){
                    var group = gantt.copy(item);
                    group.group_id = group.id;
                    group.id = gantt.uid();
                    return group;
                });
                
                gantt.groupBy({
                    groups: groups,
                    relation_property: gantt.config.resource_property,
                    group_id: "group_id",
                    group_text: "text",
                    delimiter: ", ",
                    default_group_label: "Not Assigned"
                });
            } else {
                input.value = "show resource view";
                gantt.groupBy(false);
            }
        }
        
        
        if(tempflag == true)
        {
            //alert('inside if event ');
            gantt.$resourcesStore.attachEvent("onParse", function(){
                var people = [];
                gantt.$resourcesStore.eachItem(function(res){
                    if(!gantt.$resourcesStore.hasChild(res.id))
                    {
                        var copy = gantt.copy(res);
                        copy.key = res.id;
                        if(res.text == '' && res.textLN !='' && res.specialty !='') //only first name is empty 
                        {
                            copy.label = res.specialty;
                        }
                        else if(res.text != '' && res.textLN =='' && res.specialty !='') //only first name is empty 
                        {
                            copy.label = res.specialty;
                        }
                            else if(res.text != '' && res.textLN !='' && res.specialty =='') //only first name is empty 
                            {
                                copy.label = res.text+' '+res.textLN ;
                            }
                                else if(res.text == '' && res.textLN =='' && res.specialty !='') //only first name is empty 
                                {
                                    copy.label = res.specialty;
                                }
                                    else if(res.text != '' && res.textLN =='' && res.specialty =='') //only first name is empty 
                                    {
                                        copy.label = res.text;
                                    }
                                        else if(res.text == '' && res.textLN !='' && res.specialty =='') //only first name is empty 
                                        {
                                            copy.label = res.textLN;
                                        }
                                            else if(res.text != '' && res.textLN !='' && res.specialty !='') //only first name is empty 
                                            {
                                                copy.label = res.specialty;
                                            }
                        
                        people.push(copy);
                        //console.log('people>>'+people);
                        
                    }
                });
                gantt.updateCollection("people", people);
            });
        }
        else
        {
            //alert('inside else event ');
            gantt.$resourcesStore.attachEvent("onParse", function(){
                var people = [];
                gantt.$resourcesStore.eachItem(function(res){
                    if(!gantt.$resourcesStore.hasChild(res.id))
                    {
                        var copy = gantt.copy(res);
                        copy.key = res.id;
                        if(res.text == '' && res.textLN !='' && res.specialty !='') //only first name is empty 
                        {
                            copy.label = res.textLN;
                        }
                        else if(res.text != '' && res.textLN =='' && res.specialty !='') //only first name is empty 
                        {
                            copy.label = res.text;
                        }
                            else if(res.text != '' && res.textLN !='' && res.specialty =='') //only first name is empty 
                            {
                                copy.label = res.text+' '+res.textLN ;
                            }
                                else if(res.text == '' && res.textLN =='' && res.specialty !='') //only first name is empty 
                                {
                                    copy.label = res.specialty;
                                }
                                    else if(res.text != '' && res.textLN =='' && res.specialty =='') //only first name is empty 
                                    {
                                        copy.label = res.text;
                                    }
                                        else if(res.text == '' && res.textLN !='' && res.specialty =='') //only first name is empty 
                                        {
                                            copy.label = res.textLN;
                                        }
                                            else if(res.text != '' && res.textLN !='' && res.specialty !='') //only first name is empty 
                                            {
                                                copy.label = res.text+' '+res.textLN;
                                            }
                        
                        people.push(copy);
                        //console.log('people>>'+people);
                        
                    }
                });
                gantt.updateCollection("people", people);
            });
        }
        
        var resourceArr = [
            
            <apex:repeat value="{!IPMupdateList}" var="reso">
            {
            id: '{!reso.id}', 
            text: "{!reso.First_Name__c}",
            textLN: "{!reso.Last_Name__c}",
            specialty: "{!reso.IPM_Roles__c}"
            },
            </apex:repeat>
        ]
        gantt.$resourcesStore.parse(resourceArr);
        gantt.init("gantt_here");
        //resource code end --------------
        
        
        gantt.attachEvent("onTaskCreated", function(task){
            isnewtask=true;
            //task.priority = "Low";
            if(task.type == gantt.config.types.placeholder){
                task.text = "New Task";
            }
            if(task.text.toUpperCase()==="EFFECTIVE DATE"){	
                task.calendar_id='custom';	
            }else
                task.calendar_id='Normal';
            return true;
        });
        //--------------------- new code to datepicker ---------------
        
        var edited_task = null;
        
        function process_end_date(value)
        {
            var task = gantt.getTask(edited_task);                  //to get the enddate from task 
            if(!gantt.isWorkTime(task.end_date))                    //to apply holiday if selected input is holiday
            {
                task.end_date = gantt.getClosestWorkTime({date:task.end_date, dir:"past" });
                task.end_date = gantt.date.add(task.end_date, value, gantt.config.duration_unit);
            }
            else
            {
                task.end_date = gantt.date.add(task.end_date, value, gantt.config.duration_unit);
                
            }
        }
        function process_progress(value){
            
            var task = gantt.getTask(edited_task);
            
            var progress = task.progress || 0;
            var progressStr = progress.toString();
            if(progressStr.indexOf('0.')> -1){
                task.progress = progress;
                progress = progress*100
            }else if(progressStr == '1'){
                task.progress = progress;
                progress = progress*100
            }else{
                task.progress = progress/100;
            }
            task.progress = progress;
            console.log('task.progress in process>>'+task.progress);
        }
        /*function process_actual_finish(value){
            
            var task = gantt.getTask(edited_task);
            if(task.actual_finish != null && task.actual_finish != '' && task.actual_finish != 'N/A' && task.actual_finish != undefined)
            {
                 task.actual_finish = gantt.date.add(task.actual_finish, value, gantt.config.duration_unit);
            }
        }*/
        
        var initial_text,initial_start_date, initial_end_date,initial_duration,initial_duration1,initial_end_date1,actual_date,initial_actual_finish,initial_progress,start_duration,actual_startdate,actual_enddate,actual_duration,initial_predecessor,actual_stdate,actual_enddate;
        //gantt.config.skip_off_time = true; 
        gantt.ext.inlineEditors.attachEvent("onBeforeEditStart", function(state){
            var date_type = state.columnName;
            if(date_type == "text")
            {
                initial_text = gantt.getTask(state.id).text;
            }
            if (date_type == "end_date"){
                edited_task = state.id;
                //if(gantt.getTask(state.id).type != 'milestone')
                //{
                process_end_date(-1)
                //}
                initial_start_date = gantt.getTask(state.id).start_date;
                actual_enddate = gantt.getTask(state.id).end_date;
                actual_duration = gantt.getTask(state.id).duration;
            }
            if (date_type == "duration"){
                initial_duration1 = gantt.getTask(state.id).duration;
                initial_end_date1 = gantt.getTask(state.id).end_date
            }
            if (date_type == "start_date") {
                initial_end_date = gantt.getTask(state.id).end_date
                actual_startdate = gantt.getTask(state.id).start_date
                start_duration = gantt.getTask(state.id).duration
            }
            
            if(date_type == "predecessors") 
            {
                initial_duration = gantt.getTask(state.id).duration;
                initial_predecessor = gantt.getTask(state.id).predecessors;
            }
            if(date_type == "actual_finish") 
            {
                initial_actual_finish = gantt.getTask(state.id).actual_finish
                actual_stdate = gantt.getTask(state.id).start_date
                actual_enddate = gantt.getTask(state.id).end_date
                if(initial_actual_finish =='N/A' || initial_actual_finish =='')
                {
                    gantt.getTask(state.id).progress = 0;
                }
            }
            
            if(date_type == "progress") 
            {
                edited_task = state.id;
                initial_progress = edited_task.progress;
                process_progress(initial_progress)
                console.log('edited_task>>'+edited_task);
            }
            
            //gantt.render();
        });
        gantt.ext.inlineEditors.attachEvent("onEditEnd", function(state){
            if (state.columnName == "end_date") {
                //if(gantt.getTask(state.id).type != 'milestone')
                //{
                process_end_date(1);
                //}
                
                gantt.updateTask(state.id);
                gantt.autoSchedule(state.id);
                //gantt.render();
            }
            if (state.columnName == "duration") {
                /*if(task.duration == 0)
                   
                    {
                        task.duration = initial_duration1;
                        task.end_date = initial_end_date1;
                    }*/
                if(gantt.getTask(state.id).duration == 0)
                    
                {
                    gantt.getTask(state.id).duration = initial_duration1;
                    gantt.getTask(state.id).end_date = initial_end_date1;
                }
                
                gantt.render();
            }
            
        }); 
        gantt.attachEvent("onBeforeTaskUpdate", function(id,new_item){
            
            var task = gantt.getTask(id);
            if(task.text.toUpperCase() === "EFFECTIVE DATE"){	
                
                if(new_item.duration == 0){	
                    new_item.duration = 1;	
                    //new_item.end_date = new_item.start_date;	
                }	
                task.calendar_id = 'custom';	
                /*new_item.start_date = new_item.start_date;	
                new_item.end_date = new_item.end_date;	
                new_item.actual_finish = new_item.actual_finish;	
                */	
                //new_item.actual_finish = gantt.date.add(new_item.actual_finish, -1, 'day');	
            }else{
                if(!gantt.isWorkTime(new_item.start_date)) {
                    new_item.start_date = gantt.getClosestWorkTime({date:new_item.start_date, dir:"future" });
                }
                if(!gantt.isWorkTime(new_item.end_date)) {
                    new_item.end_date = gantt.getClosestWorkTime({date:new_item.end_date, dir:"past" });
                }
                if(new_item.actual_finish != null && new_item.actual_finish != '' && new_item.actual_finish != 'N/A' && new_item.actual_finish != undefined)
                {
                    if(!gantt.isWorkTime(new_item.actual_finish)) {
                        new_item.actual_finish = gantt.getClosestWorkTime({date:new_item.actual_finish, dir:"past" });
                        new_item.actual_finish = gantt.date.add(new_item.actual_finish, -1, 'day');
                    }
                }
            }
        });
        
        
        gantt.ext.inlineEditors.attachEvent("onBeforeSave", function(state){
            
            
            var date_type = state.columnName;
            
            if(date_type == "end_date")
            {
                if(state.newValue != null)
                {
                    gantt.getTask(state.id).end_date = state.newValue
                    //before saving to gantt if selected sunday then set the date to friday and save as friday to gantt,
                    if(!gantt.isWorkTime(gantt.getTask(state.id).end_date)) 
                    {
                        gantt.getTask(state.id).end_date = gantt.getClosestWorkTime({date:gantt.getTask(state.id).end_date, dir:"past" });
                    }
                }
            }
            if(date_type == "actual_finish")
            {
                if(state.newValue == null)
                {
                    if(gantt.getTask(state.id).type != 'project' )
                    {
                        gantt.getTask(state.id).actual_finish ='N/A';
                        gantt.getTask(state.id).progress = 0;
                        if (gantt.getTask(state.id).parent > 0 && gantt.getTask(state.id).actual_finish =='N/A')
                        {
                            //gantt.getTask(state.id).progress = 0;
                            Null_actual_finish(gantt.getTask(state.id).parent);
                        }
                    }
                }else{
                    gantt.getTask(state.id).actual_finish = state.newValue
                    if(!gantt.isWorkTime(gantt.getTask(state.id).actual_finish)) {
                        gantt.getTask(state.id).actual_finish = gantt.getClosestWorkTime({date:gantt.getTask(state.id).actual_finish, dir:"past" });
                    }
                    //gantt.getTask(state.id).actual_finish = state.oldValue;
                    if(gantt.getTask(state.id).parent >0 && 
                       gantt.getTask(state.id).actual_finish != null && gantt.getTask(state.id).actual_finish !='' && 
                       gantt.getTask(state.id).actual_finish != undefined && gantt.getTask(state.id).actual_finish !='N/A')
                    {
                        parenttasktype = gantt.getTask(gantt.getTask(state.id).parent);
                        childIds = gantt.getChildren(gantt.getTask(state.id).parent);
                        var ChildTask =[];
                        for(var child =0 ; child < childIds.length ; child++){
                            var childtaskInd = gantt.getTask(childIds[child]);
                            ChildTask.push(childtaskInd);
                        }
                        var dates =[];
                        if(ChildTask.length > 0){
                            for(var d=0 ; d<ChildTask.length; d++){
                                dates.push(ChildTask[d].actual_finish);
                            }
                        }
                        
                        var maxDate=new Date(Math.max.apply(null,dates));
                        var today = new Date();
                        
                        if(maxDate =='Invalid Date' || maxDate > today){
                            //parenttasktype.actual_finish = 'N/A';
                            
                        }else{
                            //parenttasktype.actual_finish = maxDate;
                            get_max_actual_finish(gantt.getTask(state.id).parent)
                        }
                    }
                }
                //gantt.updateTask(state.id);
                gantt.render();
            }
            
            return true;
        });
        
        gantt.ext.inlineEditors.attachEvent("onSave", function(state){
            console.log('onSaveEvent Calling');
            var col = state.columnName;
            if(gantt.autoSchedule && (col == "start_date" || col == "end_date" || col == "duration" || col == "progress")){
                gantt.autoSchedule();
            }
            var date_type = state.columnName;
            
            if(date_type == "text"){
                
                if(gantt.getTask(state.id).text == null ||
                   gantt.getTask(state.id).text =='' ||
                   gantt.getTask(state.id).text == undefined)
                {
                    document.getElementById("warningToastFortext").style.display = 'block';
                    setTimeout(closewarningText,1200);
                    gantt.getTask(state.id).text = initial_text;
                }
            }
            
            
            if (date_type == "start_date"){
                var Today = gantt.date.convert_to_utc(new Date());
                var parseIntYearLabel = parseInt(YearLabel);
                var start_date = gantt.getTask(state.id).start_date;
                var Todaycopy = Today;
                Todaycopy = Todaycopy.setFullYear(Todaycopy.getFullYear() + parseIntYearLabel);
                var Todaycopy0 = gantt.date.convert_to_utc(new Date(Todaycopy));
                var TodaycopyYear = Todaycopy0.getFullYear();
                var currentyear = gantt.date.convert_to_utc(new Date());
                currentyear = currentyear.setFullYear(currentyear.getFullYear() -1);
                currentyear = gantt.date.convert_to_utc(new Date(currentyear));
                var StartDateYear = start_date.getFullYear();
                var CurrentYear = currentyear.getFullYear();
                //alert(CurrentYear);
                
                if(StartDateYear > TodaycopyYear || StartDateYear < CurrentYear)
                {
                    
                    document.getElementById("StartdateValid").style.display = 'block';
                    setTimeout(closestartdateValid,2700);
                    gantt.getTask(state.id).start_date = actual_startdate;
                    gantt.getTask(state.id).end_date = initial_end_date;
                    
                }
                if(gantt.getTask(state.id).type =='project')
                {
                    
                    gantt.getTask(state.id).start_date = actual_startdate;
                    document.getElementById("ProjectStart_date").style.display = 'block';
                    setTimeout(closeprojectstartdate,1700);
                }
                
                //actual finish has value start_date should not change
                if(gantt.getTask(state.id).actual_finish != null && gantt.getTask(state.id).actual_finish != '' && gantt.getTask(state.id).actual_finish != undefined && gantt.getTask(state.id).actual_finish != 'N/A')
                {
                    gantt.getTask(state.id).start_date = actual_startdate;
                    gantt.getTask(state.id).end_date =  initial_end_date;
                    gantt.getTask(state.id).duration = start_duration;
                }
                else
                {
                    gantt.getTask(state.id).duration = start_duration;
                    gantt.getTask(state.id).start_date = gantt.getTask(state.id).start_date;
                }
            }
            if (date_type == "end_date")
            { 
                var Today1 = gantt.date.convert_to_utc(new Date());
                var parseIntYearLabel = parseInt(YearLabel);
                var end_date = gantt.getTask(state.id).end_date;
                var Todaycopy2 = Today1;
                Todaycopy2 = Todaycopy2.setFullYear(Todaycopy2.getFullYear() + parseIntYearLabel);
                var Todaycopy1 = gantt.date.convert_to_utc(new Date(Todaycopy2));
                var Todaycopyyear = Todaycopy1.getFullYear();
                var currentyear = gantt.date.convert_to_utc(new Date());
                currentyear = currentyear.setFullYear(currentyear.getFullYear() -1);
                currentyear = gantt.date.convert_to_utc(new Date(currentyear));
                var EndDateYear = end_date.getFullYear();
                var CurrentYear1 = currentyear.getFullYear();
                //alert(CurrentYear);
                
                if(EndDateYear > Todaycopyyear || EndDateYear < CurrentYear1)
                {
                    document.getElementById("EnddateValid").style.display = 'block';
                    setTimeout(closeprojectfinishValid,2700);
                    gantt.getTask(state.id).end_date = actual_enddate;
                    gantt.getTask(state.id).start_date = initial_start_date;
                    
                    
                }
                if(gantt.getTask(state.id).type == 'project')
                {
                    
                    gantt.getTask(state.id).end_date = actual_enddate;
                    document.getElementById("ProjectEnd_date").style.display = 'block';
                    setTimeout(closeprojectenddate,1700);
                }
                
                if(gantt.getTask(state.id).predecessors != null && gantt.getTask(state.id).predecessors != '' && gantt.getTask(state.id).predecessors != undefined)
                {
                    gantt.getTask(state.id).end_date = actual_enddate;
                }
                else
                {
                    gantt.getTask(state.id).end_date = gantt.getTask(state.id).end_date;
                }
                //Updating end_date with actual_finish when change actual_finish 
                if(gantt.getTask(state.id).actual_finish != null && gantt.getTask(state.id).actual_finish != '' && gantt.getTask(state.id).actual_finish != undefined && gantt.getTask(state.id).actual_finish != 'N/A')
                {
                    gantt.getTask(state.id).end_date = gantt.getTask(state.id).actual_finish;
                    gantt.getTask(state.id).duration =actual_duration;
                    gantt.getTask(state.id).start_date = initial_start_date;
                }
                else
                {
                    gantt.getTask(state.id).start_date = initial_start_date;
                    gantt.getTask(state.id).end_date = gantt.getTask(state.id).end_date;
                }
                
                // if end date is updating less than start date, change start_date with end_date 
                if(gantt.getTask(state.id).type != 'milestone')
                {
                    if(gantt.getTask(state.id).end_date < gantt.getTask(state.id).start_date)
                    {
                        gantt.getTask(state.id).start_date = gantt.getTask(state.id).end_date;
                        if(!gantt.isWorkTime(gantt.getTask(state.id).start_date)) 
                        {
                            var temp = gantt.getClosestWorkTime({date:gantt.getTask(state.id).start_date, dir:"past" });
                            gantt.getTask(state.id).start_date = gantt.date.add(temp, -1, 'day');
                            console.log('temp>>'+gantt.getTask(state.id).start_date);
                            gantt.render();
                        }
                    }
                    else
                    {
                        gantt.getTask(state.id).start_date = gantt.getTask(state.id).start_date;
                    }
                }
            }
            
            if(date_type == 'duration')
            {
                console.log('inside duration change');
                var Today1 = gantt.date.convert_to_utc(new Date());
                var parseIntYearLabel = parseInt(YearLabel);
                var end_date = gantt.getTask(state.id).end_date;
                var Todaycopy2 = Today1;
                Todaycopy2 = Todaycopy2.setFullYear(Todaycopy2.getFullYear() + parseIntYearLabel);
                Todaycopy1 = gantt.date.convert_to_utc(new Date(Todaycopy2));
                var Todaycopyyear = Todaycopy1.getFullYear();
                var currentyear = gantt.date.convert_to_utc(new Date());
                currentyear = currentyear.setFullYear(currentyear.getFullYear() -1);
                currentyear = gantt.date.convert_to_utc(new Date(currentyear));
                var EndDateYear = end_date.getFullYear();
                var CurrentYear1 = currentyear.getFullYear();
                
                if(EndDateYear > Todaycopyyear || EndDateYear < CurrentYear1)
                {
                    document.getElementById("EnddateValid").style.display = 'block';
                    setTimeout(closeprojectfinishValid,2700);
                    gantt.getTask(state.id).end_date = initial_end_date1;
                    gantt.getTask(state.id).duration = initial_duration1;
                    
                    
                }
                
                if(gantt.getTask(state.id).type == 'project')
                {
                    
                    gantt.getTask(state.id).duration = initial_duration1;
                    document.getElementById("ProjectDuration").style.display = 'block';
                    setTimeout(closeprojectduration,1700);
                }
                // If actual finish is not null,duration should not change.
                if(gantt.getTask(state.id).actual_finish != null && gantt.getTask(state.id).actual_finish != '' && gantt.getTask(state.id).actual_finish != undefined && gantt.getTask(state.id).actual_finish != 'N/A')
                {
                    //gantt.getTask(state.id).start_date = initial_start_date;
                    gantt.getTask(state.id).end_date = gantt.date.add(gantt.getTask(state.id).actual_finish, 1, gantt.config.duration_unit);
                }
            }
            
            if(state.columnName == "actual_finish")
            {
                var actualfinish = gantt.getTask(state.id).actual_finish;
                var currentyear = gantt.date.convert_to_utc(new Date());
                currentyear = currentyear.setFullYear(currentyear.getFullYear() -1);
                currentyear = gantt.date.convert_to_utc(new Date(currentyear));
                var actualfinishYear = actualfinish.getFullYear();
                var CurrentYear1 = currentyear.getFullYear();
                
                if(actualfinishYear < CurrentYear1)
                {
                    document.getElementById("ActualFinishValid").style.display = 'block';
                    setTimeout(closeActualfinishValid,2700);
                    gantt.getTask(state.id).actual_finish = initial_actual_finish;
                    gantt.getTask(state.id).end_date = actual_enddate;
                    gantt.getTask(state.id).start_date = actual_stdate;
                }
                
                if(gantt.getTask(state.id).type == 'project')
                {
                    document.getElementById("Projectactual_finish").style.display = 'block';
                    setTimeout(closeprojectProjectactual_finish,1700);
                    if(initial_actual_finish =='N/A' || initial_actual_finish =='' || initial_actual_finish == undefined){
                        gantt.getTask(state.id).actual_finish = 'N/A';
                        gantt.getTask(state.id).progress = 0;
                    }
                    else{
                        gantt.getTask(state.id).actual_finish = initial_actual_finish;
                    }
                    
                }
                // if actual_finish is less than start_date, then start_date and end_date set to be with actual_finish and duration is 1
                if(gantt.getTask(state.id).actual_finish != 'N/A' && gantt.getTask(state.id).actual_finish !='' && gantt.getTask(state.id).actual_finish != undefined)
                {
                    if(gantt.getTask(state.id).actual_finish < gantt.getTask(state.id).start_date)
                    {
                        gantt.getTask(state.id).start_date = gantt.getTask(state.id).actual_finish;
                        gantt.getTask(state.id).end_date= gantt.date.add(gantt.getTask(state.id).actual_finish, 1, gantt.config.duration_unit);
                        gantt.getTask(state.id).duration = 1;
                        gantt.getTask(state.id).progress = 100;
                    }
                    else
                    {
                        gantt.getTask(state.id).end_date = gantt.getTask(state.id).actual_finish;
                        gantt.getTask(state.id).end_date= gantt.date.add(gantt.getTask(state.id).end_date, 1, gantt.config.duration_unit);
                        gantt.getTask(state.id).progress = 100;
                    }
                }
                
                
                var today = gantt.date.convert_to_utc(new Date());
                
                
                if(gantt.getTask(state.id).actual_finish > today)
                {
                    document.getElementById("warningToastForActualfinish").style.display = 'block';
                    setTimeout(closewarningToastForActualfinish,7200);
                    gantt.getTask(state.id).actual_finish = initial_actual_finish;
                    gantt.getTask(state.id).start_date = actual_stdate; 
                    gantt.getTask(state.id).end_date = actual_enddate;
                    gantt.getTask(state.id).progress = 3;
                }
            }
            
            if(state.columnName == "progress")
            {
                // update progress as 100%,actual_finish update with end_date
                if(gantt.getTask(state.id).progress == 1)
                {
                    gantt.getTask(state.id).actual_finish = gantt.getTask(state.id).end_date;
                    gantt.getTask(state.id).actual_finish = gantt.date.add(gantt.getTask(state.id).end_date, -1, gantt.config.duration_unit);
                } 
                else
                {
                    //update progress rather than 100%, make actual_finish update with 'N/A'
                    gantt.getTask(state.id).actual_finish ='N/A';
                }
            }
            
            task = gantt.getTask(state.id);
            /* // var startdt = gantt.date.date_part(new Date(startdate));
             var startdt = new Date(startdate);
             var localTime = startdt.getTime();
             var localOffset = startdt.getTimezoneOffset() * 60000;
             var utc = localTime + localOffset;
             var offset = 5.5;   
             var bombay = utc + (3600000*offset);
             startdt = new Date(bombay);

            var enddate11 = gantt.date.date_part(new Date(startdate));*/
            var startdt = gantt.date.convert_to_utc(new Date(startdate));
            
            var enddate11 = gantt.date.convert_to_utc(new Date(startdate));
            
            enddate11.setDate(enddate11.getDate()+initial_duration);
            if(state.columnName == "predecessors")
            {
                
                if((state.newValue == null || state.newValue =='')&& (task.actual_finish == null || task.actual_finish =='' || task.actual_finish =='N/A' || task.actual_finish == undefined))
                {
                    
                    gantt.getTask(state.id).start_date = startdt;
                    gantt.getTask(state.id).duration = 1;
                    task.end_date  = gantt.calculateEndDate({start_date: startdt, duration: gantt.getTask(state.id).duration});
                }
                // if actual_finish is not null(progress is 100%) , predecessors should not change
                if(gantt.getTask(state.id).actual_finish != null && gantt.getTask(state.id).actual_finish != '' && gantt.getTask(state.id).actual_finish != undefined && gantt.getTask(state.id).actual_finish != 'N/A')
                {
                    
                    gantt.getTask(state.id).predecessors =initial_predecessor
                }
                else
                {
                    gantt.getTask(state.id).predecessors = gantt.getTask(state.id).predecessors;
                }
                
            }
            
            
            if (state.columnName == "predecessors")
            {
                TaskDelete = 'true';
                var source ='';
                var predoldvalue = state.oldValue;
                var prevPredVal ='';
                var task = gantt.getTask(state.id);
                var new_linked_ids = [];
                var predecessors_array = [];
                //alert('task.predecessors>>>'+task.predecessors);
                if (task.predecessors) predecessors_array = task.predecessors.split(",");
                var new_link =[];
                var link_type ='';
                var myString ='';
                for (var j = 0; j < predecessors_array.length; j++) {
                    myString = predecessors_array[j];
                    
                    myString = myString.replace(/(?![+-]?\d*\.?\d+|e[+-]\d+)[^0-9]/g,'');
                    
                    //var resmystring;
                    if(myString.includes("+"))
                    {
                        myString = myString.split("+");
                        myString = myString[0];
                        
                    }
                    
                    else if(myString.includes("-"))
                    {
                        myString = myString.split("-");
                        myString = myString[0];
                    }
                    
                    
                    //var new_linked = parseFloat(predecessors_array[j]);
                    link_type = parse_link_type(predecessors_array[j]);
                    
                    for(var k = 0; k < savelist.length; k++)
                    {
                        
                        
                        if(savelist[k].RowNum == myString && savelist[k].id != null)
                        {
                            //alert('inside if>>>>>>>>');
                            new_linked_ids1 =savelist[k].id;
                            new_linked_ids.push(new_linked_ids1);
                        }
                        
                        else if(savelist[k].RowNum == myString)
                        {
                            //alert('inside else if>>>>>>>>');
                            // alert('savelist[k].projId>>>'+savelist[k].projId);
                            new_linked_ids1 = savelist[k].projId ;
                            new_linked_ids.push(new_linked_ids1);
                            
                        }
                        
                    }
                }
                var links = task.$target;
                var obsolete_links = [];
                var valid_link = 0;
                //looking for obsolete links
                
                
                for(var i = 0; i < links.length; i++){
                    //alert('inside onsavebox');
                    var obsolete_controller = 1;
                    var link = gantt.getLink(links[i]);
                    if (link.source){
                        var temp_task = gantt.getTask(link.source);
                        if (temp_task) {
                            var pred = gantt.getTask(link.source).id
                            for (var K = 0; K < new_linked_ids.length; K++) {
                                if (new_linked_ids[k] == pred) obsolete_controller = 0;
                            }
                        }
                        if (obsolete_controller) obsolete_links.push(link.id)
                            }
                }
                
                //delete all obsolete links
                
                
                for (var i = 0; i < obsolete_links.length; i++) 
                {
                    gantt.deleteLink(obsolete_links[i]);
                }
                
                var new_link1 =[];
                var predecessors_array1 = [];
                if (task.predecessors) predecessors_array1 = task.predecessors.split(",");
                for (var m = 0; m < predecessors_array1.length; m++) {
                    // var predecessor_id = parseFloat(predecessors_array1[m]);
                    var resmyString ='';
                    var predeString='';
                    predeString = predecessors_array1[m];
                    if(predeString.charAt(0) === '-' || predeString.charAt(0) === '+')
                    {
                        predeString = predeString.substr(1);
                        
                        
                    }
                    else if (isNaN(predeString.charAt(0))){
                        predeString ='';
                        document.getElementById("predecErrMsg").style.display = 'block';
                        setTimeout(closepredecErrMsg,2200);
                        gantt.updateTask(task.id,task);
                        return false;   
                        
                    }
                    predecessors_array1[m] = predeString;
                    resmyString = predecessors_array1[m];
                    
                    
                    resmyString = resmyString.replace(/(?![+-]?\d*\.?\d+|e[+-]\d+)[^0-9]/g,'');
                    
                    if(resmyString.includes("+"))
                    {
                        
                        resmyString = resmyString.split("+");
                        resmyString = resmyString[0];
                        
                        
                    }
                    
                    else if(resmyString.includes("-"))
                    {
                        
                        resmyString = resmyString.split("-");
                        resmyString = resmyString[0];
                        
                    }
                    var poslag ='';
                    var neglag ='';
                    if(predecessors_array1[m].includes("+"))
                    {
                        
                        poslag = predecessors_array1[m].split("+");
                    }
                    else if(predecessors_array1[m].includes("-"))
                    {
                        
                        neglag = predecessors_array1[m].split("-");
                        
                    }
                    var LagSign ='';
                    
                    if(neglag !=null && neglag != 'undefined' && neglag != ''){
                        var naglagval = parseInt(neglag[1]);
                        if(naglagval == 0)
                        {
                            naglagval = naglagval;
                        }
                        else{
                            naglagval = '-'+naglagval;
                            
                        }
                        //alert('naglagval>>>>'+naglagval);
                        
                        LagSign = naglagval;
                        
                    }
                    
                    
                    if(poslag !=null && poslag != 'undefined' && poslag != ''){
                        
                        var poslagval = parseInt(poslag[1]);
                        //poslagval ='+'+poslagval;
                        LagSign = poslagval;
                    }
                    
                    
                    var lagres ='';
                    if(isNaN(LagSign)){
                        lagres = 0; 
                        //lagres = '+'+0;
                    }else{
                        
                        lagres = LagSign;
                        
                    }
                    //alert('lagres>>>>>'+lagres);
                    
                    
                    for(var l = 0; l < savelist.length; l++)
                    {
                        //source ='';
                        if(savelist[l].RowNum == resmyString && savelist[l].id != null)
                        {
                            if(gantt.isTaskExists(savelist[l].id))
                            {
                                source=savelist[l].id;
                            }
                            
                        }
                        
                        else if(savelist[l].RowNum == resmyString)
                        {
                            if(gantt.isTaskExists(savelist[l].projId))
                            {
                                source=savelist[l].projId;
                            }
                        }
                    }
                    
                    var link_type = parse_link_type(predecessors_array1[m]);
                    var ParentId = gantt.getParent(task.id);
                    if(source == task.id)
                    {
                        task.predecessors = predoldvalue;
                        prevPredVal = task.predecessors;
                        document.getElementById("warningToastForPred1").style.display = 'block';
                        setTimeout(closewarningToastForPred1,7200);
                        
                        var predecessors_array_Parent = [];
                        if(prevPredVal) predecessors_array_Parent = prevPredVal.split(",");
                        for (var PP = 0; PP < predecessors_array_Parent.length; PP++) 
                        {
                            var PredString ='';
                            PredString = predecessors_array_Parent[PP];
                            PredString = PredString.replace(/(?![+-]?\d*\.?\d+|e[+-]\d+)[^0-9]/g,'');
                            if(PredString.includes("+"))
                            {
                                
                                PredString = PredString.split("+");
                                PredString = PredString[0];
                                
                                
                            }
                            
                            else if(PredString.includes("-"))
                            {
                                
                                PredString = PredString.split("-");
                                PredString = PredString[0];
                                
                            }
                            var PPposlag ='';
                            var PPneglag ='';
                            if(predecessors_array_Parent[PP].includes("+"))
                            {
                                
                                PPposlag = predecessors_array_Parent[PP].split("+");
                            }
                            else if(predecessors_array_Parent[PP].includes("-"))
                            {
                                
                                PPneglag = predecessors_array_Parent[PP].split("-");
                                
                            }
                            var PPLagSign ='';
                            if(PPneglag !=null && PPneglag != 'undefined' && PPneglag != ''){
                                var PPnaglagval = parseInt(neglag[1]);
                                if(PPnaglagval == 0)
                                {
                                    PPnaglagval = PPnaglagval;
                                }
                                else{
                                    PPnaglagval = '-'+PPnaglagval;
                                    
                                }
                                //alert('naglagval>>>>'+naglagval);
                                
                                PPLagSign = PPnaglagval;
                                
                            }
                            
                            if(PPposlag !=null && PPposlag != 'undefined' && PPposlag != ''){
                                
                                var PPposlagval = parseInt(PPposlag[1]);
                                //poslagval ='+'+poslagval;
                                PPLagSign = PPposlagval;
                            }
                            
                            //var lagres;
                            if(isNaN(PPLagSign)){
                                lagres = 0; 
                                //lagres = '+'+0;
                            }
                            else{
                                
                                lagres = PPLagSign;
                                
                            }
                            for(var l = 0; l < savelist.length; l++)
                            {
                                if(savelist[l].RowNum == PredString && savelist[l].id != null)
                                {
                                    if(gantt.isTaskExists(savelist[l].id))
                                    {
                                        var source=savelist[l].id;
                                    }
                                    
                                }
                                
                                else if(savelist[l].RowNum == PredString)
                                {
                                    if(gantt.isTaskExists(savelist[l].projId))
                                    {
                                        var source=savelist[l].projId;
                                    }
                                }
                            }
                            var link_type = parse_link_type(predecessors_array_Parent[PP]);
                            
                        }
                        
                        
                    }else if( source == null || source =='' || source == undefined){
                        document.getElementById("warningToastForPred2").style.display = 'block';
                        //gantt.hideLightbox();
                        setTimeout(closewarningToastForPred2,2200); 
                        return false
                    }else if(source == ParentId){
                        
                        task.predecessors = predoldvalue;
                        prevPredVal = task.predecessors;
                        
                        document.getElementById("warningToastForPred").style.display = 'block';
                        setTimeout(closewarningToastForPred,7200);
                        var predecessors_array_Parent = [];
                        if(prevPredVal) predecessors_array_Parent = prevPredVal.split(",");
                        for (var PP = 0; PP < predecessors_array_Parent.length; PP++) 
                        {
                            var PredString ='';
                            PredString = predecessors_array_Parent[PP];
                            PredString = PredString.replace(/(?![+-]?\d*\.?\d+|e[+-]\d+)[^0-9]/g,'');
                            if(PredString.includes("+"))
                            {
                                
                                PredString = PredString.split("+");
                                PredString = PredString[0];
                                
                                
                            }
                            
                            else if(PredString.includes("-"))
                            {
                                
                                PredString = PredString.split("-");
                                PredString = PredString[0];
                                
                            }
                            var PPposlag ='';
                            var PPneglag ='';
                            if(predecessors_array_Parent[PP].includes("+"))
                            {
                                
                                PPposlag = predecessors_array_Parent[PP].split("+");
                            }
                            else if(predecessors_array_Parent[PP].includes("-"))
                            {
                                
                                PPneglag = predecessors_array_Parent[PP].split("-");
                                
                            }
                            var PPLagSign ='';
                            if(PPneglag !=null && PPneglag != 'undefined' && PPneglag != ''){
                                var PPnaglagval = parseInt(neglag[1]);
                                if(PPnaglagval == 0)
                                {
                                    PPnaglagval = PPnaglagval;
                                }
                                else{
                                    PPnaglagval = '-'+PPnaglagval;
                                    
                                }
                                //alert('naglagval>>>>'+naglagval);
                                
                                PPLagSign = PPnaglagval;
                                
                            }
                            
                            if(PPposlag !=null && PPposlag != 'undefined' && PPposlag != ''){
                                
                                var PPposlagval = parseInt(PPposlag[1]);
                                //poslagval ='+'+poslagval;
                                PPLagSign = PPposlagval;
                            }
                            
                            //var lagres;
                            if(isNaN(PPLagSign)){
                                lagres = 0; 
                                //lagres = '+'+0;
                            }
                            else{
                                
                                lagres = PPLagSign;
                                
                            }
                            for(var l = 0; l < savelist.length; l++)
                            {
                                if(savelist[l].RowNum == PredString && savelist[l].id != null)
                                {
                                    if(gantt.isTaskExists(savelist[l].id))
                                    {
                                        var source=savelist[l].id;
                                    }
                                    
                                }
                                
                                else if(savelist[l].RowNum == PredString)
                                {
                                    if(gantt.isTaskExists(savelist[l].projId))
                                    {
                                        var source=savelist[l].projId;
                                    }
                                    
                                }
                            }
                            var link_type = parse_link_type(predecessors_array_Parent[PP]);
                            
                        }
                        
                        
                        //return false;    
                    }
                    
                    
                    var new_link1 = { source: source, target: task.id, type: link_type,lag:lagres} 
                    
                    var isCircular = gantt.isCircularLink(new_link1);
                    if(isCircular == false){
                        gantt.addLink(new_link1);
                        gantt.focus(); 
                        setTimeout(function() {
                            gantt.ext.keyboardNavigation.focus({type:"taskCell", id:state.id, column:'predecessors'})
                        }, 1);
                    }
                    else if(isCircular == true){
                        
                        document.getElementById("CircularLoopValid").style.display = 'block';
                        setTimeout(closeCircularLoopValid,2700);
                        
                        if(task.$target.length ==0)
                        {
                            task.predecessors ='';
                        }
                    }
                        else{
                            gantt.addLink(new_link1);
                        }
                }
                
                
            }
            
            gantt.updateTask(state.id);
            gantt.autoSchedule(state.id);
            
            gantt.render();
            
        });
        
        
        //gantt.init("gantt_here");
        //var tasks = gantt.getTaskByTime();
        
        gantt.config.open_tree_initially = true;        
        document.getElementById("spinner").style.display = "none";
        var SaveTempRecords;
        
        
        function updateEffectiveDatePred(task){	
            if(task.predecessors){	
                var target = gantt.getTask(task.id).$target;
                if(target){	
                    for(var i=0;i<target.length;i++)
                    {	
                        var link = gantt.getLink(target[i]);	
                        var pred = gantt.getTask(link.source); 	
                        var pred1 = gantt.getTask(link.target);	
                        var typ = link.type;	
                        var lag = parseInt(link.lag);	
                        
                        if(pred.text.toUpperCase() === "EFFECTIVE DATE" && !gantt.isWorkTime(pred.start_date)){	
                            console.log('start date before change',task.start_date);	
                            console.log('end date before change',task.end_date);                            	
                            console.log('actual duration',task.duration)	
                            let duration = parseInt(task.duration);	
                            if(duration > 5){	
                                let additionalDays = Math.floor(duration/5)*2;	
                                duration = duration + additionalDays;	
                            }	
                            console.log('new  duration is ===>',duration);	
                            
                            //duration =  duration-1;	
                            if(!gantt.isWorkTime(pred.start_date)) {	
                                task.start_date = gantt.getClosestWorkTime({date:pred.start_date, dir:"future" });	
                            }	
                            //task['calender_id'] ='Normal';
                            task.start_date = gantt.date.add(task.start_date, lag, "day");
                            
                            console.log(task.text,'lag is '+lag);	
                            /* if(typ == 1){	
                                
                            }else if(typ == 2){	
                                
                            }else if(typ == 3){	
                                
                            }*/	
                            
                            if(!gantt.isWorkTime(task.start_date)) {	
                                task.start_date = gantt.getClosestWorkTime({date:task.start_date, dir:"future" });	
                            }	
                            task.end_date = gantt.date.add(task.start_date, duration, "day");	
                            if(!gantt.isWorkTime(task.end_date)) {	
                                task.end_date = gantt.getClosestWorkTime({date:task.end_date, dir:"future" });	
                            }	
                        }	
                    }	
                }	
            }	
            
        }
        
        function savechart(flagval)
        {
            console.log('calling save chart');
            
            var saveflag = flagval;
            var Taskdata = gantt.serialize();
            var tasks = Taskdata.data;
            console.log('tasks after save',tasks);
            
            var taskArrayInsert = [];
            
            if(tasks.length != 0 ){
                
                var predvalues = '';
                var statusvalues = '';
                var typevalues = '';
                var linkidvalues = '';
                var resvalues = '';
                var rolvalues = '';
                var linkvalues = [];
                var resource = [];
                //var rolearr = [];
                for(var i=0;i < tasks.length; i++)  //looping through the tasks
                {
                    tasks[i].target = gantt.getTask(tasks[i].id).$target;
                    tasks[i].source = gantt.getTask(tasks[i].id).$source;
                    tasks[i].rendered_type = gantt.getTask(tasks[i].id).$rendered_type;
                    tasks[i].wbs = gantt.getTask(tasks[i].id).$wbs;
                    tasks[i].actual_finish = gantt.getTask(tasks[i].id).actual_finish;
                    tasks[i].start_date = gantt.getTask(tasks[i].id).start_date;
                    tasks[i].end_date = gantt.getTask(tasks[i].id).end_date;
                    tasks[i].predecessors ='';
                    var target = tasks[i].target;
                    var source = tasks[i].source;
                    var labels = [];
                    var linktypes = [];
                    var linkid = [];
                    var res = tasks[i].owner_id;
                    var rol = tasks[i].role;
                    var prog = tasks[i].progress;
                    console.log(i+'rec:::'+JSON.stringify(res));
                    console.log(i+'prog::'+JSON.stringify(prog));
                    resource.push(res);
                    for(var j = 0; j < target.length; j++)  //looping to get multiple predecessors
                    {
                        var link = gantt.getLink(target[j]);
                        //console.log(i+' link:::'+JSON.stringify(link));
                        //console.log(i+' link id:::'+link.id);
                        var pred = gantt.getTask(link.source); 
                        var pred1 = gantt.getTask(link.target);//getting the predecessors
                        console.log(i+' pred:::'+JSON.stringify(pred));
                        var typ = link.type;
                        var lag = link.lag;
                        if(typ == 0){
                            typedup = 'FS';
                        }
                        else if(typ == 1){
                            typedup = 'SS';
                        }else if(typ == 2){
                            typedup = 'FF';
                        }else if(typ == 3){
                            typedup = 'SF';
                        }
                        var sign;
                        if(lag >= 0){
                            sign ='+';
                        }else{
                            sign ='';  
                        }
                        
                        
                        if(lag == null || lag == '' || lag == undefined){
                            lag =0;
                            sign ='+';
                            if(labels.indexOf(gantt.getTaskNumber(pred)+typedup+sign+lag+'days') == -1){
                                labels.push(gantt.getTaskNumber(pred)+typedup+sign+lag+'days');
                            }
                        }else{ 
                            if(labels.indexOf(gantt.getTaskNumber(pred)+typedup+sign+lag+'days') == -1){
                                labels.push(gantt.getTaskNumber(pred)+typedup+sign+lag+'days');
                            }
                        }
                        //labels.push(gantt.getWBSCode(pred));    //getting WBS of the predecessors
                        
                        linktypes.push(link.type);  //to get type
                        //alert('labels'+JSON.stringify(labels));
                        linkid.push(link.id);   //to get link
                        
                        linkvalues.push(link);    //feature inprogress
                    }
                    if(typeof labels !== 'undefined' && labels.length > 0)  //to filter out empty labels
                    {
                        tasks[i].predecessors = labels.join(",");
                        var value = '{'+tasks[i].id + '=' + labels.join(",")+'},';  //to create string format of predecessor
                        predvalues+=value;              //adding final value to the array to sent to apex
                    }
                    //for type
                    if(typeof linktypes !== 'undefined' && linktypes.length > 0)  //to filter out empty linktypes
                    {
                        var value = '{'+tasks[i].id + '=' + linktypes.join(",")+'},';
                        typevalues+=value;              //adding final type values to the array to sent to apex
                    }
                    //for link id
                    if(typeof linkid !== 'undefined' && linkid.length > 0)  //to filter out empty linkids
                    {
                        var value = '{'+tasks[i].id + '=' + linkid.join(",")+'},';
                        linkidvalues+=value;              //adding final linkids to the array to sent to apex
                    }
                    
                    if(prog !== undefined && prog != null && prog !='')  
                    {
                        var progress = prog;
                        var progressStr = progress.toString();
                        if(progressStr.indexOf('0.')> -1){
                            progress = progress*100
                        }else{
                            tasks[i].progress = progress/100;
                        }
                        tasks[i].progress = Math.round(progress);
                    }
                    
                }
                var links = gantt.serialize().links;  //returns all links
                //alert('links>>>>>'+JSON.stringify(deletelinkvalues));
                for(var li=0;li<links.length; li++){                              //goes over all links
                    var linkId = links[li].id;
                    console.log('linkId>>>>'+linkId);
                };
                
                
                var UpdateList = [];
                var insertList = [];
                for(var tsk = 0; tsk < tasks.length; tsk++){
                    var rowNumber = tsk+1;
                    var src = '';
                    var target = '';
                    var linkId = '';
                    var taskobj = {};
                    //taskobj['sobjectType'] = 'Project_Task__c';
                    if(tasks[tsk].sfdcid != null && tasks[tsk].sfdcid != 'undefined'&& tasks[tsk].sfdcid != ''){
                        taskobj['sfdcid'] = tasks[tsk].sfdcid;
                    }
                    if(tempflag == true){
                        tasks[tsk].actual_finish = null;
                        tasks[tsk].progress = 0
                    }else{
                        if(tasks[tsk].actual_finish == 'N/A'){
                            tasks[tsk].actual_finish = null;
                        }
                        tasks[tsk].progress = tasks[tsk].progress;
                    }
                    taskobj['Actual_Finish__c'] = formatDate(tasks[tsk].actual_finish);
                    taskobj['Project_Task_Id__c'] = tasks[tsk].id;
                    taskobj['WBS_Code__c'] = tasks[tsk].wbs;
                    taskobj['Project_Task_Name__c'] = tasks[tsk].text;
                    taskobj['Start_Date__c'] = formatDate(tasks[tsk].start_date);
                    taskobj['End_Date__c'] = formatDate(tasks[tsk].end_date);
                    taskobj['Duration__c'] = tasks[tsk].duration;
                    //taskobj['priority__c'] = tasks[tsk].priority;
                    taskobj['predecessors__c'] = tasks[tsk].predecessors;
                    taskobj['Project_Type__c'] = tasks[tsk].rendered_type;
                    taskobj['Resource_Id__c'] = splitArraytoString(tasks[tsk].owner_id);
                    taskobj['Checked__c'] = tasks[tsk].checked;
                    taskobj['Progress__c'] = tasks[tsk].progress;
                    taskobj['Notes__c'] = tasks[tsk].Notes;
                    taskobj['Dashboard__c'] = tasks[tsk].dashboard;
                    taskobj['Mark_as_Milestone__c'] = spitMileStone(tasks[tsk].split);
                    taskobj['Parent__c'] = tasks[tsk].parent;
                    taskobj['Row_Number__c'] = rowNumber;
                    taskobj['Additional_Comments__c'] = tasks[tsk].Additional_Comments;
                    //taskobj['sfdcid'] = tasks[tsk].sfdcid;
                    if(linkvalues.length>0){
                        for(var lnk =0; lnk<linkvalues.length; lnk++){
                            if(tasks[tsk].id == linkvalues[lnk].source){
                                taskobj['source__c'] = tasks[tsk].id;
                                if(taskobj['target__c'] == null || taskobj['target__c'] == undefined || taskobj['target__c'] == ''){
                                    taskobj['target__c'] = linkvalues[lnk].target;
                                }else{
                                    taskobj['target__c'] = taskobj['target__c']+','+linkvalues[lnk].target;
                                }
                                if(taskobj['linkId__c'] == null || taskobj['linkId__c'] == undefined || taskobj['linkId__c'] == ''){
                                    taskobj['linkId__c'] = linkvalues[lnk].id;
                                }else{
                                    taskobj['linkId__c'] = taskobj['linkId__c']+','+linkvalues[lnk].id;
                                }
                                if(taskobj['lag__c'] == null || taskobj['lag__c'] == undefined || taskobj['lag__c'] == ''){
                                    taskobj['lag__c'] = checkLag(linkvalues[lnk].lag);
                                }else{
                                    taskobj['lag__c'] = taskobj['lag__c']+','+checkLag(linkvalues[lnk].lag);
                                }
                                if(taskobj['type__c'] == null || taskobj['type__c'] == undefined || taskobj['type__c'] == ''){
                                    taskobj['type__c'] = linkvalues[lnk].type;
                                }else{
                                    taskobj['type__c'] = taskobj['type__c']+','+linkvalues[lnk].type;
                                }
                            }
                        }
                    }
                    insertList.push(JSON.stringify(taskobj));
                }
                function splitArraytoString(arrVal){
                    return arrVal.join();
                }
                function formatDate(dateVal){
                    var dtVal;
                    if(dateVal != null && dateVal != undefined){
                        var month = dateVal.getMonth()+1;
                        month =month.toString();
                        var day =dateVal.getDate().toString();
                        var year = dateVal.getFullYear().toString();
                        if(month.length ==1){ 
                            month = '0'+month;
                        }
                        if(month.length ==1){ 
                            day = '0'+dateVal.getDate();
                        }
                        dtVal = year+'-'+month+'-'+day;
                    }else{
                        dtVal = null;
                    }
                    return dtVal;
                }
                function checkLag(lagval){
                    if(lagval == null || lagval == undefined || lagval ==''){
                        lagval = 0;
                        return lagval.toString();
                    }else{
                        return lagval;
                    }
                }
                
                function spitMileStone(milestoneval){
                    if(milestoneval == 'null' || milestoneval == 'undefined' || milestoneval=='' || milestoneval==[])
                    {
                        milestoneval = false
                    }
                    var ismilestone =false
                    if (typeof milestoneval === "boolean"){
                        ismilestone = milestoneval
                        return ismilestone;
                    }else{
                        
                        var milestone = JSON.parse(milestoneval);
                        if(milestone == true){
                            ismilestone = milestone;
                        }
                        else{
                            ismilestone = milestone[0];
                        }
                        return ismilestone;
                    }
                }
                //callapex(JSON.stringify(tasks),JSON.stringify(predvalues),JSON.stringify(statusvalues),JSON.stringify(typevalues),JSON.stringify(linkidvalues),JSON.stringify(linkvalues),JSON.stringify(deletetaskvalues),JSON.stringify(resvalues));
                Visualforce.remoting.timeout = 120000;
                Visualforce.remoting.Manager.invokeAction(
                    '{!$RemoteAction.ganttcontroller.callToSetSelectedFieldsFunc}',
                    insertList,'{!JSENCODE(currentRecordId)}',deletetaskvalues,false,
                    function(result, event){
                        SaveTempRecords = result;
                        let isSuccess;
                        let errMsg;
                        if (event.status) {
                            if(saveflag == 'issavetrue')
                            {
                                
                                for(var i=0; i<result.length; i++)
                                {
                                    isSuccess = result[i].isSuccess;
                                    errMsg = result[i].ErrorMsg;
                                    /*if(result[i].cases[0] != null && result[i].cases[0] != undefined && result[i].cases.length>0){
                                           tasks = gantt.getTask(result[i].cases[0].Project_Task_Id__c);
                                            tasks.sfdcid = result[i].cases[0].Id;
                                            tasklistdata.data = gantt.getTask(result[i].cases[0].Project_Task_Id__c);
                                            tasklistdata.data.sfdcid = result[i].cases[0].Id;
                                        }*/
                                    
                                }
                                if(!isSuccess){
                                    document.getElementById("failHeader").style.display = 'block'; 
                                    document.getElementById("failHeader").innerHTML = errMsg;
                                    document.getElementById("failTemplateHeader").style.display = 'none';   
                                    document.getElementById("failureToast").style.display = 'block';
                                    //setTimeout(reload,700);
                                }else{
                                    document.getElementById("saveHeader").style.display = 'block';  
                                    document.getElementById("saveTemplateHeader").style.display = 'none';   
                                    document.getElementById("succesToast").style.display = 'block';
                                    setTimeout(closeToast,1700);
                                    document.getElementById("spinner").style.display = 'none';
                                    for(var i=0; i<result.length; i++)
                                    {
                                        //isSuccess = result[i].isSuccess;
                                        //errMsg = result[i].ErrorMsg;
                                        if(result[i].cases[0] != null && result[i].cases[0] != undefined && result[i].cases.length>0){
                                            tasks = gantt.getTask(result[i].cases[0].Project_Task_Id__c);
                                            tasks.sfdcid = result[i].cases[0].Id;
                                            //serdata = gantt.getTask(result[i].cases[0].Project_Task_Id__c);
                                            gantt.getTask(result[i].cases[0].Project_Task_Id__c).sfdcid = result[i].cases[0].Id;
                                            if(result[i].cases[0].predecessors__c != null && result[i].cases[0].predecessors__c !='' && result[i].cases[0].predecessors__c != undefined)
                                            {
                                                gantt.getTask(result[i].cases[0].Project_Task_Id__c).predecessors = result[i].cases[0].predecessors__c;
                                                
                                            }
                                            else
                                            {
                                                gantt.getTask(result[i].cases[0].Project_Task_Id__c).predecessors ='';
                                            }
                                        }
                                        
                                    }
                                } 
                            }
                            else if(saveflag == 'issaveandclose')
                            {
                                document.getElementById("saveHeader").style.display = 'block';  
                                document.getElementById("saveTemplateHeader").style.display = 'none';   
                                document.getElementById("succesToast").style.display = 'block'; 
                                setTimeout(back,700);
                            }
                        } else if (event.type === 'exception') { 
                            //alert('something went wrong contact system admin ');
                            document.getElementById("failHeader").style.display = 'block';  
                            document.getElementById("failTemplateHeader").style.display = 'none';   
                            document.getElementById("failureToast").style.display = 'block';
                            setTimeout(back,700);
                        } else {
                            document.getElementById("failHeader").style.display = 'block';  
                            document.getElementById("failTemplateHeader").style.display = 'none';   
                            document.getElementById("failureToast").style.display = 'block';
                            setTimeout(back,700);
                            
                            //alert('something went wrong contact system admin ');
                        }
                    }, 
                    {buffer:false ,escape: true,timeout: 120000}
                );
                document.getElementById("spinner").style.display = "block";
            }
            else
            {
                document.getElementById("warningToastwithnotask").style.display = 'block';
                setTimeout(closewarningToastFornotask,5200);
            }
        }
        
        function modal(foo)
        {
            //alert('inside modelll::'+tempflag);
            if(tempflag == true)
            {
                //alert('inside true');
                document.getElementById("modal").style.display = 'none';
            }
            else
            {
                document.getElementById("modal").style.display = 'block';
            }
            
        }
        function cancel()
        {
            document.getElementById("modal").style.display = 'none';
        }
        function back()
        {     
            window.parent.location.href = '/'+'{!Project_Template__c.id}';
            //history.back();
        }
        function reload()
        {       
            window.location.reload();
        }
        /*function save()
        {
            document.getElementById("spinner").style.display = "none";
            document.getElementById("saveTemplateHeader").style.display = 'block';  
            document.getElementById("saveHeader").style.display = 'none';   
            document.getElementById("succesToast").style.display = 'block';
            
        }
        function saveSuccess()
        {
            document.getElementById("saveHeader").style.display = 'block';  
            document.getElementById("saveTemplateHeader").style.display = 'none';   
            document.getElementById("succesToast").style.display = 'block'; 
            //setTimeout(reload,7000);
        }
        function save_close_Success()
        {            
            document.getElementById("saveHeader").style.display = 'block';  
            document.getElementById("saveTemplateHeader").style.display = 'none';   
            document.getElementById("succesToast").style.display = 'block'; 
            setTimeout(back,700);     
        }
    */        
        
        function closewarningToast()
        {
            document.getElementById("warningToast").style.display = "none";
        }
        function closewarningText()
        {
            document.getElementById("warningToastFortext").style.display = "none";
        }
        function closewarningres()
        {
            document.getElementById("warningToastForres").style.display = "none";
        }
        function closewarningtempname()
        {
            document.getElementById("ErrorToasttempname").style.display = "none";
        }
        function closewarningToastForPred()
        {
            document.getElementById("warningToastForPred").style.display = 'none'; 
        }
        function closewarningToastForPred1()
        {
            document.getElementById("warningToastForPred1").style.display = 'none'; 
        }
        function closewarningToastForPred2()
        {
            document.getElementById("warningToastForPred2").style.display = 'none'; 
        }
        function closewarningToastForActualfinish()
        {
            document.getElementById("warningToastForActualfinish").style.display = 'none'; 
        }
        function closewarningToastFornotask()
        {
            document.getElementById("warningToastwithnotask").style.display = 'none'; 
        }
        function closewarningToastsave1()
        {
            document.getElementById("ErrorToastsaveastemplate").style.display = 'none'; 
        }
        function closewarningToastwithnotask()
        {
            document.getElementById("warningToastwithnotask").style.display = 'none';
            document.getElementById("succesToast").style.display = 'none';
            
        }
        function closeprojectenddate()
        {
            document.getElementById("ProjectEnd_date").style.display = 'none';
        }
        function closeprojectstartdate()
        {
            document.getElementById("ProjectStart_date").style.display = 'none';
        }
        function closeprojectProjectactual_finish()
        {
            document.getElementById("Projectactual_finish").style.display = 'none';
        }
        function closewarningToastsaveastemp()
        {
            document.getElementById("warningToastsaveastemp").style.display = 'none'; 
        }
        function closeprojectduration()
        {
            document.getElementById("ProjectDuration").style.display = 'none'; 
        }
        function closestartdateValid()
        {
            document.getElementById("StartdateValid").style.display = 'none'; 
        }
        function closeprojectfinishValid()
        {
            document.getElementById("EnddateValid").style.display = 'none'; 
        }
        function closeActualfinishValid()
        {
            document.getElementById("ActualFinishValid").style.display = 'none'; 
        }
        function closeCircularLoopValid()
        {
            document.getElementById("CircularLoopValid").style.display = 'none'; 
        }
        function closepredecErrMsg()
        {
            document.getElementById("predecErrMsg").style.display = 'none'; 
        }
        function closeisDeleteTask()
        {
            document.getElementById("isDeleteTask").style.display = 'none'; 
        }
        function closeconfirmDeleteTask()
        {
            document.getElementById("confirmDeleteTask").style.display = 'none'; 
        }
        
        function closecheckboxWarningforMilestone()
        {
            document.getElementById("checkboxWarningforMilestone").style.display = 'none'; 
        }
        function closedashbordWarningforMilestone()
        {
            document.getElementById("dashbordWarningforMilestone").style.display = 'none'; 
        }
        
        function saveTemplateSuccess()
        {
            // save as template flow 
            var teamplateteam;
            var templname=document.getElementById("text-input-id-1").value;
            //alert('templname>>'+templname);
            if(templname!='')
            {
                Visualforce.remoting.Manager.invokeAction(
                    '{!$RemoteAction.ganttcontroller.calltemplateFunc}',
                    templname,'{!JSENCODE(currentRecordIdtemp)}',
                    function(result, event){
                        if (event.status) 
                        {
                            if(event.result == null)
                            {  
                                document.getElementById("modal").style.display = 'none';
                                document.getElementById("ErrorToastsaveastemplate").style.display = 'block';
                                setTimeout(closewarningToastsave1,1200);    // added to not to refresh the page 
                            }
                            else
                            {
                                teamplateteam = event.result;
                                saveastemplatefunc(teamplateteam);
                            }
                        } else if (event.type === 'exception') { 
                            
                        } else {
                            
                        }
                    }, 
                    {buffer:false ,escape: true,timeout: 120000}
                ); 
            }
            else{
                document.getElementById("ErrorToasttempname").style.display = 'block';
                setTimeout(closewarningtempname,1000);
            }
            
            
        }
        function saveastemplatefunc(teamplateteam){
            //var tasks = gantt.getTaskByTime();
            //var tasks = recordstemplate;
            var tasks = gantt.serialize().data;
            var projTeam = resourceArr ;
            var insertList = [];
            if(tasks.length != 0 )
            {
                var predvalues = '';
                var statusvalues = '';
                var typevalues = '';
                var linkidvalues = '';
                var resvalues = '';
                var rolvalues = '';
                var linkvalues = [];
                var resource = [];
                for(var i=0;i < tasks.length; i++)  //looping through the tasks
                {
                    tasks[i].target = gantt.getTask(tasks[i].id).$target;
                    tasks[i].source = gantt.getTask(tasks[i].id).$source;
                    tasks[i].rendered_type = gantt.getTask(tasks[i].id).$rendered_type;
                    tasks[i].wbs = gantt.getTask(tasks[i].id).$wbs;
                    tasks[i].actual_finish = gantt.getTask(tasks[i].id).actual_finish;
                    tasks[i].start_date = gantt.getTask(tasks[i].id).start_date;
                    tasks[i].end_date = gantt.getTask(tasks[i].id).end_date;
                    var target = tasks[i].target;
                    var source = tasks[i].source;
                    var labels = [];
                    var linktypes = [];
                    var linkid = [];
                    var res = tasks[i].owner_id;
                    var rol = tasks[i].role;
                    var prog = tasks[i].progress;
                    console.log(i+'rec:::'+JSON.stringify(res));
                    console.log(i+'prog::'+JSON.stringify(prog));
                    resource.push(res);
                    for(var j = 0; j < target.length; j++)  //looping to get multiple predecessors
                    {
                        var link = gantt.getLink(target[j]);
                        //console.log(i+' link:::'+JSON.stringify(link));
                        //console.log(i+' link id:::'+link.id);
                        var pred = gantt.getTask(link.source); 
                        var pred1 = gantt.getTask(link.target);//getting the predecessors
                        console.log(i+' pred:::'+JSON.stringify(pred));
                        var typ = link.type;
                        var lag = link.lag;
                        if(typ == 0){
                            typedup = 'FS';
                        }
                        else if(typ == 1){
                            typedup = 'SS';
                        }
                            else if(typ == 2){
                                typedup = 'FF';
                            }
                                else if(typ == 3){
                                    typedup = 'SF';
                                }
                        var sign;
                        if(lag >= 0){
                            sign ='+';
                        }
                        else{
                            sign ='';  
                        }
                        
                        
                        if(lag == null || lag == '' || lag == undefined)
                        {
                            lag =0;
                            sign ='+';
                            if(labels.indexOf(gantt.getTaskNumber(pred)+typedup+sign+lag+'days') == -1)
                            {
                                labels.push(gantt.getTaskNumber(pred)+typedup+sign+lag+'days');
                            }
                        }
                        else
                        { 
                            if(labels.indexOf(gantt.getTaskNumber(pred)+typedup+sign+lag+'days') == -1)
                            {
                                labels.push(gantt.getTaskNumber(pred)+typedup+sign+lag+'days');
                            }
                        }
                        //labels.push(gantt.getWBSCode(pred));    //getting WBS of the predecessors
                        
                        linktypes.push(link.type);  //to get type
                        //alert('labels'+JSON.stringify(labels));
                        linkid.push(link.id);   //to get link
                        
                        linkvalues.push(link);    //feature inprogress
                    }
                    if(typeof labels !== 'undefined' && labels.length > 0)  //to filter out empty labels
                    {
                        tasks[i].predecessors = labels.join(",");
                        var value = '{'+tasks[i].id + '=' + labels.join(",")+'},';  //to create string format of predecessor
                        predvalues+=value;              //adding final value to the array to sent to apex
                    }
                    //for type
                    if(typeof linktypes !== 'undefined' && linktypes.length > 0)  //to filter out empty linktypes
                    {
                        var value = '{'+tasks[i].id + '=' + linktypes.join(",")+'},';
                        typevalues+=value;              //adding final type values to the array to sent to apex
                    }
                    //for link id
                    if(typeof linkid !== 'undefined' && linkid.length > 0)  //to filter out empty linkids
                    {
                        var value = '{'+tasks[i].id + '=' + linkid.join(",")+'},';
                        linkidvalues+=value;              //adding final linkids to the array to sent to apex
                    }
                    
                    if(prog !== undefined && prog != null && prog !='')  
                    {
                        var progress = prog;
                        var progressStr = progress.toString();
                        if(progressStr.indexOf('0.')> -1){
                            progress = progress*100
                        }else{
                            tasks[i].progress = progress/100;
                        }
                        tasks[i].progress = Math.round(progress);
                    }
                    
                }
                
                for(var tsk =0; tsk<tasks.length; tsk++){
                    if(tasks[tsk].sfdcid !=null || tasks[tsk].sfdcid !='' || tasks[tsk].sfdcid != undefined){
                        var rowNumber = tsk+1;
                        var src = '';
                        var uniqueRole = [];
                        var tskOwnerArr = tasks[tsk].owner_id;
                        var resourceIdVal = '';
                        var tempSfId = '';
                        var taskobj={};
                        //tskOwnerArr = tskOwnerArr.split(',');
                        if(tasks[tsk].actual_finish_date == 'N/A'){
                            tasks[tsk].actual_finish_date = null;
                        }
                        for(var prjTeam = 0; prjTeam<projTeam.length; prjTeam++){
                            if(tskOwnerArr.includes(projTeam[prjTeam].id)){
                                if(!uniqueRole.includes(projTeam[prjTeam].specialty)){
                                    uniqueRole.push(projTeam[prjTeam].specialty);
                                }
                            }
                        }
                        for(var tempTeam in teamplateteam){
                            tempSfId = teamplateteam[tempTeam].Project_Template__c;
                            if(uniqueRole.includes(teamplateteam[tempTeam].IPM_Roles__c)){
                                if(resourceIdVal == null || resourceIdVal == undefined || resourceIdVal == ''){
                                    resourceIdVal = teamplateteam[tempTeam].Id;
                                }else{
                                    resourceIdVal = resourceIdVal+','+teamplateteam[tempTeam].Id;
                                }
                            }
                        }
                        taskobj['Actual_Finish__c'] = null;
                        taskobj['Project_Task_Id__c'] = tasks[tsk].id;
                        taskobj['WBS_Code__c'] = tasks[tsk].wbs;
                        taskobj['Project_Task_Name__c'] = tasks[tsk].text;
                        taskobj['Start_Date__c'] = formatDate(tasks[tsk].start_date);
                        taskobj['End_Date__c'] = formatDate(tasks[tsk].end_date);
                        taskobj['Duration__c'] = tasks[tsk].duration;
                        //taskobj['priority__c'] = tasks[tsk].priority;
                        taskobj['predecessors__c'] = tasks[tsk].predecessors;
                        taskobj['Project_Type__c'] = tasks[tsk].rendered_type;
                        taskobj['Resource_Id__c'] = resourceIdVal;
                        taskobj['Checked__c'] = tasks[tsk].checked;
                        //taskobj['Progress__c'] = parseInt(tasks[tsk].progress);
                        taskobj['Progress__c'] = 0;
                        taskobj['Notes__c'] = tasks[tsk].Notes;
                        taskobj['Dashboard__c'] = tasks[tsk].dashboard;
                        taskobj['Mark_as_Milestone__c'] = spitMileStone(tasks[tsk].split);
                        taskobj['Parent__c'] = tasks[tsk].parent;
                        taskobj['Row_Number__c'] = rowNumber;
                        /*taskobj['source__c'] = tasks[tsk].source;
                    taskobj['target__c'] = tasks[tsk].target;
                    taskobj['linkId__c'] = tasks[tsk].linkid;
                    taskobj['lag__c'] = tasks[tsk].lag;
                    taskobj['type__c'] = tasks[tsk].type;*/
                        taskobj['sfdcid'] = tempSfId;
                        if(linkvalues.length>0){
                            for(var lnk =0; lnk<linkvalues.length; lnk++){
                                if(tasks[tsk].id == linkvalues[lnk].source){
                                    taskobj['source__c'] = tasks[tsk].id;
                                    if(taskobj['target__c'] == null || taskobj['target__c'] == undefined || taskobj['target__c'] == ''){
                                        taskobj['target__c'] = linkvalues[lnk].target;
                                    }else{
                                        taskobj['target__c'] = taskobj['target__c']+','+linkvalues[lnk].target;
                                    }
                                    if(taskobj['linkId__c'] == null || taskobj['linkId__c'] == undefined || taskobj['linkId__c'] == ''){
                                        taskobj['linkId__c'] = linkvalues[lnk].id;
                                    }else{
                                        taskobj['linkId__c'] = taskobj['linkId__c']+','+linkvalues[lnk].id;
                                    }
                                    if(taskobj['lag__c'] == null || taskobj['lag__c'] == undefined || taskobj['lag__c'] == ''){
                                        taskobj['lag__c'] = checkLag(linkvalues[lnk].lag);
                                    }else{
                                        taskobj['lag__c'] = taskobj['lag__c']+','+checkLag(linkvalues[lnk].lag);
                                    }
                                    if(taskobj['type__c'] == null || taskobj['type__c'] == undefined || taskobj['type__c'] == ''){
                                        taskobj['type__c'] = linkvalues[lnk].type;
                                    }else{
                                        taskobj['type__c'] = taskobj['type__c']+','+linkvalues[lnk].type;
                                    }
                                }
                            }
                        }
                        insertList.push(JSON.stringify(taskobj));
                        
                    }
                }
                
            }
            function spitMileStone(milestoneval){
                if(milestoneval == 'null' || milestoneval == 'undefined' || milestoneval=='' || milestoneval==[])
                {
                    milestoneval = false
                }
                var ismilestone =false
                if (typeof milestoneval === "boolean"){
                    ismilestone = milestoneval
                    return ismilestone;
                }else{
                    
                    var milestone = JSON.parse(milestoneval);
                    if(milestone == true){
                        ismilestone = milestone;
                    }
                    else{
                        ismilestone = milestone[0];
                    }
                    return ismilestone;
                }
            }
            function formatDate(dateVal){
                if(dateVal != null && dateVal != undefined && dateVal !=''){
                    var dateVal =  new Date(dateVal);
                    dateVal = dateVal.toISOString();
                    var dateArr = dateVal.split('T');
                    dateVal = dateArr[0]+'T00:00:00.000Z';
                    dateVal =  new Date(dateVal);                    
                }else{
                    dateVal = null;
                }
                return dateVal;
            }
            function checkLag(lagval){
                if(lagval == null || lagval == undefined || lagval ==''){
                    return 0;
                }else{
                    return lagval;
                }
            }
            Visualforce.remoting.Manager.invokeAction(
                '{!$RemoteAction.ganttcontroller.callToSetSelectedFieldsFunc}',
                insertList,'',deletetaskvalues,true,
                function(result, event){
                    if (event.status) {
                        let isSuccess;
                        let errMsg;
                        for(var i=0; i<result.length; i++)
                        {
                            isSuccess = result[i].isSuccess;
                            errMsg = result[i].ErrorMsg;
                            
                            
                        }
                        
                        if(!isSuccess){
                            document.getElementById("failHeader").style.display = 'none'; 
                            document.getElementById("failHeader").innerHTML = errMsg;
                            document.getElementById("failTemplateHeader").style.display = 'block'; 
                            document.getElementById("failTemplateHeader").innerHTML = errMsg;
                            document.getElementById("failureToast").style.display = 'block';
                            document.getElementById("spinner").style.display = 'none';
                            //setTimeout(back,700);
                        }else{
                            document.getElementById("saveHeader").style.display = 'block';  
                            document.getElementById("saveTemplateHeader").style.display = 'none';   
                            document.getElementById("succesToast").style.display = 'block';
                            //setTimeout(closeToast,1700);
                            //document.getElementById("spinner").style.display = 'none';
                            setTimeout(back,700);
                        } 
                    } 
                    else if (event.type === 'exception') { 
                        document.getElementById("failHeader").style.display = 'none';  
                        document.getElementById("failTemplateHeader").style.display = 'block';   
                        document.getElementById("failureToast").style.display = 'block';
                        setTimeout(back,700);
                    } else {
                        
                    }
                }, 
                {buffer:false ,escape: true,timeout: 120000}
            );
            document.getElementById("spinner").style.display = "block";  
        }
        
        function showTemplateModal()
        {
            //alert('inside showTemplateModal::'+tempflag);
            if(tempflag == true)
            {
                document.getElementById("modal").style.display = 'none';
                document.getElementById("warningToastsaveastemp").style.display = 'block';
                setTimeout(closewarningToastFornotask,5200);
                //history.back();
                //document.getElementById("modal").style.display = 'none';
                
                
            }
            else
            {
                document.getElementById("modal").style.display = 'block';
            }
            
            
            
            //document.getElementById("modal").style.display = 'block'; 
        }
        function closeToast()
        {
            document.getElementById("succesToast").style.display = 'none';
            document.getElementById("modal").style.display = 'none'; 
            
            //history.back();
        }
        
        var SelectedTasks =[];
        var menu = {
            undo: function(){
                gantt.undo();
            },
            redo: function(){
                gantt.redo();
            },
            zoomToFit: function(){
                toggleMode()
            },
            fullscreen: function(){
                
                if (!gantt.getState().fullscreen) {
                    // expanding the gantt to full screen
                    document.getElementById("gantt_here").style.height = '80%';
                    gantt.expand();
                }
                else {
                    // collapsing the gantt to the normal mode
                    document.getElementById("gantt_here").style.height = '70%';
                    gantt.collapse();
                }
            },
            collapseAll: function(){
                gantt.eachTask(function(task){
                    task.$open = false;
                });
                gantt.render();
            },
            expandAll: function(){
                gantt.eachTask(function(task){
                    task.$open = true;
                });
                gantt.render();
            },
            
            
            Delete: function()
            {
                var isTaskSelect = 'false';
                var isDeleted = 'false';
                
                gantt.batchUpdate(function () {
                    
                    gantt.eachSelectedTask(function(task_id){
                        //alert(gantt.getTask(task_id).RowNum);
                        
                        isTaskSelect = 'true';
                        if(gantt.isTaskExists(task_id))
                        {
                            SelectedTasks.push(task_id);
                            document.getElementById("modal1").style.display = 'block';
                            
                            //gantt.deleteTask(task_id);
                            //isDeleted = 'true';
                        }
                    });
                    
                });
                
                
                if(isTaskSelect =='false')
                {
                    document.getElementById("isDeleteTask").style.display = 'block';
                    setTimeout(closeisDeleteTask,2000); 
                }
                
                
            },
            toggleAutoScheduling: function(){
                gantt.config.auto_scheduling = !gantt.config.auto_scheduling;
            },
            toggleCriticalPath: function(){
                gantt.config.highlight_critical_path = !gantt.config.highlight_critical_path;
                gantt.render();
            },
            toPDF: function(){
                gantt.exportToPDF();
            },
            toPNG: function(){
                gantt.exportToPNG();
            },
            toExcel: function(){
                gantt.exportToExcel();
            },
            toMSProject: function(){
                gantt.exportToMSProject();
            }
        };
        
        
        
        var navBar = document.querySelector(".gantt-controls");
        gantt.event(navBar, "click", function(e){
            var target = e.target || e.srcElement;
            while(!target.hasAttribute("data-action") && target !== document.body){
                target = target.parentNode;
            }
            
            if(target && target.hasAttribute("data-action")){
                var action = target.getAttribute("data-action");
                if(menu[action]){
                    menu[action]();
                }
            }
        });
        
        function DeleteTask()
        {
            document.getElementById("spinner").style.display = 'block';
            var isDeleted = 'false';
            var tasklength = SelectedTasks.length;
            var taskid = '';
            var NextTaskId ='';
            gantt.batchUpdate(function () 
                              
                              {
                                  for(var i=0; i<SelectedTasks.length;i++){
                                      
                                      if(gantt.isTaskExists(SelectedTasks[i]))
                                      {
                                          taskid = SelectedTasks[i];
                                          //NextTaskId = gantt.getNext(taskid);
                                          NextTaskId = gantt.getPrev(taskid);
                                          
                                          
                                          gantt.deleteTask(SelectedTasks[i]);
                                          isDeleted = 'true';
                                      }
                                  }
                              });
            if(isDeleted =='true')
            {
                document.getElementById("spinner").style.display = 'none';
                document.getElementById("confirmDeleteTask").style.display = 'block';
                setTimeout(closeconfirmDeleteTask,2000);
                
                document.getElementById("modal1").style.display = 'none';
                gantt.focus(); 
                setTimeout(function() {
                    gantt.ext.keyboardNavigation.focus({type:"taskCell", id:NextTaskId, column:'text'})
                }, 1);
                
            }
            
        }
        
        function cancel1()
        {
            document.getElementById("modal1").style.display = 'none';
            
        }
        
        
        ///zoom to fit functionality:
        
        
        var toggle = false;
        function toggleMode() {
            toggle = !toggle;
            if (toggle) {
                saveConfig();
                zoomToFit();
            } else {
                //Restore previous scale state
                restoreConfig();
                gantt.render();
            }
        }
        
        var cachedSettings = {};
        
        
        
        function saveConfig() {
            var config = gantt.config;
            cachedSettings = {};
            cachedSettings.scale_unit = config.scale_unit;
            cachedSettings.date_scale = config.date_scale;
            cachedSettings.step = config.step;
            cachedSettings.subscales = config.subscales;
            cachedSettings.template = gantt.templates.date_scale;
            cachedSettings.start_date = config.start_date;
            cachedSettings.end_date = config.end_date;
        }
        
        function restoreConfig() {
            applyConfig(cachedSettings);
        }
        
        function applyConfig(config, dates) {
            gantt.config.scale_unit = config.scale_unit;
            if (config.date_scale) {
                gantt.config.date_scale = config.date_scale;
                gantt.templates.date_scale = null;
            }
            else {
                gantt.templates.date_scale = config.template;
            }
            
            gantt.config.step = config.step;
            gantt.config.subscales = config.subscales;
            
            if (dates) {
                gantt.config.start_date = gantt.date.add(dates.start_date, -1, config.unit);
                gantt.config.end_date = gantt.date.add(gantt.date[config.unit + "_start"](dates.end_date), 2, config.unit);
            } else {
                gantt.config.start_date = gantt.config.end_date = null;
            }
        }
        
        
        function zoomToFit() {
            var project = gantt.getSubtaskDates(),
                areaWidth = gantt.$task.offsetWidth;
            
            for (var i = 0; i < scaleConfigs.length; i++) {
                var columnCount = getUnitsBetween(project.start_date, project.end_date, scaleConfigs[i].unit, scaleConfigs[i].step);
                if ((columnCount + 2) * gantt.config.min_column_width <= areaWidth) {
                    break;
                }
            }
            
            if (i == scaleConfigs.length) {
                i--;
            }
            
            applyConfig(scaleConfigs[i], project);
            gantt.render();
        }
        
        // get number of columns in timeline
        function getUnitsBetween(from, to, unit, step) {
            var start = new Date(from),
                end = new Date(to);
            var units = 0;
            while (start.valueOf() < end.valueOf()) {
                units++;
                start = gantt.date.add(start, step, unit);
            }
            return units;
        }
        
        //Setting available scales
        var scaleConfigs = [
            // minutes
            {
                unit: "minute", step: 1, scale_unit: "hour", date_scale: "%H", subscales: [
                    {unit: "minute", step: 1, date: "%H:%i"}
                ]
            },
            // hours
            {
                unit: "hour", step: 1, scale_unit: "day", date_scale: "%j %M",
                subscales: [
                    {unit: "hour", step: 1, date: "%H:%i"}
                ]
            },
            // days
            {
                unit: "day", step: 1, scale_unit: "month", date_scale: "%F",
                subscales: [
                    {unit: "day", step: 1, date: "%j"}
                ]
            },
            // weeks
            {
                unit: "week", step: 1, scale_unit: "month", date_scale: "%F",
                subscales: [
                    {
                        unit: "week", step: 1, template: function (date) {
                            var dateToStr = gantt.date.date_to_str("%d %M");
                            var endDate = gantt.date.add(gantt.date.add(date, 1, "week"), -1, "day");
                            return dateToStr(date) + " - " + dateToStr(endDate);
                        }
                    }
                ]
            },
            // months
            {
                unit: "month", step: 1, scale_unit: "year", date_scale: "%Y",
                subscales: [
                    {unit: "month", step: 1, date: "%M"}
                ]
            },
            // quarters
            {
                unit: "month", step: 3, scale_unit: "year", date_scale: "%Y",
                subscales: [
                    {
                        unit: "month", step: 3, template: function (date) {
                            var dateToStr = gantt.date.date_to_str("%M");
                            var endDate = gantt.date.add(gantt.date.add(date, 3, "month"), -1, "day");
                            return dateToStr(date) + " - " + dateToStr(endDate);
                        }
                    }
                ]
            },
            // years
            {
                unit: "year", step: 1, scale_unit: "year", date_scale: "%Y",
                subscales: [
                    {
                        unit: "year", step: 5, template: function (date) {
                            var dateToStr = gantt.date.date_to_str("%Y");
                            var endDate = gantt.date.add(gantt.date.add(date, 5, "year"), -1, "day");
                            return dateToStr(date) + " - " + dateToStr(endDate);
                        }
                    }
                ]
            },
            // decades
            {
                unit: "year", step: 10, scale_unit: "year", template: function (date) {
                    var dateToStr = gantt.date.date_to_str("%Y");
                    var endDate = gantt.date.add(gantt.date.add(date, 10, "year"), -1, "day");
                    return dateToStr(date) + " - " + dateToStr(endDate);
                },
                subscales: [
                    {
                        unit: "year", step: 100, template: function (date) {
                            var dateToStr = gantt.date.date_to_str("%Y");
                            var endDate = gantt.date.add(gantt.date.add(date, 100, "year"), -1, "day");
                            return dateToStr(date) + " - " + dateToStr(endDate);
                        }
                    }
                ]
            }
        ];
        
        
        </script>
        
        <div id="modal1" style="display:none;">
            <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
                <div class="slds-modal__container slds-size_2-of-6">
                    <header class="slds-modal__header">
                        <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close">          
                            <span class="slds-assistive-text">Close</span>
                        </button>
                    </header>
                    <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                        <p>Are you sure you want to delete the selected Tasks</p>
                    </div>
                    <footer class="slds-modal__footer">
                        <button class="slds-button slds-button_neutral" onclick="cancel1()">Cancel</button>
                        <button class="slds-button slds-button_brand" onclick="DeleteTask()">Ok</button>
                    </footer>
                </div>
            </section>
            <div class="slds-backdrop slds-backdrop_open"></div>
        </div>
        
        <div id="modal" style="display:none;">
            <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
                <div class="slds-modal__container slds-size_2-of-6">
                    <header class="slds-modal__header">
                        <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close">          
                            <span class="slds-assistive-text">Close</span>
                        </button>
                        <h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">Save as Template</h2>
                    </header>
                    <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                        <div class="slds-form-element">
                            <label class="slds-form-element__label" for="text-input-id-1">Template Name</label>
                            <div class="slds-form-element__control">
                                <input id="text-input-id-1" placeholder="Please Enter Template Name" class="slds-input" type="text" value="{!templname}" />
                            </div>
                        </div>
                    </div>
                    <footer class="slds-modal__footer">
                        <button class="slds-button slds-button_neutral" onclick="cancel()">Cancel</button>
                        <button class="slds-button slds-button_brand" onclick="saveTemplateSuccess()">Save</button>
                    </footer>
                </div>
            </section>
            <div class="slds-backdrop slds-backdrop_open"></div>
        </div>
        
        
        <div id="succesToast" style="display:none;">
            <div class="slds-notify_container slds-is-fixed">
                <div class="slds-notify slds-notify_toast slds-theme_success" role="status">
                    <span class="slds-assistive-text">success</span>
                    <div class="slds-notify__content">
                        <h2 class="slds-text-heading_small" style="display:none;" id="saveTemplateHeader">Template created successfully</h2>
                        <h2 class="slds-text-heading_small" style="display:none;" id="saveHeader">Data saved successfully</h2>
                    </div>
                    <div class="slds-notify__close">
                        <button class="slds-button slds-button_icon slds-button_icon-inverse" title="Close" onclick="closeToast()" style="font-size: 16px;font-weight: bold;">X
                            <span class="slds-assistive-text">Close</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div id="failureToast" style="display:none;">
            <div class="slds-notify_container slds-is-fixed" style="word-break:break-all">
                <div class="slds-notify slds-notify_toast slds-theme_error" role="status">
                    <span class="slds-assistive-text">error</span>
                    <div class="slds-notify__content">
                        <h2 class="slds-text-heading_small" style="display:none;" id="failTemplateHeader">Template creation failure</h2>
                        <h2 class="slds-text-heading_small" style="display:none;" id="failHeader">Data creation failure</h2>
                    </div>
                    <div class="slds-notify__close">
                        <button class="slds-button slds-button_icon slds-button_icon-inverse" title="Close" onclick="closeToast()" style="font-size: 16px;font-weight: bold;">X
                            <span class="slds-assistive-text">Close</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div id="warningToast" style="display:none;">
            <div class="slds-notify_container slds-is-fixed">
                <div class="slds-notify slds-notify_toast slds-theme_error" role="status">
                    <span class="slds-assistive-text">Warning</span>
                    
                    <div class="slds-notify__content">
                        <h2 class="slds-text-heading_small" >To preview the task details please save the project.</h2>
                    </div>
                    <div class="slds-notify__close">
                        <button class="slds-button slds-button_icon slds-button_icon-inverse" title="Close" onclick="closewarningToast()" style="font-size: 16px;font-weight: bold;">X
                            <span class="slds-assistive-text">Close</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div id="warningToastForPred" style="display:none;">
            <div class="slds-notify_container slds-is-fixed" style ="">
                <div class="slds-notify slds-notify_toast slds-theme_error" role="status" style ="">
                    <span class="slds-assistive-text">Warning</span>
                    
                    <div class="slds-notify__content">
                        <h2 class="slds-text-heading_small" >Project cannot link a summary task to it's subtask</h2>
                    </div>
                    <div class="slds-notify__close">
                        <button class="slds-button slds-button_icon slds-button_icon-inverse" title="Close" onclick="closewarningToastForPred()" style="font-size: 16px;font-weight: bold;">X
                            <span class="slds-assistive-text">Close</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div id="warningToastForPred1" style="display:none;">
            <div class="slds-notify_container slds-is-fixed" style ="">
                <div class="slds-notify slds-notify_toast slds-theme_error" role="status" style ="">
                    <span class="slds-assistive-text">Warning</span>
                    
                    <div class="slds-notify__content">
                        <h2 class="slds-text-heading_small" >You cannot make a task a pedecessor of itself</h2>
                    </div>
                    <div class="slds-notify__close">
                        <button class="slds-button slds-button_icon slds-button_icon-inverse" title="Close" onclick="closewarningToastForPred1()" style="font-size: 16px;font-weight: bold;">X
                            <span class="slds-assistive-text">Close</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div id="warningToastForPred2" style="display:none;">
            <div class="slds-notify_container slds-is-fixed" style ="">
                <div class="slds-notify slds-notify_toast slds-theme_error" role="status" style ="">
                    <span class="slds-assistive-text">Warning</span>
                    
                    <div class="slds-notify__content">
                        <h2 class="slds-text-heading_small" >Please give a valid predecessor</h2>
                    </div>
                    <div class="slds-notify__close">
                        <button class="slds-button slds-button_icon slds-button_icon-inverse" title="Close" onclick="closewarningToastForPred2()" style="font-size: 16px;font-weight: bold;">X
                            <span class="slds-assistive-text">Close</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div id="warningToastForActualfinish" style="display:none;">
            <div class="slds-notify_container slds-is-fixed" style="">
                <div class="slds-notify slds-notify_toast slds-theme_error" role="status" style="">
                    <span class="slds-assistive-text">Warning</span>
                    
                    <div class="slds-notify__content">
                        <h2 class="slds-text-heading_small" >You cannot enter a future actual end date</h2>
                    </div>
                    <div class="slds-notify__close">
                        <button class="slds-button slds-button_icon slds-button_icon-inverse" title="Close" onclick="closewarningToastForActualfinish()" style="font-size: 16px;font-weight: bold;">X
                            <span class="slds-assistive-text">Close</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div id="warningToastwithnotask" style="display:none;">
            <div class="slds-notify_container slds-is-fixed">
                <div class="slds-notify slds-notify_toast slds-theme_error" role="status">
                    <span class="slds-assistive-text">Warning</span>
                    
                    <div class="slds-notify__content">
                        <h2 class="slds-text-heading_small" >Please create a task to save the project</h2>
                    </div>
                    <div class="slds-notify__close">
                        <button class="slds-button slds-button_icon slds-button_icon-inverse" title="Close" onclick="closewarningToastwithnotask()" style="font-size: 16px;font-weight: bold;">X
                            <span class="slds-assistive-text">Close</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div id="warningToastFortext" style="display:none;">
            <div class="slds-notify_container slds-is-fixed" style ="">
                <div class="slds-notify slds-notify_toast slds-theme_error" style =" " role="status">
                    <span class="slds-assistive-text">Warning</span>
                    
                    <div class="slds-notify__content">
                        <h2 class="slds-text-heading_small" >Task name should not be empty</h2>
                    </div>
                    <div class="slds-notify__close">
                        <button class="slds-button slds-button_icon slds-button_icon-inverse" title="Close" onclick="closewarningText()" style="font-size: 16px;font-weight: bold;">X
                            <span class="slds-assistive-text">Close</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div id="warningToastForres" style="display:none;">
            <div class="slds-notify_container slds-is-fixed" style ="">
                <div class="slds-notify slds-notify_toast slds-theme_error" style =" " role="status">
                    <span class="slds-assistive-text">Warning</span>
                    <apex:outputpanel rendered="{!Project_Template__c.Template__c == true}"> 
                        <div class="slds-notify__content">
                            <h2 class="slds-text-heading_small" >Role should not be empty</h2>
                        </div>
                    </apex:outputpanel>
                    <apex:outputpanel rendered="{!Project_Template__c.Template__c == false}"> 
                        <div class="slds-notify__content">
                            <h2 class="slds-text-heading_small" >Resource should not be empty</h2>
                        </div>
                    </apex:outputpanel>
                    
                    <div class="slds-notify__close">
                        <button class="slds-button slds-button_icon slds-button_icon-inverse" title="Close" onclick="closewarningres()" style="font-size: 16px;font-weight: bold;">X
                            <span class="slds-assistive-text">Close</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div id="warningToastsaveastemp" style="display:none;">
            <div class="slds-notify_container slds-is-fixed">
                <div class="slds-notify slds-notify_toast slds-theme_error" role="status">
                    <span class="slds-assistive-text">Warning</span>
                    
                    <div class="slds-notify__content">
                        <h2 class="slds-text-heading_small" >Another template cannot be created from an existing template</h2>
                    </div>
                    <div class="slds-notify__close">
                        <button class="slds-button slds-button_icon slds-button_icon-inverse" title="Close" onclick="closewarningToastsaveastemp()" style="font-size: 16px;font-weight: bold;">X
                            <span class="slds-assistive-text">Close</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div id="ErrorToastsaveastemplate" style="display:none;">
            <div class="slds-notify_container slds-is-fixed">
                <div class="slds-notify slds-notify_toast slds-theme_error" role="status">
                    <span class="slds-assistive-text">Warning</span>
                    
                    <div class="slds-notify__content">
                        <h2 class="slds-text-heading_small" >There is No Tasks in project to save as template</h2>
                    </div>
                    <div class="slds-notify__close">
                        <button class="slds-button slds-button_icon slds-button_icon-inverse" title="Close" onclick="closewarningToastsave1()" style="font-size: 16px;font-weight: bold;">X
                            <span class="slds-assistive-text">Close</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div id="ErrorToasttempname" style="display:none;">
            <div class="slds-notify_container slds-is-fixed">
                <div class="slds-notify slds-notify_toast slds-theme_error" role="status">
                    <span class="slds-assistive-text">Warning</span>
                    
                    <div class="slds-notify__content">
                        <h2 class="slds-text-heading_small" >Enter a template name</h2>
                    </div>
                    <div class="slds-notify__close">
                        <button class="slds-button slds-button_icon slds-button_icon-inverse" title="Close" onclick="closewarningtempname()" style="font-size: 16px;font-weight: bold;">X
                            <span class="slds-assistive-text">Close</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div id="ProjectStart_date" style="display:none;">
            <div class="slds-notify_container slds-is-fixed">
                <div class="slds-notify slds-notify_toast slds-theme_error" role="status">
                    <span class="slds-assistive-text">Warning</span>
                    
                    <div class="slds-notify__content">
                        <h2 class="slds-text-heading_small" >Cannot change Start Date for Project</h2>
                    </div>
                    <div class="slds-notify__close">
                        <button class="slds-button slds-button_icon slds-button_icon-inverse" title="Close" onclick="closeprojectstartdate()" style="font-size: 16px;font-weight: bold;">X
                            <span class="slds-assistive-text">Close</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div id="ProjectEnd_date" style="display:none;">
            <div class="slds-notify_container slds-is-fixed">
                <div class="slds-notify slds-notify_toast slds-theme_error" role="status">
                    <span class="slds-assistive-text">Warning</span>
                    
                    <div class="slds-notify__content">
                        <h2 class="slds-text-heading_small" >Cannot change Project finish for Project</h2>
                    </div>
                    <div class="slds-notify__close">
                        <button class="slds-button slds-button_icon slds-button_icon-inverse" title="Close" onclick="closeprojectenddate()" style="font-size: 16px;font-weight: bold;">X
                            <span class="slds-assistive-text">Close</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div id="Projectactual_finish" style="display:none;">
            <div class="slds-notify_container slds-is-fixed">
                <div class="slds-notify slds-notify_toast slds-theme_error" role="status">
                    <span class="slds-assistive-text">Warning</span>
                    
                    <div class="slds-notify__content">
                        <h2 class="slds-text-heading_small" >Cannot change actual finish for Project</h2>
                    </div>
                    <div class="slds-notify__close">
                        <button class="slds-button slds-button_icon slds-button_icon-inverse" title="Close" onclick="closeprojectProjectactual_finish()" style="font-size: 16px;font-weight: bold;">X
                            <span class="slds-assistive-text">Close</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div id="ProjectDuration" style="display:none;">
            <div class="slds-notify_container slds-is-fixed">
                <div class="slds-notify slds-notify_toast slds-theme_error" role="status">
                    <span class="slds-assistive-text">Warning</span>
                    
                    <div class="slds-notify__content">
                        <h2 class="slds-text-heading_small" >Cannot change duration for Project</h2>
                    </div>
                    <div class="slds-notify__close">
                        <button class="slds-button slds-button_icon slds-button_icon-inverse" title="Close" onclick="closeprojectduration()" style="font-size: 16px;font-weight: bold;">X
                            <span class="slds-assistive-text">Close</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div id="StartdateValid" style="display:none;">
            <div class="slds-notify_container slds-is-fixed">
                <div class="slds-notify slds-notify_toast slds-theme_error" role="status">
                    <span class="slds-assistive-text">Warning</span>
                    
                    <div class="slds-notify__content">
                        <h2 class="slds-text-heading_small" >Start Date cannot be more than 2years from current year (or) less than 1year from current year</h2>
                    </div>
                    <div class="slds-notify__close">
                        <button class="slds-button slds-button_icon slds-button_icon-inverse" title="Close" onclick="closestartdateValid()" style="font-size: 16px;font-weight: bold;">X
                            <span class="slds-assistive-text">Close</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div id="EnddateValid" style="display:none;">
            <div class="slds-notify_container slds-is-fixed">
                <div class="slds-notify slds-notify_toast slds-theme_error" role="status">
                    <span class="slds-assistive-text">Warning</span>
                    
                    <div class="slds-notify__content">
                        <h2 class="slds-text-heading_small" >Project Finish cannot be more than 2years from current year (or) less than 1year from current year</h2>
                    </div>
                    <div class="slds-notify__close">
                        <button class="slds-button slds-button_icon slds-button_icon-inverse" title="Close" onclick="closeprojectfinishValid()" style="font-size: 16px;font-weight: bold;">X
                            <span class="slds-assistive-text">Close</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div id="ActualFinishValid" style="display:none;">
            <div class="slds-notify_container slds-is-fixed">
                <div class="slds-notify slds-notify_toast slds-theme_error" role="status">
                    <span class="slds-assistive-text">Warning</span>
                    
                    <div class="slds-notify__content">
                        <h2 class="slds-text-heading_small" >Actual Finish cannot be more than 2years from current year (or) less than 1year from current year</h2>
                    </div>
                    <div class="slds-notify__close">
                        <button class="slds-button slds-button_icon slds-button_icon-inverse" title="Close" onclick="closeActualfinishValid()" style="font-size: 16px;font-weight: bold;">X
                            <span class="slds-assistive-text">Close</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div id="CircularLoopValid" style="display:none;">
            <div class="slds-notify_container slds-is-fixed">
                <div class="slds-notify slds-notify_toast slds-theme_error" role="status">
                    <span class="slds-assistive-text">Warning</span>
                    
                    <div class="slds-notify__content">
                        <h2 class="slds-text-heading_small" >Cannot Create Circular Links</h2>
                    </div>
                    <div class="slds-notify__close">
                        <button class="slds-button slds-button_icon slds-button_icon-inverse" title="Close" onclick="closeCircularLoopValid()" style="font-size: 16px;font-weight: bold;">X
                            <span class="slds-assistive-text">Close</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div id="predecErrMsg" style="display:none;">
            <div class="slds-notify_container slds-is-fixed">
                <div class="slds-notify slds-notify_toast slds-theme_error" role="status">
                    <span class="slds-assistive-text">Warning</span>
                    
                    <div class="slds-notify__content">
                        <h2 class="slds-text-heading_small" >Predecessors should have Row Number</h2>
                    </div>
                    <div class="slds-notify__close">
                        <button class="slds-button slds-button_icon slds-button_icon-inverse" title="Close" onclick="closepredecErrMsg()" style="font-size: 16px;font-weight: bold;">X
                            <span class="slds-assistive-text">Close</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div id="isDeleteTask" style="display:none;">
            <div class="slds-notify_container slds-is-fixed">
                <div class="slds-notify slds-notify_toast slds-theme_warning" role="status">
                    <span class="slds-assistive-text">Warning</span>
                    
                    <div class="slds-notify__content">
                        <h2 class="slds-text-heading_small" >Select atleast one Task for delete</h2>
                    </div>
                    <div class="slds-notify__close">
                        <button class="slds-button slds-button_icon slds-button_icon-inverse" title="Close" onclick="closeisDeleteTask()" style="font-size: 16px;font-weight: bold;">X
                            <span class="slds-assistive-text">Close</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div id="confirmDeleteTask" style="display:none;">
            <div class="slds-notify_container slds-is-fixed">
                <div class="slds-notify slds-notify_toast slds-theme_success" role="status">
                    <span class="slds-assistive-text">Success</span>
                    
                    <div class="slds-notify__content">
                        <h2 class="slds-text-heading_small" >Selected Tasks are Deleted</h2>
                    </div>
                    <div class="slds-notify__close">
                        <button class="slds-button slds-button_icon slds-button_icon-inverse" title="Close" onclick="closeconfirmDeleteTask()" style="font-size: 16px;font-weight: bold;">X
                            <span class="slds-assistive-text">Close</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div id="dashbordWarningforMilestone" style="display:none;">
            <div class="slds-notify_container slds-is-fixed">
                <div class="slds-notify slds-notify_toast slds-theme_warning" role="status">
                    <span class="slds-assistive-text">Warning</span>
                    
                    <div class="slds-notify__content">
                        <h2 class="slds-text-heading_small" >Dashboard should be checked for milestone</h2>
                    </div>
                    <div class="slds-notify__close">
                        <button class="slds-button slds-button_icon slds-button_icon-inverse" title="Close" onclick="closedashbordWarningforMilestone()" style="font-size: 16px;font-weight: bold;">X
                            <span class="slds-assistive-text">Close</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div id="checkboxWarningforMilestone" style="display:none;">
            <div class="slds-notify_container slds-is-fixed">
                <div class="slds-notify slds-notify_toast slds-theme_warning" role="status">
                    <span class="slds-assistive-text">Warning</span>
                    
                    <div class="slds-notify__content">
                        <h2 class="slds-text-heading_small" >External should be checked for milestone</h2>
                    </div>
                    <div class="slds-notify__close">
                        <button class="slds-button slds-button_icon slds-button_icon-inverse" title="Close" onclick="closecheckboxWarningforMilestone()" style="font-size: 16px;font-weight: bold;">X
                            <span class="slds-assistive-text">Close</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </body> 
    
</apex:page>