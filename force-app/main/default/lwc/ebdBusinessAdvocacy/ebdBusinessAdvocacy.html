<template>
    <div>
        <div class="section-header">
            <div class="slds-p-top_xx-small slds-p-left_x-small slds-text-heading_small slds-p-bottom_medium">
                <span><b>B-2-B</b></span>
            </div>
        </div>
    </div>
    <div class="slds-p-top_small  slds-text-align_right slds-text-heading_small">
        <template lwc:if={isEditMode}>
            <lightning-button label="Clear Data" class="clear-data-btn" variant="Neutral"
                alternative-text="Delete All Rows" size="small" title="Delete All Rows" onclick={deleteAllBusinessRows}>
            </lightning-button>
            <template if:true={showConfirmModalBusiness}>
                <section role="dialog" class="slds-modal slds-fade-in-open">
                    <div class="slds-modal__container">
                        <header class="slds-modal__header" style="background-color: #ba0517; color: white;">
                            <h2 class="slds-text-heading_medium">Confirmation</h2>
                        </header>
                        <div class="slds-modal__content slds-p-around_medium">
                                <p class="slds-text-heading_small slds-text-align_center slds-p-horizontal_large">
                                    This action will clear all data in the table. Are you sure you want to proceed?
                                </p>
                            <div style="text-align: center;" class="slds-p-top_large">
                                <lightning-button label="Continue" onclick={handleConfirmDeleteBusiness}>
                                </lightning-button>
                                <lightning-button label="Cancel" onclick={handleCancelDelete}
                                    class="slds-m-left_x-small">
                                </lightning-button>
                            </div>
                        </div>

                    </div>
                </section>
                <div class="slds-backdrop slds-backdrop_open"></div>
            </template>
        </template>
        <template lwc:else>

            <lightning-button label="Clear Data" class="clear-data-btn" variant="Neutral" disabled
                alternative-text="Delete All Rows" size="small" title="Delete All Rows" onclick={deleteAllBusinessRows}>
            </lightning-button>
        </template>
    </div>
    <div class="slds-p-top_small slds-p-bottom_large">
        <table
            class="slds-text-body_small slds-table slds-border_left slds-border_right  slds-table--bordered slds-max-medium-table--stacked-horizontal slds-table--resizable-cols slds-table--fixed-layout">
            <thead class="header-color">
                <tr>
                    <td class="slds-border_right" colspan="4"> <b>Service/Solution</b></td>
                    <td class="slds-border_right" colspan="4"> <b>UHG Business Segment</b></td>
                    <td colspan="4" class="slds-border_right"><b> UHG Buyer or Decision Maker </b></td>
                    <td colspan="3"><b> Revenue </b></td>
                    <td class="slds-border_right" colspan="1">
                        <div class="slds-text-align_right">
                            <template lwc:if={isEditMode}>
                                <lightning-icon icon-name="action:new" data-index={index} alternative-text="Add new row"
                                    size="xx-small" title="Add new row" onclick={addBusinessRow}>
                                </lightning-icon>
                            </template>
                            <template lwc:else>
                                <lightning-icon icon-name="action:new" alternative-text="Add new row" size="xx-small"
                                    title="Add new row" class="disabled-icon">
                                </lightning-icon>
                            </template>
                        </div>
                    </td>
                </tr>
            </thead>
            <tbody>
                <template for:each={businessData} for:item="rec" for:index="index">
                    <tr key={rec.id}>

                        <td class="slds-border_right" colspan="4">
                            <template lwc:if={isEditMode}>
                                <lightning-input type="text" name="Service_Solution__c" data-index={index} onchange={handleChange}
                                    value={rec.Service_Solution__c} max-length="80"></lightning-input>
                            </template>
                            <template lwc:else>
                                <lightning-formatted-text style="word-wrap: break-word; white-space: normal;"
                                    value={rec.Service_Solution__c}></lightning-formatted-text>
                            </template>
                        </td>
                        <td class="slds-border_right" colspan="4">
                            <template lwc:if={isEditMode}>
                                <lightning-textarea type="text" name="UHG_Business_Segment__c" data-index={index}
                                    value={rec.UHG_Business_Segment__c} onchange={handleChange} max-length="255">
                                </lightning-textarea>
                            </template>
                            <template lwc:else>
                                <lightning-formatted-text style="word-wrap: break-word; white-space: normal;"
                                    value={rec.UHG_Business_Segment__c}></lightning-formatted-text>
                            </template>
                        </td>
                        <td colspan="4" class="slds-border_right">
                            <template lwc:if={isEditMode}>
                                <lightning-textarea type="text" name="UHG_Buyer_or_Decision_Make__c"
                                    value={rec.UHG_Buyer_or_Decision_Make__c} data-index={index} onchange={handleChange}
                                    max-length="255">
                                </lightning-textarea>
                            </template>
                            <template lwc:else>
                                <lightning-formatted-text style="word-wrap: break-word; white-space: normal;"
                                    value={rec.UHG_Buyer_or_Decision_Make__c}></lightning-formatted-text>
                            </template>
                        </td>
                        <td colspan="3">
                            <template lwc:if={isEditMode}>
                                <!-- <lightning-input type="number" name="Revenue__c" max-length="16"
                                     value={rec.Revenue__c} step="any"  data-index={index} currency-code="USD" 
                                   onchange={handleChange} > -->
                                    <lightning-input type="number" name="Revenue__c" max-length="16" 
                                    value={rec.Revenue__c} 
                                        step="any"
                                        data-index={index}
                                        currency-code="USD"
                                        onchange={handleChange}>
                                    
                                </lightning-input>
                            </template>
                            <template lwc:else>
                                <!-- <lightning-formatted-number  style="word-wrap: break-word; white-space: normal;"
                                value={rec.Revenue__c} format-style="currency"  maximum-fraction-digits="3">
                                </lightning-formatted-number> -->
                                <!-- <lightning-formatted-number value={rec.Revenue__c}  currency-code="USD"  ></lightning-formatted-number> -->
                                <lightning-formatted-number value={rec.Revenue__c} format-style="currency" currency-code="USD"
                                    minimum-fraction-digits="3" maximum-fraction-digits="3">
                                </lightning-formatted-number>
                                </template>

                        </td>
                        <td class="slds-border_right" colspan="1">
                            <div class="slds-text-align_right">
                                <template lwc:if={isEditMode}>
                                    <lightning-icon icon-name="action:delete" data-index={index}
                                        alternative-text="Delete this row" size="xx-small" title="Delete this row"
                                        onclick={removeBusinessRow}>
                                    </lightning-icon>
                                </template>
                                <template lwc:else>
                                    <lightning-icon icon-name="action:delete" alternative-text="Delete this row"
                                        size="xx-small" title="Delete this row" class="disabled-icon">
                                    </lightning-icon>
                                </template>
                            </div>
                        </td>
                    </tr>
                </template>
            </tbody>
        </table>

    </div>
    <div>
        <div class="section-header">
            <div class="slds-p-top_xx-small slds-p-left_x-small slds-text-heading_small slds-p-bottom_medium">
                <span><b>Advocacy and Clinical Model</b></span>
            </div>
        </div>
    </div>

    <div class="slds-p-top_small  slds-text-align_right slds-text-heading_small">
        <template lwc:if={isEditMode}>

            <lightning-button label="Clear Data" class="clear-data-btn" variant="Neutral"
                alternative-text="Clear entire table" size="xx-small" title="Clear entire table"
                onclick={deleteAdvocacyRows}>
            </lightning-button>
            <template if:true={showConfirmModalForAdvocay}>
                <section role="dialog" class="slds-modal slds-fade-in-open">
                    <div class="slds-modal__container">
                        <header class="slds-modal__header" style="background-color: #ba0517; color: white;">
                            <h2 class="slds-text-heading_medium">Confirmation</h2>
                        </header>
                        <div class="slds-modal__content slds-p-around_medium">
                                <p class="slds-text-heading_small slds-text-align_center slds-p-horizontal_large">
                                    This action will clear all data in the table. Are you sure you want to proceed?
                                </p>
                            <div style="text-align: center;" class="slds-p-top_large">
                                <lightning-button label="Continue" onclick={handleConfirmDeleteAdvocacy}>
                                </lightning-button>

                                <lightning-button label="Cancel" onclick={handleCancelDelete}
                                    class="slds-m-left_x-small">
                                </lightning-button>
                            </div>
                        </div>

                    </div>
                </section>
                <div class="slds-backdrop slds-backdrop_open"></div>
            </template>
        </template>

        <template lwc:else>

            <lightning-button label="Clear Data" class="clear-data-btn" variant="Neutral" disabled
                alternative-text="Clear entire table" size="small" title="Clear entire table"
                onclick={deleteAdvocacyRows}>
            </lightning-button>
        </template>
    </div>
    <div class="slds-p-top_small slds-p-bottom_large">
        <table
            class="slds-text-body_small slds-table slds-border_left slds-border_right  slds-table--bordered slds-max-medium-table--stacked-horizontal slds-table--resizable-cols slds-table--fixed-layout">


            <thead class="header-color">
                <tr>
                    <td class="slds-border_right" colspan="5"> <b>Service </b></td>
                    <td class="slds-border_right" colspan="5"> <b>Vendor/Model</b></td>
                    <td colspan="5"><b> Site (if in-house)</b> </td>
                    <td colspan="1">
                        <div class="slds-text-align_right">
                            <template lwc:if={isEditMode}>
                                <lightning-icon icon-name="action:new" data-index={index} alternative-text="Add new row"
                                    size="xx-small" title="Add new row" onclick={addAdvocacyRow}>
                                </lightning-icon>
                            </template>
                            <template lwc:else>
                                <lightning-icon icon-name="action:new" alternative-text="Add new row" size="xx-small"
                                    title="Add new row" class="disabled-icon">
                                </lightning-icon>
                            </template>
                        </div>
                    </td>
                </tr>
            </thead>
            <tbody>
                <template for:each={advocacyData} for:item="rec" for:index="index">
                    <tr key={rec.id}>

                        <td class="slds-border_right" colspan="5">
                            <template lwc:if={isEditMode}>
                                <lightning-input type="text" name="Service__c" data-index={index}
                                    onchange={handleChangeAdvocacy} value={rec.Service__c} max-length="80"></lightning-input>
                            </template>
                            <template lwc:else>
                                <lightning-formatted-text style="word-wrap: break-word; white-space: normal;"
                                    value={rec.Service__c}></lightning-formatted-text>
                            </template>
                        </td>
                        <td class="slds-border_right" colspan="5">
                            <template lwc:if={isEditMode}>
                                <lightning-input type="text" name="Vendor_Model__c" data-index={index}
                                    onchange={handleChangeAdvocacy} value={rec.Vendor_Model__c} max-length="255">
                                </lightning-input>
                            </template>
                            <template lwc:else>
                                <lightning-formatted-text style="word-wrap: break-word; white-space: normal;"
                                    value={rec.Vendor_Model__c}></lightning-formatted-text>
                            </template>
                        </td>
                        <td colspan="5">
                            <template lwc:if={isEditMode}>
                                <lightning-input type="text" name="Site_if_in_house__c" data-index={index}
                                    value={rec.Site_if_in_house__c} onchange={handleChangeAdvocacy} max-length="255">
                                </lightning-input>
                            </template>
                            <template lwc:else>
                                <lightning-formatted-text style="word-wrap: break-word; white-space: normal;"
                                    value={rec.Site_if_in_house__c}></lightning-formatted-text>
                            </template>
                        </td>
                        <td class="slds-border_right" colspan="1">
                            <div class="slds-text-align_right">
                                <template lwc:if={isEditMode}>
                                    <lightning-icon icon-name="action:delete" data-index={index}
                                        alternative-text="Delete this row" size="xx-small" title="Delete this row"
                                        onclick={removeAdvocacyRow}>
                                    </lightning-icon>
                                </template>
                                <template lwc:else>
                                    <lightning-icon icon-name="action:delete" alternative-text="Delete this row"
                                        size="xx-small" title="Delete this row" class="disabled-icon">
                                    </lightning-icon>
                                </template>
                            </div>
                        </td>
                    </tr>
                </template>
            </tbody>
        </table>
    </div>
</template>