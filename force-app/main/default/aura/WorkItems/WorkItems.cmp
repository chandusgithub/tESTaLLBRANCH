<!--
  @description       : 
  @author            : Spoorthy
  @group             : 
  @last modified on  : 04-02-2024
  @last modified by  : Spoorthy
-->
<aura:component controller="workItemsController" implements="force:appHostable,flexipage:availableForAllPageTypes,flexipage:availableForRecordHome,force:hasRecordId,forceCommunity:availableForAllPageTypes,force:lightningQuickAction" >
    
    <aura:attribute name="WorkItemsDataArray" type="String[]"/>
    <aura:attribute name="WorkItemsEmptyList" type="Boolean" default="false" />
    <aura:attribute name="saveDraftValues" type="Object" />
    <aura:attribute name="saveUpdatedWorkItemList" type="Opportunity[]" />
    <aura:attribute name="errors" type="Object" />
    <aura:attribute name="allSCEsDefaultArray" type="String[]" />
    <aura:attribute name="vpcrSceOwnerMap" type="Map" />
    <aura:attribute name="loggedInUserRoleName" type="String" />
    <aura:attribute name="isFiltered" type="Boolean" default="false" />
    <aura:attribute name="opportunityMap" type="Map" />
    
    <!-- Variables for sorting -->
    <aura:attribute name="sortCompanyAsc" type="Boolean" default="true"/>
    <aura:attribute name="sortRVPVPCRAsc" type="Boolean" default="true"/>
    <aura:attribute name="sortSCEAsc" type="Boolean" default="true"/>
    <aura:attribute name="sortMANameAsc" type="Boolean" default="true"/>
    <aura:attribute name="sortCommentsLastModifiedAsc" type="Boolean" default="true"/>
    <aura:attribute name="sortMAComments" type="Boolean" default="true"/>
    <aura:attribute name="sortedColumn" type="String" />
    <aura:attribute name="sortedType" type="String" />
    
    <aura:attribute name="surveyContactsList" type="List" />
    <aura:attribute name="enableClientNPSSurvey" type="Boolean" default="false"/>
    <aura:attribute name="dueDate" type="String" />
    <aura:attribute name="softDate" type="String" />
    <aura:attribute name="tabLabel" type="String" />
    <aura:attribute name="isCustomTabVisible" type="Boolean" />
    <aura:attribute name="isMATabVisible" type="Boolean" />
    <aura:attribute name="hasTabAccess" type="Boolean" default="false"/>
    <aura:attribute name="isCDSVP" type="Boolean" default="false"/>
    
    <aura:handler name="init" value="{! this }" action="{!c.init }" />
    <aura:handler name="workItemEvents" event="c:WorkItems_Events" action="{!c.handleUpdatedOppAndSave}" />
      <aura:if isTrue="{!v.isCDSVP}">
        <lightning:tabset>
            <lightning:tab label="Sales Debrief Summary">
                <c:salesDebriefSummary></c:salesDebriefSummary>
            </lightning:tab>
        </lightning:tabset>
    </aura:if>
    <aura:if isTrue="{!v.hasTabAccess}">
        <lightning:tabset>
            <!--<aura:if isTrue="{!or(v.loggedInUserRoleName == 'CM SCE', v.loggedInUserRoleName == 'CM VPCR/RVP')}">-->
            <aura:if isTrue="{!v.isCustomTabVisible}">
                <lightning:tab label="{!v.tabLabel}" id="ClientSurveyContactsValidation">
                    <!--NPS Survey applet goes here with Lightning Web Component....!!!-->
                    <aura:if isTrue="{!v.enableClientNPSSurvey}">
                        <c:clientNpsSurvey surveyContactsList="{!v.surveyContactsList}" loggedInUserRoleName="{!v.loggedInUserRoleName}" softDate="{!v.softDate}"></c:clientNpsSurvey>
                    </aura:if>
                </lightning:tab>
            </aura:if>
            <!--</aura:if>-->
            <lightning:tab label="Product Change Checklist">
                <c:renewalChecklistMainComp></c:renewalChecklistMainComp>
            </lightning:tab>
            <lightning:tab label="Sales Debrief Summary">
                <c:salesDebriefSummary></c:salesDebriefSummary>
            </lightning:tab>
            <aura:if isTrue="{!v.isMATabVisible}">
                <lightning:tab label="Update MA Comments" onactive="{!c.handleUpdateMAComment}">
                    <aura:if isTrue="{!v.hasTabAccess}">
                        <article aura:id="articleClass" class="slds-card slds-m-bottom_medium" ><!--onscroll="{!c.scrollBottom}"-->
                            <div class="slds-card__header slds-grid">
                                <header class="slds-media slds-media_center slds-has-flexi-truncate">
                                    <div class="slds-media__figure">
                                        <span class="slds-icon_container slds-icon-standard-account" title="account">                        
                                            <lightning:icon class="slds-icon slds-icon_small" iconName="standard:task" size="small"></lightning:icon>
                                            <span class="slds-assistive-text">account</span>
                                        </span>
                                    </div>
                                    <div class="slds-media__body">
                                        <h2 class="slds-card__header-title">
                                            <a href="javascript:void(0);" class="slds-card__header-link slds-truncate" title="Accounts">
                                                <span class="slds-text-heading_small">Update Membership Activity Comments</span>
                                            </a>
                                        </h2>
                                    </div>
                                    <!--<div class="slds-no-flex">
                        <button class="slds-button slds-button_neutral">New</button>
                    </div>-->
                                </header>
                            </div>
                            <div class="slds-card__body slds-card__body_inner slds-p-horizontal_none slds-m-bottom_none slds-is-relative">
                                <lightning:spinner aura:id="tableSpinner" alternativeText="Loading.." title="" variant="brand" size="large" class="slds-hide"/>
                                <div class="slds-grid slds-wrap slds-p-horizontal_medium slds-theme_shade slds-p-vertical_medium slds-border_top slds-border_bottom">
                                    <div class="slds-size_1-of-1 slds-m-bottom_x-small info">
                                        <p><strong>Click the pencil icon to the right of the Membership Activity Comments field to view or add updates.</strong></p>
                                    </div>
                                    <div aura:Id="hideEntireFilter" class="slds-size_1-of-1 slds-hide">
                                        <fieldset class="slds-form-element">
                                            <div class="slds-form-element__group">
                                                <div class="slds-form-element__row slds-grid">
                                                    <div aura:Id="hideVPCRFilter" class="slds-form-element slds-size_1-of-1 slds-large-size_2-of-12 slds-hide">
                                                        <ui:inputSelect class="inputSelectoption slds-input" aura:id="VPCRRVPsDropDown" multiple="false" change="{!c.changeOnVPCRList}"/>
                                                    </div>
                                                    <div class="slds-form-element slds-size_1-of-1 slds-large-size_2-of-12 slds-m-horizontal_small">
                                                        <ui:inputSelect class="inputSelectoption1 slds-input" aura:id="SCEsDropDown" multiple="false" change="{!c.changeOnSCEList}"/>
                                                    </div>
                                                    <div class="slds-form-element slds-size_1-of-2 slds-large-size_1-of-12">
                                                        <ui:button class="slds-button slds-button--brand mt-md-0" aura:id="goBtn" press="{!c.handleFilters}">{!$Label.c.Go}</ui:button>
                                                    </div>
                                                </div>
                                            </div>
                                        </fieldset>
                                    </div>
                                </div>
                                
                                <div class="slds-table--header-fixed_container slds-data-table-container no-edit" aura:Id="onEdit">
                                    <div class="slds-modal slds-fade-in-open slds-modal_prompt slds-hide"></div>
                                    <div aura:Id="dataProcessing" class="slds-scrollable_y slds-hide" style="height:100%;"> 
                                        <table class="slds-table slds-table--bordered slds-max-medium-table--stacked-horizontal slds-table_resizable-cols slds-table--fixed-layout data-table slds-table--header-fixed">
                                            <aura:if isTrue="{!v.WorkItemsEmptyList}">
                                                <thead>
                                                    <tr class="slds-text-title--caps">
                                                        <th class="slds-is-sortable slds-is-resizable slds-text-title--caps" scope="col" style="padding:0.5rem 0.5rem;">
                                                            <span class="slds-truncate" title="Company"><b>Company</b></span>    
                                                        </th>
                                                        <aura:if  isTrue="{!or(v.loggedInUserRoleName == 'CRM Administrator',v.loggedInUserRoleName == 'CM CSAD', v.loggedInUserRoleName == 'CM SCE',v.loggedInUserRoleName == 'Surest CM SCE',v.loggedInUserRoleName == 'Surest CM SVP', v.loggedInUserRoleName == 'Specialty Benefits SCE')}" >
                                                            <th class="slds-is-sortable slds-is-resizable slds-text-title--caps" scope="col">
                                                                <span class="slds-truncate" title="RVP/VPCR"><b>RVP/VPCR</b></span>
                                                            </th>               
                                                        </aura:if>    
                                                        
                                                        <aura:if  isTrue="{!or(v.loggedInUserRoleName == 'CRM Administrator',v.loggedInUserRoleName == 'CM CSAD', v.loggedInUserRoleName == 'CM VPCR/RVP')}" >
                                                            <th class="slds-is-sortable slds-is-resizable slds-text-title--caps" scope="col">
                                                                <span class="slds-truncate" title="SCE"><b>SCE</b></span>
                                                            </th>                                        
                                                        </aura:if>
                                                        <th class="slds-is-sortable slds-is-resizable slds-text-title--caps" scope="col">
                                                            <span class="slds-truncate" title="Membership Activity Name"><b>Membership Activity Name</b></span>
                                                        </th>
                                                        <th class="slds-is-sortable slds-is-resizable slds-text-title--caps" scope="col">
                                                            <span class="slds-truncate" title="Comments Last Modified"><b>Comments Last Modified</b></span>
                                                        </th>
                                                        <th class="slds-is-sortable slds-is-resizable slds-text-title--caps" scope="col">
                                                            <span class="slds-truncate" title="Membership Activity Comments"><b>Membership Activity Comments</b></span>
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <p></p>
                                                <tbody>
                                                    <tr>
                                                        <aura:if isTrue="{!or(v.loggedInUserRoleName == 'CM VPCR/RVP', v.loggedInUserRoleName == 'CM SCE',v.loggedInUserRoleName == 'Surest CM SCE',v.loggedInUserRoleName == 'Surest CM SVP', v.loggedInUserRoleName == 'Specialty Benefits SCE')}" >
                                                            <th colspan="5">
                                                                <div class="slds-text-align--center">No Open Membership Activities Found</div>
                                                            </th>
                                                            <aura:set attribute="else">
                                                                <th colspan="6">
                                                                    <div class="slds-text-align--center">No Open Membership Activities Found</div>
                                                                </th>
                                                            </aura:set>
                                                        </aura:if>                                        
                                                    </tr>
                                                </tbody>
                                                <aura:set attribute="else">
                                                    <thead>
                                                        <tr class="slds-text-title--caps">
                                                            <th class="slds-is-sortable slds-text-title--caps" scope="col" width="140">
                                                                <a onclick="{!c.sortFields}" data-record="Account.Name" class="slds-th__action slds-text-link--reset slds-cell-fixed" tabindex="0">
                                                                    <span class="slds-assistive-text">Sort </span>
                                                                    <span class="slds-truncate" title="Company"><b>Company</b></span>
                                                                    <div class="slds-icon_container">
                                                                        <aura:if isTrue="{!v.sortCompanyAsc}">
                                                                            <lightning:icon class="slds-icon slds-icon--x-small slds-icon-text-default slds-is-sortable__icon" iconName="utility:arrowdown" size="xx-small" alternativeText="Indicates approval"/>
                                                                            <aura:set attribute="else">
                                                                                <lightning:icon class="slds-icon slds-icon--x-small slds-icon-text-default slds-is-sortable__icon" iconName="utility:arrowup" size="xx-small" alternativeText="Indicates approval"/>
                                                                            </aura:set>
                                                                        </aura:if>
                                                                    </div>
                                                                    <span class="slds-assistive-text" aria-live="assertive" aria-atomic="true"></span>
                                                                </a>
                                                            </th>
                                                            <aura:if  isTrue="{!or(v.loggedInUserRoleName == 'CRM Administrator', v.loggedInUserRoleName == 'CM CSAD', v.loggedInUserRoleName == 'CM SCE',v.loggedInUserRoleName == 'Surest CM SCE',v.loggedInUserRoleName == 'Surest CM SVP', v.loggedInUserRoleName == 'Specialty Benefits SCE')}" >
                                                                <th class="slds-is-sortable slds-text-title--caps" scope="col" width="120">
                                                                    <a onclick="{!c.sortFields}" data-record="CM_VPCR_RVP__r.Name" class="slds-th__action slds-text-link--reset slds-cell-fixed" tabindex="0">
                                                                        <span class="slds-assistive-text">Sort </span>
                                                                        <span class="slds-truncate" title="RVP/VPCR"><b>RVP/VPCR</b></span>
                                                                        <div class="slds-icon_container">
                                                                            <aura:if isTrue="{!v.sortRVPVPCRAsc}">
                                                                                <lightning:icon class="slds-icon slds-icon--x-small slds-icon-text-default slds-is-sortable__icon" iconName="utility:arrowdown" size="xx-small" alternativeText="Indicates approval"/>
                                                                                <aura:set attribute="else">
                                                                                    <lightning:icon class="slds-icon slds-icon--x-small slds-icon-text-default slds-is-sortable__icon" iconName="utility:arrowup" size="xx-small" alternativeText="Indicates approval"/>
                                                                                </aura:set>
                                                                            </aura:if>
                                                                        </div>
                                                                        <span class="slds-assistive-text" aria-live="assertive" aria-atomic="true"></span>
                                                                    </a>                                    
                                                                </th>
                                                            </aura:if>
                                                            <aura:if  isTrue="{!or(v.loggedInUserRoleName == 'CRM Administrator',v.loggedInUserRoleName == 'CM CSAD', v.loggedInUserRoleName == 'CM VPCR/RVP')}" >
                                                                <th class="slds-is-sortable slds-text-title--caps" scope="col" width="150">
                                                                    <a onclick="{!c.sortFields}" data-record="Owner.Name" class="slds-th__action slds-text-link--reset slds-cell-fixed" tabindex="0">
                                                                        <span class="slds-assistive-text">Sort </span>
                                                                        <span class="slds-truncate" title="SCE"><b>SCE</b></span>
                                                                        <div class="slds-icon_container">
                                                                            <aura:if isTrue="{!v.sortSCEAsc}">
                                                                                <lightning:icon class="slds-icon slds-icon--x-small slds-icon-text-default slds-is-sortable__icon" iconName="utility:arrowdown" size="xx-small" alternativeText="Indicates approval"/>
                                                                                <aura:set attribute="else">
                                                                                    <lightning:icon class="slds-icon slds-icon--x-small slds-icon-text-default slds-is-sortable__icon" iconName="utility:arrowup" size="xx-small" alternativeText="Indicates approval"/>
                                                                                </aura:set>
                                                                            </aura:if>
                                                                        </div>
                                                                        <span class="slds-assistive-text" aria-live="assertive" aria-atomic="true"></span>
                                                                    </a>
                                                                </th>
                                                            </aura:if>
                                                            <th class="slds-is-sortable slds-text-title--caps" scope="col">
                                                                <a onclick="{!c.sortFields}" data-record="Name" class="slds-th__action slds-text-link--reset slds-cell-fixed" tabindex="0">
                                                                    <span class="slds-assistive-text">Sort </span>
                                                                    <span class="slds-truncate" title="Membership Activity Name"><b>Membership Activity Name</b></span>
                                                                    <div class="slds-icon_container">
                                                                        <aura:if isTrue="{!v.sortMANameAsc}">
                                                                            <lightning:icon class="slds-icon slds-icon--x-small slds-icon-text-default slds-is-sortable__icon" iconName="utility:arrowdown" size="xx-small" alternativeText="Indicates approval"/>
                                                                            <aura:set attribute="else">
                                                                                <lightning:icon class="slds-icon slds-icon--x-small slds-icon-text-default slds-is-sortable__icon" iconName="utility:arrowup" size="xx-small" alternativeText="Indicates approval"/>
                                                                            </aura:set>
                                                                        </aura:if>
                                                                    </div>
                                                                    <span class="slds-assistive-text" aria-live="assertive" aria-atomic="true"></span>
                                                                </a>
                                                            </th>
                                                            <th class="slds-is-sortable slds-text-title--caps" scope="col" width="220">
                                                                <a onclick="{!c.sortFields}" data-record="Comments_Last_Modified__c" class="slds-th__action slds-text-link--reset slds-cell-fixed" tabindex="0">
                                                                    <span class="slds-assistive-text">Sort </span>
                                                                    <span class="slds-truncate" title="Comments Last Modified"><b>Comments Last Modified</b></span>
                                                                    <div class="slds-icon_container">
                                                                        <aura:if isTrue="{!v.sortCommentsLastModifiedAsc}">
                                                                            <lightning:icon class="slds-icon slds-icon--x-small slds-icon-text-default slds-is-sortable__icon" iconName="utility:arrowdown" size="xx-small" alternativeText="Indicates approval"/>
                                                                            <aura:set attribute="else">
                                                                                <lightning:icon class="slds-icon slds-icon--x-small slds-icon-text-default slds-is-sortable__icon" iconName="utility:arrowup" size="xx-small" alternativeText="Indicates approval"/>
                                                                            </aura:set>
                                                                        </aura:if>
                                                                    </div>
                                                                    <span class="slds-assistive-text" aria-live="assertive" aria-atomic="true"></span>
                                                                </a>
                                                            </th>
                                                            <th class="slds-text-title--caps" scope="col" width="400">
                                                                <div class="slds-th__action slds-cell-fixed no-hover" tabindex="0">
                                                                    <!--<span class="slds-assistive-text">Sort </span>-->
                                                                    <span class="slds-truncate" title="Membership Activity Comments"><b>Membership Activity Comments</b></span>
                                                                    <!--<div class="slds-icon_container">
                                                        <aura:if isTrue="{!v.sortMAComments}">
                                                                <lightning:icon class="slds-icon slds-icon_x-small slds-icon-text-default slds-is-sortable__icon" iconName="utility:arrowdown" size="xx-small" alternativeText="Indicates approval"/>
                                                                <aura:set attribute="else">
                                                                    <lightning:icon class="slds-icon slds-icon_x-small slds-icon-text-default slds-is-sortable__icon" iconName="utility:arrowup" size="xx-small" alternativeText="Indicates approval"/>
                                                                </aura:set>
                                                            </aura:if>
                                                    </div>-->
                                                                    <span class="slds-assistive-text" aria-live="assertive" aria-atomic="true"></span>
                                                                </div>
                                                            </th>
                                                            <th class="slds-cell-shrink">
                                                                <div class="slds-cell-fixed">&nbsp;</div>
                                                            </th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <aura:iteration items="{!v.WorkItemsDataArray}" var="WorkItemsDataobj" indexVar="index">
                                                            
                                                            <c:WorkItems_Table WorkItemsIndex="{!index}" WorkItemsDataobj="{!WorkItemsDataobj}" aura:Id="childComponent" loggedInUserName="{!v.loggedInUserRoleName}"></c:WorkItems_Table>
                                                            
                                                        </aura:iteration>
                                                    </tbody>
                                                </aura:set>
                                            </aura:if> 
                                        </table>   
                                    </div>
                                </div>
                            </div>  
                            <!--<footer class="slds-card__footer"></footer>-->
                            <!--<div aura:Id="saveCancelbuttons" class="slds-card__footer slds-m-top_none slds-hide" >
                 <lightning:button variant="neutral" label="Cancel" onclick="{! c.handleCancel }" />
                <lightning:button variant="brand" label="Save" onclick="{! c.handleSave }" />   
            </div>-->
                        </article>
                        <aura:set attribute="else">
                            <div  class="slds-section">
                                <div  class="slds-section" style="text-align: center;">
                                    <b>
                                        This tab was specifically designed to provide SCEs, RVPs, VPCRs to validate their contacts for the NPS client survey. This tab will be blank for those who are not part of this group.
                                    </b>
                                </div>
                            </div>
                        </aura:set>
                    </aura:if>
                </lightning:tab>
                
            </aura:if>
        </lightning:tabset>
        <!--aura:set attribute="else">
              <div class="slds-section">
                <div class="slds-section" style="text-align: center;">
                    <b>
                    This tab was specifically designed for selected user groups to complete assigned tasks relating to updating Membership Activity Comments and completing the Product Change Checklist and Sales Debrief. This tab will be blank for those who are not a part of this group.
                    </b>
                </div>
            </div>
            </aura:set-->
    </aura:if>    
    <aura:if isTrue="{!and(!v.hasTabAccess,!v.isCDSVP)}">
        <div class="slds-section">
            <div class="slds-section" style="text-align: center;">
                <b>
                    This tab was specifically designed for selected user groups to complete assigned tasks relating to updating Membership Activity Comments and completing the Product Change Checklist and Sales Debrief. This tab will be blank for those who are not a part of this group.
                </b>
            </div>
        </div>
    </aura:if>
</aura:component>